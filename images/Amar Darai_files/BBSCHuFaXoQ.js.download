if (self.CavalryLogger) { CavalryLogger.start_js(["aj8hR"]); }

__d("ChatTabPolicy",["ChatBehavior","CurrentUser","LogHistory","MercuryActionType","MercuryAssert","MercuryIDs","MercuryIgnoredBlockedParticipants.bs","MercuryLogMessageType","MercuryParticipantTypes","MercurySourceType","MercuryThreadActions","MercuryThreadInfo","MercuryViewer","MessagingTag","MessengerState.bs","OzConstants","PresencePrivacy","ShortProfiles","WorkModeConfig"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=b("MercuryThreadActions").get();a=b("OzConstants").M_FBIDS;c=a.M_DEV;d=a.M;f=a.P;var h=new Set([c,d,f]),i=b("LogHistory").getInstance("tab_policy");e.exports={messageIsAllowed:function(a,c,d){__p&&__p();var e=a.thread_id,f=c.message_id,j=b("MercuryIDs").getUserIDFromParticipantID(b("MercuryViewer").getID());b("MercuryAssert").isThreadID(e);b("MercuryAssert").isParticipantID(c.author);var k=void 0;if(b("MercuryThreadInfo").isMuted(a)){k={thread_id:e,message_id:f,mute_until:a.mute_until};i.log("message_thread_muted",JSON.stringify(k));if(!b("MercuryThreadInfo").areMentionsMuted(a)){if(!c.profile_ranges||!c.profile_ranges.some||!c.profile_ranges.some(function(a){return a.id===j})){i.log("message_mentions_viewer",JSON.stringify(k));return}}else return}if(a.read_only){k={thread_id:e,message_id:f,mode:a.mode};i.log("message_read_only",JSON.stringify(k));return}if(c.source==b("MercurySourceType").EMAIL||c.source==b("MercurySourceType").TITAN_EMAIL_REPLY){k={thread_id:e,message_id:f,source:c.source};i.log("message_source_not_allowed",JSON.stringify(k));return}var l=b("MercuryIDs").getUserIDFromParticipantID(c.author);if(!l){i.log("message_bad_author",JSON.stringify({thread_id:e,message_id:f,user:l}));return}if(c.action_type!=b("MercuryActionType").USER_GENERATED_MESSAGE&&!this._messageIsNewlyCreatedGroup(c,a)){k={thread_id:e,message_id:f,type:c.action_type};i.log("message_non_user_generated",JSON.stringify(k));return}if(a.is_canonical_user&&!b("ChatBehavior").notifiesUserMessages()){i.log("message_jabber",JSON.stringify({thread_id:e,message_id:f}));g.markSeen(e,!0);return}if(a.is_canonical&&!a.other_user_fbid){i.log("message_canonical_contact",JSON.stringify({thread_id:e,message_id:f}));return}if(a.folder!=b("MessagingTag").INBOX){i.log("message_folder",JSON.stringify({thread_id:e,message_id:f,folder:a.folder}));return}var m=b("CurrentUser").getID();b("MessengerState.bs").compute(m,function(c){__p&&__p();c=c.blocked_ids;if(b("MercuryIgnoredBlockedParticipants.bs").isPresentInGroupThread(m,c,a)){k={thread_id:e,message_id:f};i.log("message_blocked_participants",JSON.stringify(k));return}b("ShortProfiles").getMulti([l,j],function(a){__p&&__p();if(!b("PresencePrivacy").allows(l)){i.log("message_privacy",JSON.stringify({thread_id:e,message_id:f,user:l}));return}var c=a[l].employee&&a[j].employee,g=b("WorkModeConfig").is_work_user;if(!c&&!g&&!a[l].isCommercePage&&!h.has(l)&&a[l].type!==b("MercuryParticipantTypes").FRIEND&&a[l].type!==b("MercuryParticipantTypes").PAGE){i.log("message_non_friend",JSON.stringify({thread_id:e,message_id:f,user:l}));return}d()})})},_messageIsNewlyCreatedGroup:function(a,c){return a.action_type===b("MercuryActionType").LOG_MESSAGE&&a.log_message_type===b("MercuryLogMessageType").THREAD_NAME&&c.message_count===1}}}),null);
__d("createUpgradedUFI2MentionsComposerPlugin",["XUITypeaheadView.react","upgradedUFI2MentionsComposerPluginCreatorWithTypeaheadView"],(function(a,b,c,d,e,f){"use strict";e.exports=b("upgradedUFI2MentionsComposerPluginCreatorWithTypeaheadView")(b("XUITypeaheadView.react"))}),null);