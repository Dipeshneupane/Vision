if (self.CavalryLogger) { CavalryLogger.start_js(["bgRRt"]); }

__d("AjaxRequest",["ErrorUtils","Keys","PHPQuerySerializer","TimeSlice","URI","UserAgent_DEPRECATED","ZeroRewrites","clearTimeout","setTimeoutAcrossTransitions"],(function(a,b,c,d,e,f){__p&&__p();function g(a,c,d){c instanceof b("URI")||(c=new(b("URI"))(c)),this.xhr=b("ZeroRewrites").getTransportBuilderForURI(c)(),d&&a=="GET"?c.setQueryData(d):this._params=d,this.method=a,this.uri=c,this.xhr.open(a,c)}var h=window.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest();g.supportsCORS=function(){return h};g.ERROR="ar:error";g.TIMEOUT="ar:timeout";g.PROXY_ERROR="ar:proxy error";g.TRANSPORT_ERROR="ar:transport error";g.SERVER_ERROR="ar:http error";g.PARSE_ERROR="ar:parse error";g.SERVICE_UNAVAILABLE="ar:noservice";g._inflight=[];function a(){var a=g._inflight;g._inflight=[];a.forEach(function(a){a.abort()})}function i(a){a.onJSON=a.onError=a.onSuccess=null,b("clearTimeout")(a._timer),a.xhr&&a.xhr.readyState<4&&(a.xhr.abort(),a.xhr=null),g._inflight=g._inflight.filter(function(b){return b&&b!=a&&b.xhr&&b.xhr.readyState<4})}Object.assign(g.prototype,{timeout:6e4,streamMode:!0,prelude:/^for \(;;\);/,status:null,_eol:-1,_call:function(a){this[a]&&this[a](this)},_parseStatus:function(){__p&&__p();var a;try{this.status=this.xhr.status,a=this.xhr.statusText}catch(a){this.xhr.readyState>=4&&(this.errorType=g.TRANSPORT_ERROR,this.errorText=a.message);return}if(this.status===0&&!/^(file|ftp)/.test(this.uri))this.errorType=g.TRANSPORT_ERROR;else if(this.status>=100&&this.status<200)this.errorType=g.PROXY_ERROR;else if(this.status>=200&&this.status<300)return;else if(this.status>=300&&this.status<400)this.errorType=g.PROXY_ERROR;else if(this.status>=400&&this.status<500)this.errorType=g.SERVER_ERROR;else if(this.status===503)this.errorType=g.SERVICE_UNAVAILABLE;else if(this.status>500&&this.status<600)this.errorType=g.PROXY_ERROR;else if(this.status==1223)return;else this.status>=12001&&this.status<=12156?this.errorType=g.TRANSPORT_ERROR:(a="unrecognized status code: "+this.status,this.errorType=g.ERROR);this.errorText||(this.errorText=a)},_parseResponse:function(){__p&&__p();var a,c=this.xhr.readyState;try{a=this.xhr.responseText||""}catch(a){c>=4&&(this.errorType=g.ERROR,this.errorText="responseText not available - "+a.message);return}while(this.xhr){var d=this._eol+1,e=this.streamMode?a.indexOf("\n",d):a.length;e<0&&c==4&&(e=a.length);if(e<=this._eol)break;var f=a;this.streamMode&&(f=a.substr(d,e-d).replace(/^\s*|\s*$/g,""));d===0&&this.prelude&&(this.prelude.test(f)&&(f=f.replace(this.prelude,"")));this._eol=e;if(f){try{this.json=JSON.parse(f)}catch(b){e=/(<body[\S\s]+?<\/body>)/i.test(a)&&RegExp.$1;d={message:b.message,"char":d,excerpt:(d===0&&e||f).substr(512)};this.errorType=g.PARSE_ERROR;this.errorText="parse error - "+JSON.stringify(d);return}b("ErrorUtils").applyWithGuard(this._call,this,["onJSON"])}}},_onReadyState:function(a){var b=this.xhr&&this.xhr.readyState||0;this.status==null&&b>=2&&this._parseStatus();!this.errorType&&this.status!=null&&((b==3&&this.streamMode||b==4)&&a(this._parseResponse.bind(this)));(this.errorType||b==4)&&(this._time=Date.now()-this._sentAt,a.last(function(){this._call(this.errorType?"onError":"onSuccess"),i(this)}.bind(this)))},send:function(a){var c=b("TimeSlice").getReusableContinuation("AjaxRequest xhr.onreadystatechange");this.xhr.onreadystatechange=this._onReadyState.bind(this,c);c=this.timeout;c&&(this._timer=b("setTimeoutAcrossTransitions")(function(){this.errorType=g.TIMEOUT,this.errorText="timeout",this._time=Date.now()-this._sentAt,this._call("onError"),i(this)}.bind(this),c));g._inflight.push(this);this.method=="POST"&&this.xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded");this._sentAt=Date.now();this.xhr.send(a?b("PHPQuerySerializer").serialize(a):"")},abort:function(){i(this)},toString:function(){var a="[AjaxRequest readyState="+this.xhr.readyState;this.errorType&&(a+=" errorType="+this.errorType+" ("+this.errorText+")");return a+"]"},toJSON:function(){var a={json:this.json,status:this.status,errorType:this.errorType,errorText:this.errorText,time:this._time};this.errorType&&(a.uri=this.uri);for(var b in a)a[b]==null&&delete a[b];return a}});window.addEventListener&&b("UserAgent_DEPRECATED").firefox()&&window.addEventListener("keydown",function(event){event.keyCode===b("Keys").ESC&&event.prevent()},!1);window.attachEvent&&window.attachEvent("onunload",a);e.exports=g}),null);
__d("ChannelSubdomain",["Event","JSLogger","Run","LogHistory","clearTimeout","setTimeoutAcrossTransitions","WebStorage"],(function(a,b,c,d,e,f){__p&&__p();var g=b("LogHistory").getInstance("channel"),h=b("JSLogger").create("channel"),i="channel_sub:",j=7,k=100*1e3,l=null,m;function n(){var a=b("WebStorage").getLocalStorage();m&&(b("clearTimeout")(m),m=null);a&&l!=null&&a.removeItem(i+l);l=null}function a(a,c,d){__p&&__p();var e=(a-1)*j;d&&(m&&b("clearTimeout")(m),l=m=null);c==null&&(c=Math.floor(Math.random()*e));if(l==null){var f,o,p,q,r;(function(){__p&&__p();var j=b("WebStorage").getLocalStorage();if(j){a=[];for(d=0;d<j.length;d++)f=j.key(d),f.indexOf(i)===0&&(o=parseInt(f.substr(i.length),10),a[o]=parseInt(j.getItem(f),10));p=Date.now()-k;for(d=0;d<e;d++){q=(d+c)%e;if(!a[q]||a[q]<p){l=q;break}}l!=null?(r=function(){try{j.setItem(i+l,Date.now())}catch(a){g.warn("subdomain set failed",a.message)}m=b("setTimeoutAcrossTransitions")(r,k/2)},r()):(g.warn("no channel subdomain",a),h.error("subdomain_overflow"));typeof window.onpageshow!=="undefined"?b("Event").listen(window,"pagehide",n):b("Run").onUnload(n)}else l=c})()}return l==null?null:l%j}e.exports={allocate:a,clear:n}}),null);
__d("ChatproxyClientErrorsTypedLogger",["Banzai","GeneratedLoggerUtils","nullthrows"],(function(a,b,c,d,e,f){"use strict";__p&&__p();function a(){this.clear()}a.prototype.log=function(){b("GeneratedLoggerUtils").log("logger:ChatproxyClientErrorsLoggerConfig",this.$1,b("Banzai").BASIC)};a.prototype.logVital=function(){b("GeneratedLoggerUtils").log("logger:ChatproxyClientErrorsLoggerConfig",this.$1,b("Banzai").VITAL)};a.prototype.logImmediately=function(){b("GeneratedLoggerUtils").log("logger:ChatproxyClientErrorsLoggerConfig",this.$1,{signal:!0})};a.prototype.clear=function(){this.$1={};return this};a.prototype.getData=function(){return babelHelpers["extends"]({},this.$1)};a.prototype.updateData=function(a){this.$1=babelHelpers["extends"]({},this.$1,a);return this};a.prototype.setAppVersion=function(a){this.$1.app_version=a;return this};a.prototype.setBatchSize=function(a){this.$1.batch_size=a;return this};a.prototype.setErrorMessage=function(a){this.$1.error_message=a;return this};a.prototype.setErrorReason=function(a){this.$1.error_reason=a;return this};a.prototype.setErrorText=function(a){this.$1.error_text=a;return this};a.prototype.setJsEventTimeMs=function(a){this.$1.js_event_time_ms=a;return this};a.prototype.setMultiViewSubscription=function(a){this.$1.multi_view_subscription=a;return this};a.prototype.setRequestID=function(a){this.$1.request_id=a;return this};a.prototype.setResponseHeaders=function(a){this.$1.response_headers=a;return this};a.prototype.setSessionID=function(a){this.$1.session_id=a;return this};a.prototype.setSessionIDStr=function(a){this.$1.session_id_str=a;return this};a.prototype.setStatusCode=function(a){this.$1.status_code=a;return this};a.prototype.setSubscriberID=function(a){this.$1.subscriber_id=a;return this};a.prototype.setTopicPrefixes=function(a){this.$1.topic_prefixes=b("GeneratedLoggerUtils").serializeVector(a);return this};a.prototype.setURL=function(a){this.$1.url=a;return this};a.prototype.setXhrReadyState=function(a){this.$1.xhr_ready_state=a;return this};a.prototype.setXhrStatus=function(a){this.$1.xhr_status=a;return this};c={app_version:!0,batch_size:!0,error_message:!0,error_reason:!0,error_text:!0,js_event_time_ms:!0,multi_view_subscription:!0,request_id:!0,response_headers:!0,session_id:!0,session_id_str:!0,status_code:!0,subscriber_id:!0,topic_prefixes:!0,url:!0,xhr_ready_state:!0,xhr_status:!0};e.exports=a}),null);
__d("DocRPC",["ErrorUtils","FBLogger"],(function(a,b,c,d,e,f){__p&&__p();var g={_apis:{},_dispatch:function(a){__p&&__p();var c;try{a=JSON.parse(a)}catch(b){throw new Error('DocRPC unparsable dispatch: "'+a+'"')}if(Object.prototype.hasOwnProperty.call(g._apis,a.api)){var d=g._apis[a.api];d[a.method]&&(c=b("ErrorUtils").applyWithGuard(d[a.method],d,a.args))}c===undefined&&(c=null);return JSON.stringify(c)},publish:function(a,b){g._apis[b]=a},proxy:function(a,c,d){__p&&__p();var e={};d.forEach(function(d){__p&&__p();e[d]=function(){__p&&__p();var e={api:c,method:d,args:Array.prototype.slice.call(arguments)},f;try{if(a.closed)throw new Error("DocRPC window closed");f=a.DocRPC._dispatch(JSON.stringify(e))}catch(a){b("FBLogger")("doc_rpc").catching(a).warn("Encountered an error duing proxy call");return}if(typeof f==="string")try{f=JSON.parse(f)}catch(a){b("FBLogger")("doc_rpc").catching(a).mustfix("DocRPC %s.%s unparsable return: %s",c,d,f);throw new Error("DocRPC "+c+"."+d+' unparsable return: "'+f+'"')}return f}});return e}};e.exports=a.DocRPC=g}),null);
__d("ChannelTransport",["AjaxRequest","BanzaiODS","ChannelConstants","ChatproxyClientErrorsTypedLogger","DocRPC","LogHistory","TimeSlice","URI","bind","clearTimeout","setTimeoutAcrossTransitions"],(function(a,b,c,d,e,f){__p&&__p();var g=b("LogHistory").getInstance("channel");function h(a){var c=new(b("ChatproxyClientErrorsTypedLogger"))();c.setStatusCode(a.status);if(a.xhr!=null){var d=a.xhr.getResponseHeader("x-fb-chat-failure-reason");d&&c.setErrorReason(d)}c.setErrorMessage(a.errorType);a.uri!==undefined&&c.setURL(a.uri.getPath());c.log()}function i(){return(1048576*Math.random()|0).toString(36)}function j(a){return a!==null&&a!==undefined&&!isNaN(a)&&isFinite(a)&&0<=a&&a<=6}function k(a,c){var d="";j(a.subdomain)&&(d=a.subdomain+"-");var e=a.host;e=e===null||e===undefined?"edge-chat":a.host;c=new(b("URI"))(c).setDomain(d+e+"."+a.domain).setPort(a.port).setSecure(new(b("URI"))(window.location.href).isSecure());return c}function l(a){__p&&__p();var c={partition:a.partition,cb:i(),failure:a.pingFailuresOnSubdomain};a.sticky_token&&(c.sticky_token=a.sticky_token);a.sticky_pool&&(c.sticky_pool=a.sticky_pool);c=k(a,"/p").setQueryData(c);g.log("start_p",{uri:c.toString()});var d=new(b("AjaxRequest"))("GET",c);b("AjaxRequest").supportsCORS()&&(d.xhr.withCredentials=!0);var e=function(b){g.log("finish_p",{xhr:b.toJSON?b.toJSON():b,subdomain:a.subdomain,fullHost:a.fullHost})};d.onError=function(c){b("BanzaiODS").bumpEntityKey("ChannelTransport","sendP.error");h(d);e(c);if(a.subdomain===null)return;j(a.subdomain)&&(a.pingFailuresOnSubdomain++,a.subdomain++,a.subdomain>6&&(a.subdomain=0))};d.timeout=a.P_TIMEOUT;d.onSuccess=function(a){b("BanzaiODS").bumpEntityKey("ChannelTransport","sendP.success"),e(a)};d.send()}function m(a,c,d){__p&&__p();var e=new Image(),f=0,j=function(a){e.abort();return a?c():d()};e.onload=b("TimeSlice").guard(function(){g.log("ping_ok",{duration:Date.now()-f}),b("BanzaiODS").bumpEntityKey("ChannelTransport","sendPing.success"),j(!0)},"ChannelTransport image.onload");e.onerror=b("TimeSlice").guard(function(){l(a),b("BanzaiODS").bumpEntityKey("ChannelTransport","sendPing.error"),h(e),j(!1)},"ChannelTransport image.onerror");var m=b("setTimeoutAcrossTransitions")(e.onerror,1e4);e.abort=function(){m&&(b("clearTimeout")(m),m=null),e.onload=e.onerror=null};var n={partition:a.partition,cb:i()};a.sticky_token&&(n.sticky_token=a.sticky_token);a.sticky_pool&&(n.sticky_pool=a.sticky_pool);a.lastRequestErrorReason&&(n.reason=a.lastRequestErrorReason,a.lastRequestErrorReason=null);a.uid&&a.viewerUid&&(n.uid=a.uid,n.viewer_uid=a.viewerUid);f=Date.now();e.src=k(a,"/ping").setQueryData(n);return e}function a(a,c){__p&&__p();var d={channel:a.user_channel,partition:a.partition,clientid:a.sessionID,cb:i(),cap:0,uid:a.uid,viewer_uid:a.viewerUid};a.sticky_token&&(d.sticky_token=a.sticky_token);a.sticky_pool&&(d.sticky_pool=a.sticky_pool);a.profile&&(d.profile=a.profile);a.capabilities&&(d.cap=a.capabilities);d.id=c;c=k(a,"/add_bud").setQueryData(d);var e=new(b("AjaxRequest"))("GET",c);b("AjaxRequest").supportsCORS()&&(e.xhr.withCredentials=!0);e.onError=function(a){b("BanzaiODS").bumpEntityKey("ChannelTransport","sendAdditionalBuddy.error"),g.warn("add_buddy_error"),h(e)};e.onSuccess=function(a){b("BanzaiODS").bumpEntityKey("ChannelTransport","sendAdditionalBuddy.success"),g.log("add_buddy_ok")};e.timeout=a.P_TIMEOUT;e.send()}function c(a){__p&&__p();var c={channel:a.user_channel,partition:a.partition,clientid:a.sessionID,cb:i(),cap:0,uid:a.uid,viewer_uid:a.viewerUid};a.sticky_token&&(c.sticky_token=a.sticky_token);a.sticky_pool&&(c.sticky_pool=a.sticky_pool);a.is_offline||a.shouldSuppressPresence?c.state="offline":c.state="active";if(c.state===a.lastPresenceState)return;a.lastPresenceState=c.state;a.profile&&(c.profile=a.profile);a.capabilities&&(c.cap=a.capabilities);c=k(a,"/active_ping").setQueryData(c);var d=new(b("AjaxRequest"))("GET",c);b("AjaxRequest").supportsCORS()&&(d.xhr.withCredentials=!0);d.onError=function(a){b("BanzaiODS").bumpEntityKey("ChannelTransport","sendActivePing.error"),g.warn("active_ping_error"),h(d)};d.onSuccess=function(a){b("BanzaiODS").bumpEntityKey("ChannelTransport","sendActivePing.success"),g.log("active_ping_ok")};d.timeout=a.P_TIMEOUT;d.send()}function n(a,c,d,e){__p&&__p();var f=new Date(),j=-1;a.userActive>0&&(j=(f-a.userActive)/1e3|0,j<0&&g.warn("idle_regression",{idleTime:j,now:f.getTime(),userActive:a.userActive}));f={channel:a.user_channel,seq:a.seq,partition:a.partition,clientid:a.sessionID,cb:i(),idle:j,qp:"y",cap:0};a.state.aiq&&(f.aiq=a.state.aiq);a.ready&&((a.seqTurSentAt==-1||a.seqTurSentAt==a.seq)&&(f.tur=a.timeUntilReady,f.qpmade=a.queueMade,a.seqTurSentAt=a.seq));f.pws=a.pws;a.sequenceId>0&&(f.isq=a.sequenceId);f.msgs_recv=a.estimatedReceived;a.uid&&a.viewerUid&&(f.uid=a.uid,f.viewer_uid=a.viewerUid);a.sticky_token?f.sticky_token=a.sticky_token:(f.request_batch=1,a.msgr_region&&(f.msgr_region=a.msgr_region));a.sticky_pool&&(f.sticky_pool=a.sticky_pool);"trace_id"in a&&(f.traceid=a.trace_id);a.is_offline||a.shouldSuppressPresence?f.state="offline":a.userActive>0&&j<60&&(f.state="active");a.lastPresenceState=f.state;a.streamingCapable&&(f.mode="stream",f.format="json");a.profile&&(f.profile=a.profile);a.capabilities&&(f.cap=a.capabilities);j=k(a,"/pull").setQueryData(f);f="GET";var l=new(b("AjaxRequest"))(f,j);b("AjaxRequest").supportsCORS()&&(l.xhr.withCredentials=!0);l.timeout=a.streamingCapable?a.STREAMING_TIMEOUT:a.LONGPOLL_TIMEOUT;l.onJSON=function(a){b("BanzaiODS").bumpEntityKey("ChannelTransport","sendPull.json"),c(a)};l.onSuccess=function(a){b("BanzaiODS").bumpEntityKey("ChannelTransport","sendPull.success"),d(a)};l.onError=function(){var c=this.status==12002&&this._time>=a.MIN_12002_TIMEOUT||this.status==504&&this._time>=a.MIN_504_TIMEOUT,f=c?d:e;c?b("BanzaiODS").bumpEntityKey("ChannelTransport","sendPull.success"):(b("BanzaiODS").bumpEntityKey("ChannelTransport","sendPull.error"),h(l));return f&&f.apply(this,arguments)};l.send();a.inStreaming=a.streamingCapable;return l}function o(a){this.manager=a,this.init&&this.init()}function d(a){o.apply(this,arguments)}Object.assign(d.prototype,{logName:"CORS",enterState:function(a,c){this._request&&(this._request.abort(),this._request=null);a=="init"&&b("setTimeoutAcrossTransitions")(b("bind")(this.manager,"exitState",{status:b("ChannelConstants").OK,stateId:c.stateId}),0);if(!/pull|ping/.test(a))return;var d=this.manager;a=="ping"?this._request=m(c,b("bind")(d,"exitState",{status:b("ChannelConstants").OK,stateId:c.stateId}),b("bind")(d,"exitState",{status:b("ChannelConstants").ERROR,stateId:c.stateId})):a=="pull"&&(this._request=n(c,b("bind")(d,"_processTransportData",c.stateId),b("bind")(d,"exitState",{status:b("ChannelConstants").OK,stateId:c.stateId}),b("bind")(d,"exitState",{status:b("ChannelConstants").ERROR,stateId:c.stateId})))}});function f(a){g.log("iframe_init_constructor"),o.apply(this,arguments),this._iframe=document.createElement("iframe"),this._iframe.style.display="none",document.body.appendChild(this._iframe),b("DocRPC").publish(this,"outerTransport")}Object.assign(f.prototype,{logName:"iframe",_initIframe:function(a){__p&&__p();g.log("iframe_init_start");window.onchanneliframeready=function(){g.log("iframe_resources");return a.resources};window.onchanneliframeloaded=function(){g.log("iframe_loaded")};if(a){this._iframeURI=k(a,a.path);if(a.resources){var c=this._iframeURI.getDomain();a.resources=a.resources.map(function(a){var d=new(b("URI"))(a);return d.getPath().startsWith("/intern/rsrc.php")&&d.getQueryData().origin!==undefined?d.addQueryData("origin",c).toString():a})}}else this._iframeURI="about:blank";this._iframeProxy=null;try{this._iframe.contentWindow.location.replace(this._iframeURI),g.log("iframe_uri_set")}catch(c){g.error("iframe_uri_set_error",c),this.exitState({status:b("ChannelConstants").ERROR,stateId:a.stateId},c+"")}},enterState:function(a,c){a=="init"?this._initIframe(c):/idle|ping|pull/.test(a)?this._iframeProxy?this._iframeProxy.enterState.apply(this._iframeProxy,arguments):a!="idle"&&this.exitState({status:b("ChannelConstants").ERROR,stateId:c.stateId},"iframe not yet loaded"):a=="shutdown"&&this._initIframe()},_processTransportData:function(){this.manager._processTransportData.apply(this.manager,arguments)},exitState:function(a){this.manager.state=="init"&&a.status==b("ChannelConstants").OK&&(this._iframeProxy=b("DocRPC").proxy(this._iframe.contentWindow,"innerTransport",["enterState"],(this._iframeURI+"").replace(/iframe.*/,"")));if(/ping|pull/.test(this.manager.state)&&!this._iframeProxy)return;this.manager.exitState.apply(this.manager,arguments)}});function p(){this.init=this.init.bind(this),o.apply(this,arguments)}Object.assign(p.prototype,{logName:"iframe(inner)",init:function(){b("DocRPC").publish(this,"innerTransport");try{var a=b("DocRPC").proxy(window.parent,"outerTransport",["_processTransportData","exitState"],top.DocRPC.origin);Object.assign(this,a);this.exitState({status:b("ChannelConstants").OK,stateId:1e6})}catch(a){g.error("iframe_inner_init_error",a)}},enterState:function(a,c){this._request&&(this._request.abort(),this._request=null),a=="ping"?this._request=m(c,b("bind")(this,"exitState",{status:b("ChannelConstants").OK,stateId:c.stateId}),b("bind")(this,"exitState",{status:b("ChannelConstants").ERROR,stateId:c.stateId})):a=="pull"&&(this._request=n(c,b("bind")(this,"_processTransportData",c.stateId),b("bind")(this,"exitState",{status:b("ChannelConstants").OK,stateId:c.stateId}),b("bind")(this,"exitState",{status:b("ChannelConstants").ERROR,stateId:c.stateId})))}});e.exports={isSubdomain:j,getURI:k,Transport:o,CORSTransport:d,IframeTransport:f,IframeInnerTransport:p,sendActivePing:c,sendAdditionalBuddyRequest:a}}),null);
__d("MercuryLoggingHelper",[],(function(a,b,c,d,e,f){__p&&__p();function g(a){return Array.from(a).slice(0,6).join("")}a={obfuscateThread:function(a){var b=babelHelpers["extends"]({},a);a&&a.snippet&&a.snippet.length>9&&(b.snippet=g(a.snippet)+"...");return b},obfuscateMessage:function(a){var b=babelHelpers["extends"]({},a);a&&a.body&&a.body.length>9&&(b.body=g(a.body)+"...");return b}};e.exports=a}),null);
__d("ChannelTransportDataLogger",["Arbiter","JSLogger","MercuryLoggingHelper"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=[],h=10,i=function(a){return a.map(function(a){var c=a;(a.message||a.delta&&a.delta.body)&&(c=babelHelpers["extends"]({},a),a.message&&(c.message=b("MercuryLoggingHelper").obfuscateMessage(a.message)),a.delta&&a.delta.body&&(c.delta=b("MercuryLoggingHelper").obfuscateMessage(a.delta)));return c})};a={log:function(a){var b={t:a.t,seq:a.seq};a.ms&&(b.ms=i(a.ms));g.push(b);g.length>h&&g.shift()}};b("Arbiter").subscribe(b("JSLogger").DUMP_EVENT,function(a,b){b.channelTransportLog=g});e.exports=a}),null);
__d("ChatProxyConnectionState",[],(function(a,b,c,d,e,f){"use strict";__p&&__p();function a(){this.auxiliaryIrisQueues={},this.aiq=null}a.prototype.subscribeIrisQueue=function(a,b){this.auxiliaryIrisQueues[a]=b,this.updateCaches()};a.prototype.unsubscribeIrisQueue=function(a){delete this.auxiliaryIrisQueues[a],this.updateCaches()};a.prototype.updateCaches=function(){var a=[];for(var b in this.auxiliaryIrisQueues)Object.prototype.hasOwnProperty.call(this.auxiliaryIrisQueues,b)&&(a.push(b),a.push(this.auxiliaryIrisQueues[b]));a.length===0?this.aiq=null:this.aiq=a.join(",")};e.exports=a}),null);
__d("FBAjaxRequest",["AjaxRequest","getAsyncParams"],(function(a,b,c,d,e,f){__p&&__p();function a(a,c,d){__p&&__p();d=babelHelpers["extends"]({},b("getAsyncParams")(a),d);a=new(b("AjaxRequest"))(a,c,d);a.streamMode=!1;var e=a._call;a._call=function(a){a=="onJSON"&&this.json&&(this.json.error&&(this.errorType=b("AjaxRequest").SERVER_ERROR,this.errorText="AsyncResponse error: "+this.json.error),this.json=this.json.payload),e.apply(this,arguments)};a.ajaxReqSend=a.send;a.send=function(a){this.ajaxReqSend(babelHelpers["extends"]({},a,d))};return a}e.exports=a}),null);
__d("CollabMinimumChromeVersion",[],(function(a,b,c,d,e,f){e.exports=Object.freeze({SCREEN_SHARE_CALL:65,VIDEO_CALL:48})}),null);
__d("WorkplaceChatHelper",["ChannelConstants","PresenceStatus","gkx"],(function(a,b,c,d,e,f){"use strict";a={isDesktopChatApp:function(){return window.workchat!==undefined},getAppID:function(){return window.workchat.appId},showWindow:function(){window.workchat.showWindow()},getScreenSharingSourceID:function(){return window.workchat.getScreenSharingSourceID()},stopScreenSharing:function(){return window.workchat.stopScreenSharing()},suppressChatIfActiveOnDesktop:function(){return(b("PresenceStatus").getViewerCapabilities()&b("ChannelConstants").CAPABILITY_ACTIVE_ON_DESKTOP_APP)==b("ChannelConstants").CAPABILITY_ACTIVE_ON_DESKTOP_APP&&b("gkx")("AT4ZMAXkzCcX4p9DjSWk5wvjd_wjBUdDPViibiBIfjvUyD6wX_fK23ETuzkop1uX0uOJihKtSxVg3O_V4WawyBhaw_xvwERDuCKoQu725uXIow")}};e.exports=a}),null);
__d("FBRTCSupport",["ChannelConstants","CollabMinimumChromeVersion","RTCConfig","UserAgent","WorkplaceChatHelper"],(function(a,b,c,d,e,f){__p&&__p();var g={isSendWebrtcSupported:function(){return!!b("RTCConfig").SendNewVCGK},isReceiveWebrtcSupported:function(){return!!b("RTCConfig").ReceiveNewVCGK},isWebrtcSupported:function(){return b("UserAgent").isBrowser("Chrome >= 28")||b("UserAgent").isBrowser("Firefox >= 25")||!!b("RTCConfig").RtcUseWebRTCForEdge&&b("UserAgent").isBrowser("Edge >= 15.15042")||b("UserAgent").isBrowser("Opera >= 20")},isGroupCallWebtrcSupported:function(){return b("UserAgent").isBrowser("Chrome >= 28")||b("UserAgent").isBrowser("Opera >= 20")},isCollabSupported:function(){return g.isWebrtcSupported()&&(!!b("RTCConfig").CollabWhitelistedBrowserGK||b("UserAgent").isBrowser("Chrome >= "+b("CollabMinimumChromeVersion").VIDEO_CALL))},isOSSupported:function(){return!b("UserAgent").isPlatform("Android")&&!b("UserAgent").isPlatform("iOS")},isVideoFilterEffectSupported:function(){return!!b("RTCConfig").RtcWwwVideoCallFiltersGK&&(b("UserAgent").isBrowser("Chrome >= 51")||b("UserAgent").isBrowser("Opera >= 36"))},getCapabilities:function(){var a=0;this.isReceiveWebrtcSupported()&&(a|=b("ChannelConstants").CAPABILITY_VOIP_INTEROP);b("WorkplaceChatHelper").isDesktopChatApp()&&(a|=b("ChannelConstants").CAPABILITY_ACTIVE_ON_DESKTOP_APP);return a}};e.exports=g}),null);
__d("FantailLogger",["FantailConfig"],(function(a,b,c,d,e,f){__p&&__p();var g=b("FantailConfig").FantailLogQueue;a={debug:function(a,b){var c;for(var d=arguments.length,e=Array(d>2?d-2:0),f=2;f<d;f++)e[f-2]=arguments[f];g&&(c=g.get(a)).debug.apply(c,[b].concat(e))},info:function(a,b){var c;for(var d=arguments.length,e=Array(d>2?d-2:0),f=2;f<d;f++)e[f-2]=arguments[f];g&&(c=g.get(a)).info.apply(c,[b].concat(e))},warn:function(a,b){var c;for(var d=arguments.length,e=Array(d>2?d-2:0),f=2;f<d;f++)e[f-2]=arguments[f];g&&(c=g.get(a)).warn.apply(c,[b].concat(e))},error:function(a,b){var c;for(var d=arguments.length,e=Array(d>2?d-2:0),f=2;f<d;f++)e[f-2]=arguments[f];g&&(c=g.get(a)).error.apply(c,[b].concat(e))}};e.exports=a}),null);
__d("MovingStat",[],(function(a,b,c,d,e,f){__p&&__p();function a(a){__p&&__p();a=a||6e4;var b={t:new Date(),count:0,v:0},c=b,d=0,e=0;function f(){var b=new Date()-a;while(c&&c.next&&c.t<b)d-=c.v,e-=c.count,c=c.next}this.add=function(a){d+=a;e++;var c=new Date();c-b.t<1e3?(b.v+=a,b.count++):(b.next={t:c,v:a,count:1},b=b.next,f())};this.tally=function(b){b=b||1e3;f();return{sum:d,count:e,timeAverage:d*b/a}}}e.exports=a}),null);
__d("RTISession",["invariant","AjaxRequest","BanzaiODS","ChatproxyClientErrorsTypedLogger","ErrorUtils","URI"],(function(a,b,c,d,e,f,g){"use strict";__p&&__p();function a(a,b,c,d,e,f,h,i,j,k){a||g(0),e||g(0),f||g(0),this.domain=a,this.topLevelDomain=b,this.port=c,this.edgePoolName=d,this.stickyToken=e,this.loggedInId=f,this.accountId=h,this.clientProfile=i||"desktop",this.clientId=j,this.capabilities=k}a.prototype.issueRequest=function(a,c,d,e,f){__p&&__p();a||g(0);c||g(0);e||g(0);var h=this.domain+"."+this.topLevelDomain,i=(1048576*Math.random()|0).toString(36);i={cb:i,sticky_token:this.stickyToken,uid:this.loggedInId,viewer_uid:this.accountId,sticky_pool:this.edgePoolName,profile:this.clientProfile,clientid:this.clientId,cap:this.capabilities};for(var j in i)c[j]&&g(0);Object.assign(i,c);c=new(b("URI"))(a).setDomain(h).setPort(this.port).setSecure(new(b("URI"))(window.location.href).isSecure()).setQueryData(i);a=d?"POST":"GET";var k=new(b("AjaxRequest"))(a,c);k.timeout=f?f*1e3:3e4;k.streamMode=!1;k.xhr&&(k.xhr.withCredentials=!0);var l={};k.onSuccess=function(){b("BanzaiODS").bumpEntityKey("RTISession","request.success")};k.onJSON=function(){l.data=k.json,l.error=null,b("ErrorUtils").applyWithGuard(e,this,[l])}.bind(this);k.onError=function(){__p&&__p();var a=new Set(),c=void 0;if(d!==undefined&&d.subscriptions!==undefined){c=d.subscriptions.length;for(var f=0;f<d.subscriptions.length;f++){var g=d.subscriptions[f].topic.split("/");g.pop();a.add(g.join("/"))}}l.data=null;l.error=k.errorType||"error";b("BanzaiODS").bumpEntityKey("RTISession","request.error");this.logRequestFailure(k,a,c);b("ErrorUtils").applyWithGuard(e,this,[l])}.bind(this);k.send(JSON.stringify(d));b("BanzaiODS").bumpEntityKey("RTISession","request.attempt")};a.prototype.logRequestFailure=function(a,c,d){__p&&__p();var e=new(b("ChatproxyClientErrorsTypedLogger"))();e.setStatusCode(a.status);if(a.xhr!=null){var f=a.xhr.getResponseHeader("x-fb-chat-failure-reason");f&&e.setErrorReason(f)}e.setSubscriberID(this.loggedInId);e.setSessionIDStr(this.clientId);e.setErrorMessage(a.errorType);e.setErrorText(a.errorText);e.setTopicPrefixes(c);e.setJsEventTimeMs(Math.floor(Date.now()/1e3));d&&e.setBatchSize(d);a.uri&&e.setURL(a.uri.getPath());e.log()};e.exports=a}),null);
__d("ChannelManager",["errorCode","Promise","AjaxRequest","Arbiter","AsyncRequest","BanzaiODS","ChannelClientID","ChannelConstants","ChannelInitialData","ChannelSubdomain","ChannelTransport","ChannelTransportDataLogger","ChatVisibility","ChatReliabilityInstrumentation","DTSG","Env","FantailLogger","FBAjaxRequest","FBRTCSupport","ISB","JSLogger","LogHistory","MovingStat","PresenceCookieManager","PresenceState","PresenceUtil","Random","RTISession","SystemEvents","URI","UserActivity","ChatProxyConnectionState","emptyFunction","requestAnimationFrameAcrossTransitions","setIntervalAcrossTransitions","setTimeoutAcrossTransitions","clearTimeout"],(function(a,b,c,d,e,f,g){__p&&__p();var h,i=b("JSLogger").create("channel"),j=b("LogHistory").getInstance("channel_manager"),k=null,l=b("emptyFunction"),m=new(b("Promise"))(function(a,b){l=a});function a(a){k=a}var n={idle:{ok:"init!"},init:{ok:"pull!",error:"reconnect",sys_online:"init",sys_timetravel:"init"},pull:{ok:"pull!",error:"ping",error_missing:"pull",error_msg_type:"pull",refresh_0:"reconnect",refresh_110:"reconnect",refresh_111:"reconnect",refresh_112:"pull",refresh_113:"pull",refresh_117:"reconnect"},ping:{ok:"pull!",error:"ping",error_stale:"reconnect!"},reconnect:{ok:"init!",error:"reconnect",sys_online:"reconnect",sys_timetravel:"reconnect"},shutdown:{},_all:{error_max:"shutdown!",error_shutdown:"shutdown!",sys_owner:"reconnect",sys_nonowner:"idle!",sys_online:"ping",sys_offline:"idle!",sys_timetravel:"ping"}},o={state:new(b("ChatProxyConnectionState"))(),userActive:Date.now(),created:Date.now(),ready:!1,seqTurSentAt:-1,queueMade:"",sequenceId:0,lastPresenceState:null,lastRequestErrorReason:null,seq:0,pingFailuresOnSubdomain:0,pws:"fresh",estimatedReceived:0,sessionID:b("ChannelClientID").getID(),capabilities:b("FBRTCSupport").getCapabilities(),streamingCapable:!1,inStreaming:!1,shouldSuppressPresence:b("PresenceState").shouldSuppress(),LONGPOLL_TIMEOUT:6e4,STREAMING_TIMEOUT:6e4,P_TIMEOUT:3e4,IFRAME_LOAD_TIMEOUT:3e4,MIN_RETRY_INTERVAL:5e3,MAX_RETRY_INTERVAL:32e4,MIN_12002_TIMEOUT:9e3,MIN_504_TIMEOUT:2e4,STALL_THRESHOLD:18e4,JUMPSTART_THRESHOLD:9e4,MIN_INIT_PROBE_DELAY:3e3,INIT_PROBE_DELAY_RANDOMIZE_RANGE:12e3,CHANNEL_PROXY_REPORTING_MIN_INTERVAL:1e4,PROBE_DELAY:6e4,PROBE_HEARTBEATS_INTERVAL_LOW:1e3,PROBE_HEARTBEATS_INTERVAL_HIGH:5e3,STREAMING_EXIT_STATE_ON_CONTINUE:!1},p=1,q={},r=0;function s(){return b("AsyncRequest").lastSuccessTime?Math.round((Date.now()-b("AsyncRequest").lastSuccessTime)/1e3):-1}function t(){var a={};h.getConfig("host")&&(a[h.getConfig("user_channel")]=h.getConfig("seq",0));return a}function u(){__p&&__p();var a=Date.now(),c=Date.now(),d={total:0},e="idle",f=!1;b("SystemEvents").subscribe([b("SystemEvents").USER,b("SystemEvents").ONLINE,b("SystemEvents").TIME_TRAVEL],function(a,d){__p&&__p();v(!0);c=null;h.lastPullTime=Date.now();var e;switch(a){case b("SystemEvents").USER:e=b("SystemEvents").isPageOwner()?b("ChannelConstants").SYS_OWNER:b("ChannelConstants").SYS_NONOWNER;break;case b("SystemEvents").ONLINE:e=d?b("ChannelConstants").SYS_ONLINE:b("ChannelConstants").SYS_OFFLINE;break;case b("SystemEvents").TIME_TRAVEL:if(o.skipTimeTravel)return;if(0<d){b("FantailLogger").warn(b("ChannelConstants").FANTAIL_SERVICE,"skipping time travel failure. %s",d);return}e=b("ChannelConstants").SYS_TIMETRAVEL;break}h.exitState({status:e,stateId:p})});var g=function(f,g){__p&&__p();var h=Date.now(),i=null;g?(a=h,i=g.nextState||g.state):i=e;b("SystemEvents").checkTimeTravel();if(c){g=Math.round((h-c)/1e3);g>0&&(d[e]=(d[e]||0)+g,d.total+=g)}e=i;c=h;f||(d.lastSuccessTime=s(),d.online=b("SystemEvents").isOnline(),j.log("rollup",JSON.stringify(d)))};b("Arbiter").subscribe(b("ChannelConstants").ON_ENTER_STATE,g);b("setIntervalAcrossTransitions")(g,6e4);b("Arbiter").subscribe(b("JSLogger").DUMP_EVENT,function(a,b){b.channelRollup=d});g=function(){__p&&__p();if(h.isShutdown()||h.shouldIdle())return;b("SystemEvents").checkTimeTravel();var c=Date.now()-(h.lastPullTime||b("Env").start);if(!f&&c>o.STALL_THRESHOLD){var d=s();j.error("stall",JSON.stringify({lastSuccessTime:d,rollupState:e}));b("ChatReliabilityInstrumentation").logCHANNEL_STALLED(c.toString());f=!0}d=Date.now()-a;h.state=="pull"&&d>o.JUMPSTART_THRESHOLD&&(a=null,j.warn("jumpstart",JSON.stringify({state:h.state,dormant:d})),b("Arbiter").inform(b("ChannelConstants").JUMPSTART,d),h.enterState("init"))};b("setIntervalAcrossTransitions")(g,5e3)}function v(a){a?(r=0,q={}):r++}function w(a,c){var d=!b("AjaxRequest").supportsCORS(),e=b("ChannelTransport").isSubdomain(o.subdomain);!e||d?o.fullHost=o.host:o.fullHost=o.subdomain+"-"+o.host;b("FantailLogger").info(b("ChannelConstants").FANTAIL_SERVICE,"received lb info: %s at seq: %s{%s} with ".concat("sticky: %s/%s, subdomain: %s, fullHost: %s, state: %s,").concat(" source: %s, args: %s"),o.sessionID,o.seq,o.sequenceId,o.sticky_token,o.sticky_pool,o.subdomain,o.fullHost,h.state,a,c)}h={state:"idle",nextState:null,proxyDown:!1,lastPullTime:Date.now(),lastReportOnMisguidedMsgTime:Date.now(),heartbeats:[],setTestCallback:a,backoff:!1,sessionRegistered:!1,init:function(a,c){__p&&__p();b("FantailLogger").info(b("ChannelConstants").FANTAIL_SERVICE,"initializing sessionid:%s at iris-seq:%s",o.sessionID,o.sequenceId);this.init=b("emptyFunction");b("Arbiter").subscribe(b("ChannelConstants").GET_RTI_SESSION_REQUEST,function(event,a){this.informCurrentSession()}.bind(this));b("Arbiter").subscribe(b("ChannelConstants").CONSOLE_LOG,function(a,b){!1});b("requestAnimationFrameAcrossTransitions")(function(){b("FantailLogger").info(b("ChannelConstants").FANTAIL_SERVICE,"using session id: %s at seq: %s {%s} with sticky: %s/%s",o.sessionID,o.seq,o.sequenceId,o.sticky_token,o.sticky_pool),b("UserActivity").subscribe(function(){var a=b("ChannelTransport").getURI(o,"/U");b("FantailLogger").info(b("ChannelConstants").FANTAIL_SERVICE,"user activity sessionid: %s at seq: %s/{%s} with sticky: %s/%s state: %s uri: %s",o.sessionID,o.seq,o.sequenceId,o.sticky_token,o.sticky_pool,h.state,a);h.state=="pull"&&(o.userActive=Date.now(),b("ChannelTransport").sendActivePing(o))}),b("Arbiter").subscribe(b("ChannelConstants").ENTITY_PRESENCE_ACTIVE_PING,function(a){a=b("ChannelTransport").getURI(o,"/U");b("FantailLogger").info(b("ChannelConstants").FANTAIL_SERVICE,"entity presence activity sessionid: %s at seq: %s/{%s} with sticky: %s/%s state: %s uri: %s",o.sessionID,o.seq,o.sequenceId,o.sticky_token,o.sticky_pool,h.state,a);h.state=="pull"&&(o.userActive=Date.now())})});b("PresenceCookieManager").register("ch",t);var d=this.getConfig("max_conn",2);o.subdomain=b("ChannelSubdomain").allocate(d);b("ChannelTransport").isSubdomain(o.subdomain)||(b("FantailLogger").info(b("ChannelConstants").FANTAIL_SERVICE,"invalid subdomain from ChannelSubdomain: %s",o.subdomain),o.subdomain=null);this._transportRate=new(b("MovingStat"))(3e4);var e=b("AjaxRequest").supportsCORS()?"CORSTransport":"IframeTransport";b("BanzaiODS").bumpEntityKey("ChannelManager","transport_chosen."+e);this.transport=new(b("ChannelTransport")[e])(this);l(this.transport);a&&this.enterState(a,c);b("requestAnimationFrameAcrossTransitions")(function(){b("Arbiter").subscribe(b("JSLogger").DUMP_EVENT,function(event,a){this._transportRate&&(a.transportRate=this._transportRate.tally(),a.transportType=e,a.transportVersion=2)}.bind(this)),u()}.bind(this));if(h.getConfig("fullHost")&&b("AjaxRequest").supportsCORS()){if(h.getConfig("tryStreaming")){d=o.MIN_INIT_PROBE_DELAY+b("Random").random()*o.INIT_PROBE_DELAY_RANDOMIZE_RANGE;b("setTimeoutAcrossTransitions")(this._probeTest,d)}if(h.getConfig("trySSEStreaming")){a=o.MIN_INIT_PROBE_DELAY+b("Random").random()*o.INIT_PROBE_DELAY_RANDOMIZE_RANGE;b("setTimeoutAcrossTransitions")(this._sseProbeTest,a)}}},configure:function(){for(var a=arguments.length,c=Array(a),d=0;d<a;d++)c[d]=arguments[d];j.log("configure",JSON.stringify(c));c.forEach(function(a){return Object.assign(o,a)});w("reconnect",JSON.stringify(c));b("Arbiter").inform(b("ChannelConstants").ON_CONFIG,this)},getConfig:function(a,b){return Object.prototype.hasOwnProperty.call(o,a)?o[a]:b},getCompleteConfig:function(){return o},subscribeIrisQueue:function(a,c){o.state.subscribeIrisQueue(a,c),this.exitState({status:b("ChannelConstants").OK,stateId:p})},unsubscribeIrisQueue:function(a){o.state.unsubscribeIrisQueue(a)},informCurrentSession:function(){var a=null;this.sessionRegistered&&o&&o.fullHost&&o.sticky_token&&o.uid&&(a=new(b("RTISession"))(o.fullHost,o.domain,o.port,o.sticky_pool,o.sticky_token,o.uid,o.viewerUid,o.profile,o.sessionID,o.capabilities));b("Arbiter").inform(b("ChannelConstants").RTI_SESSION,a)},isShutdown:function(){return this.state=="shutdown"},shouldIdle:function(){return!(b("SystemEvents").isPageOwner()&&b("SystemEvents").isOnline())},_sendIframeError:function(a){a=new(b("AsyncRequest"))().setURI("/ajax/presence/reconnect.php").setData({reason:a,fb_dtsg:b("DTSG").getToken()}).setOption("suppressErrorHandlerWarning",!0).setOption("retries",1).setMethod("GET").setReadOnly(!0).setAllowCrossPageTransition(!0);a.specifiesWriteRequiredParams()&&a.send()},_getDelay:function(){var a=Math.min(o.MIN_RETRY_INTERVAL*Math.pow(2,Math.max(0,r-1)),o.MAX_RETRY_INTERVAL);this.proxyDown&&"proxy_down_delay_millis"in o&&(a=o.proxy_down_delay_millis);this.proxyDown=!1;return Math.floor(a*(1+Math.random()*.5))},resetDelay:function(){v(!0)},enterState:function(){this._inEnterState&&(j.warn("enterstate_recursion",JSON.stringify({state:this.state,args:arguments})),b("ChatReliabilityInstrumentation").logERROR("enterstate_recursion"));this._inEnterState=!0;try{this._enterState.apply(this,arguments),this._inEnterState=!1}catch(a){this._inEnterState=!1;throw a}},_enterState:function(a){__p&&__p();var c=this.backoff?this._getDelay():0;this.backoff=!1;if(this.isShutdown()){b("FantailLogger").warn(b("ChannelConstants").FANTAIL_SERVICE,"not executing state due to shutdown mode: %s",a);return}if(a!="idle!"&&this.shouldIdle()){b("FantailLogger").warn(b("ChannelConstants").FANTAIL_SERVICE,"forced idleness");return}p++;o.stateId=p;b("clearTimeout")(this._deferredTransition);this._deferredTransition=null;!this.transport?(m.done(function(a){return a.enterState("idle")}),b("ChatReliabilityInstrumentation").logERROR("called enterState "+a+" before transport init")):this.transport.enterState("idle");this.state="idle";this.nextState=null;if(/!$/.test(a)){if(this._transportRate){var d=this._transportRate.tally().timeAverage,e=h.getConfig("MAX_CHANNEL_STATES_PER_SEC",1);d>=e&&(this._throttled||(this._throttled=!0,j.warn("throttled","{}"),b("Arbiter").inform(b("ChannelConstants").THROTTLED,d)),i.bump("throttle"),c=1e3/e)}}else/#$/.test(a)||(c=this._getDelay());a=a.replace(/\W*$/,"");if(!n[a]){b("FantailLogger").error(b("ChannelConstants").FANTAIL_SERVICE,"invalid state: %s",a);throw new Error("invalid state:"+a)}var f=Array.from(arguments),g;if(c<=0){g={state:a};this._transportRate&&this._transportRate.add(1);this.state=a;var k=this["_enter_"+this.state];k&&(f.shift(),k.apply(this,f));/init|idle|pull|ping/.test(this.state)&&(o.streamingCapable&&/pull/.test(this.state)&&(this.heartbeats=[]),o.is_offline=!b("ChatVisibility").isOnline(),o.capabilities=b("FBRTCSupport").getCapabilities(),b("FantailLogger").info(b("ChannelConstants").FANTAIL_SERVICE,"entering transport state: %s",this.state),!this.transport?(m.done(function(a){return a.enterState(this.state,o)}.bind(this)),b("ChatReliabilityInstrumentation").logERROR("called enterState "+a+" before transport init")):this.transport.enterState(this.state,o),this.state=="ping"&&(g.url=b("ChannelTransport").getURI(o).toString(),g.port=o.port||"undefined"))}else this.state="idle",this.nextState=a,g={state:this.state,delay:c,nextState:a},f[0]=a+"#",this._deferredTransition=b("setTimeoutAcrossTransitions")(function(){this._deferredTransition=null,this.enterState.apply(this,f)}.bind(this),c);/pull/.test(a)&&(g.client_id=o.sessionID,g.streaming=o.inStreaming);b("Arbiter").inform(b("ChannelConstants").ON_ENTER_STATE,g)},exitState:function(a,c){__p&&__p();var d=a.stateId,e=a.status;if(this.isShutdown()||d<p)return;var f=this.state,g=Array.from(arguments);g[0]=a.status;var h={state:f,status:e};/pull/.test(f)&&(h.client_id=o.sessionID,h.streaming=o.inStreaming);/ping/.test(f)&&e!=b("ChannelConstants").OK&&(h.url=b("ChannelTransport").getURI(o).toString());this.nextState&&(h.nextState=this.nextState);c&&c.errorType?(o.lastRequestErrorReason=c.errorType,h.xhr=c.toJSON?c.toJSON():c,c.errorType==b("AjaxRequest").SERVICE_UNAVAILABLE&&(b("FantailLogger").error(b("ChannelConstants").FANTAIL_SERVICE,"got 5xx http status code, setting long delay"),this.proxyDown=!0),delete h.xhr.json):e!=b("ChannelConstants").OK&&(o.lastRequestErrorReason=e);c&&c.json&&(c.json.t&&(h.t=c.json.t),c.json.reason&&(h.reason=c.json.reason),c.json.seq&&(h.seq=c.json.seq));b("Arbiter").inform(b("ChannelConstants").ON_EXIT_STATE,h);var i=this["_exit_"+f];i&&(e=i.apply(this,g)||e);e!=b("ChannelConstants").OK&&(v(),q[f]=(q[f]||0)+1);var k=n[this.nextState||f][e]||n._all[e],l=k&&k.replace(/!*$/,"");l||(j.error("terminal_transition",JSON.stringify(h)),this._shutdownHint=b("ChannelConstants").HINT_INVALID_STATE,k="shutdown!",b("FantailLogger").error(b("ChannelConstants").FANTAIL_SERVICE,"entering shutdown state"));this._lastState=f;this._lastStatus=e;this.enterState(k)},_processTransportData:function(a,b){this._processTransportData0(a,b,b.json)},_processTransportData0:function(a,c,d){__p&&__p();var e=d.t;"s"in d&&(d.seq=d.s,delete d.s);if(d.u&&o.user&&d.u!=o.user){j.warn("misguided_msg",JSON.stringify({user:o.user,target:d.u}));this._reportProxyMisguidedMsg(d.u,o.user);return}b("ChannelTransportDataLogger").log(d);var f=o.seq;"seq"in d&&(o.seq=d.seq,b("PresenceState").doSync());switch(e){case"continue":o.inStreaming&&this.heartbeats.length<1&&(o.streamingCapable=!1,j.log("switch_to_longpoll","{}"),b("setTimeoutAcrossTransitions")(this._probeTest,o.PROBE_DELAY));v(!0);(!o.inStreaming||o.STREAMING_EXIT_STATE_ON_CONTINUE)&&this.exitState({status:b("ChannelConstants").OK,stateId:a});break;case"refresh":case"refreshDelay":b("FantailLogger").info(b("ChannelConstants").FANTAIL_SERVICE,"got refresh with reason: %s",d.reason);this.exitState({status:"refresh_"+(d.reason||0),stateId:a},c);break;case"backoff":b("FantailLogger").warn(b("ChannelConstants").FANTAIL_SERVICE,"server told client to back off");v();this.backoff=!0;break;case"lb":var g=d.lb_info;if(g){o.sticky_token=g.sticky;"pool"in g&&(o.sticky_pool=g.pool);if("sd"in g){var h=g.subdomain;b("ChannelTransport").isSubdomain(h)&&(o.subdomain=g.subdomain)}"vip"in g&&(o.host=g.vip);w("chatproxy",JSON.stringify(d))}else j.error("missing_lb_info","{}");break;case"test_streaming":b("setTimeoutAcrossTransitions")(this._probeTest,500);break;case"fullReload":b("PresenceCookieManager").clear();j.log("full_reload","{}");this.sessionRegistered=!0;this.informCurrentSession();b("Arbiter").inform(b("ChannelConstants").ON_INVALID_HISTORY);v(!0);b("FantailLogger").info(b("ChannelConstants").FANTAIL_SERVICE,"full reload incurred");h=b("ChannelConstants").OK;this.exitState({status:h,stateId:a},c);"ms"in d&&this._processMessages(d,f);break;case"msg":v(!0);this._processMessages(d,f);break;case"heartbeat":if(o.inStreaming){g=Date.now();if(this.heartbeats.length>0)var i=g-this.heartbeats[this.heartbeats.length-1];j.log("heartbeat_interval",JSON.stringify({client_id:o.sessionID,interval:i}));this.heartbeats.push(g)}break;case"batched":h=d.batches;for(f=0;f<h.length;f++)this._processTransportData0(a,c,h[f]);break;default:b("FantailLogger").error(b("ChannelConstants").FANTAIL_SERVICE,"got an unknown protocol message: %s",e);j.error("unknown_msg_type",JSON.stringify({type:e}));break}},_processMessages:function(a,c){__p&&__p();var d,e,f;"tr"in a&&(o.trace_id=a.tr);a=a.ms;e=o.seq-a.length;for(d=0;d<a.length;d++,e++){o.estimatedReceived++;if(e>=c){f=a[d];if(f.type){var g=b("ChannelConstants").getArbiterType(f.type);if(f.type==="messaging"){var h={type:"messaging",event:f.event};f.message&&(h.inbox_unread=f.unread_counts&&f.unread_counts.inbox,h.tid=f.message.tid,h.mid=f.message.mid,b("FantailLogger").info(b("ChannelConstants").FANTAIL_SERVICE,"got message with id: %s",f.message.mid))}else f.type==="skywalker"?g=b("ChannelConstants").SKYWALKER:f.type==="qprimer"?(f.first=!o.ready,f.first&&(o.ready=!0,o.timeUntilReady=Date.now()-o.created,o.queueMade=f.made),g=b("ChannelConstants").CHANNEL_ESTABLISHED):f.type==="pws"?o.pws=f.pws:f.type==="delta"&&(o.sequenceId=f.iseq);try{b("Arbiter").inform(g,{obj:f})}catch(a){b("BanzaiODS").bumpEntityKey("ChannelManager","processMessages.error."+f.type),b("FantailLogger").info(b("ChannelConstants").FANTAIL_SERVICE,"message threw exception: %s %s",a,f)}}}else j.warn("seq_regression",JSON.stringify({last_seq:c,messages:a.length,seq:e}))}},_enter_init:function(){if(q.init>=h.getConfig("MAX_INIT_FAILS",2))return b("setTimeoutAcrossTransitions")(function(){return this.exitState({status:b("ChannelConstants").ERROR_MAX,stateId:p})}.bind(this),0);this._initTimer=b("setTimeoutAcrossTransitions")(function(){return this.exitState({status:b("ChannelConstants").ERROR,stateId:p},"timeout")}.bind(this),o.IFRAME_LOAD_TIMEOUT)},_enter_reconnect:function(a){__p&&__p();j.warn("enter_reconnect",a);b("FantailLogger").info(b("ChannelConstants").FANTAIL_SERVICE,"entered reconnect with reason: %s",a);var c=p;if(!b("PresenceUtil").hasUserCookie()){b("FantailLogger").warn(b("ChannelConstants").FANTAIL_SERVICE,"user has no cookie???");j.warn("no_user_cookie","{}");b("setTimeoutAcrossTransitions")(function(){this._shutdownHint=b("ChannelConstants").HINT_AUTH,this.exitState({status:b("ChannelConstants").ERROR_SHUTDOWN,stateId:c})}.bind(this),0);return}a={reason:a,fb_dtsg:b("DTSG").getToken()};b("ISB").token&&(a.fb_isb=b("ISB").token);k&&k(a);var d=new(b("FBAjaxRequest"))("GET","/ajax/presence/reconnect.php",a);d.onSuccess=function(){h.configure(d.json),b("PresenceCookieManager").store(),this.exitState({status:b("ChannelConstants").OK,stateId:c})}.bind(this);d.onError=function(){var a=d.json&&d.json.error;b("FantailLogger").error(b("ChannelConstants").FANTAIL_SERVICE,"reconnect error: %s",d.errorType);(d.errorType==b("AjaxRequest").TRANSPORT_ERROR||d.errorType==b("AjaxRequest").PROXY_ERROR||d.errorType==b("AjaxRequest").SERVICE_UNAVAILABLE)&&(this._shutdownHint=b("ChannelConstants").HINT_CONN);a&&a==1356007?this._shutdownHint=b("ChannelConstants").HINT_MAINT:a==1357001||a==1357004||a==1348009?this._shutdownHint=b("ChannelConstants").HINT_AUTH:this._shutdownHint=null;this.exitState({status:this._shutdownHint?b("ChannelConstants").ERROR_SHUTDOWN:b("ChannelConstants").ERROR,stateId:c},d)}.bind(this);d.send()},_enter_shutdown:function(){b("Arbiter").inform(b("ChannelConstants").ON_SHUTDOWN,{reason:this._shutdownHint});if("shutdown_recovery_interval_seconds"in o&&o.shutdown_recovery_interval_seconds>0){var a=o.shutdown_recovery_interval_seconds*1e3;b("setTimeoutAcrossTransitions")(function(){b("Arbiter").inform(b("ChannelConstants").ATTEMPT_RECONNECT),this._shutdownHint=null,this.state="reconnect!",this.enterState("reconnect!")}.bind(this),a)}},_exit_init:function(a){this._initTimer&&(this._initTimer=b("clearTimeout")(this._initTimer)),a==b("ChannelConstants").ERROR_MAX&&this._sendIframeError(b("ChannelConstants").reason_IFrameLoadGiveUp)},_exit_pull:function(a,c){var d=a==b("ChannelConstants").OK;if(d)this.lastPullTime=Date.now();else{d="exit status: "+a;c&&c.errorType&&(d+=" ajax request error: "+c.errorType);b("FantailLogger").error(b("ChannelConstants").FANTAIL_SERVICE,"pull failed with status: %s",d)}},_exit_ping:function(a){if(a==b("ChannelConstants").OK){var c=Date.now()-(this.lastPullTime||b("Env").start);if(c>o.STALL_THRESHOLD){b("FantailLogger").error(b("ChannelConstants").FANTAIL_SERVICE,"didnt complete a successful pull for too long");return b("ChannelConstants").ERROR_STALE}}else b("FantailLogger").error(b("ChannelConstants").FANTAIL_SERVICE,"ping failed with status: %s",a)},_reportProxyMisguidedMsg:function(a,c){__p&&__p();b("FantailLogger").error(b("ChannelConstants").FANTAIL_SERVICE,"misguided message to %s meant for %s",c,a);var d=Date.now();if(d-this.lastReportOnMisguidedMsgTime<=o.CHANNEL_PROXY_REPORTING_MIN_INTERVAL)return;this.lastReportOnMisguidedMsgTime=d;d={received_uid:a,expected_uid:c};o.sticky_token&&(d.sticky_token=o.sticky_token);a=new(b("URI"))("/err_misguided_msg").setDomain(o.host+"."+o.domain).setPort(o.port).setSecure(new(b("URI"))(window.location.href).isSecure()).setQueryData(d);c=new(b("AjaxRequest"))("GET",a);b("AjaxRequest").supportsCORS()&&(c.xhr.withCredentials=!0);c.onSuccess=function(a){};c.onError=function(a){};c.onJSON=function(a,b){};c.send()},_probeTest:function(){__p&&__p();o.streamingCapable=!1;var a=[],c={mode:"stream",format:"json"};o.sticky_token&&(c.sticky_token=o.sticky_token);c=new(b("URI"))("/probe").setDomain(o.fullHost+"."+o.domain).setPort(o.port).setSecure(new(b("URI"))(window.location.href).isSecure()).setQueryData(c);b("BanzaiODS").bumpEntityKey("ChannelManager","probe.attempt");c=new(b("AjaxRequest"))("GET",c);c.onJSON=function(c,d){if(c&&c.json&&c.json.t==="heartbeat"){a.push(Date.now());if(a.length>=2){d=a[1]-a[0];d>=o.PROBE_HEARTBEATS_INTERVAL_LOW&&d<=o.PROBE_HEARTBEATS_INTERVAL_HIGH?(o.streamingCapable=!0,b("BanzaiODS").bumpEntityKey("ChannelManager","probe.switch_to_streaming"),j.log("switch_to_streaming","{}")):b("BanzaiODS").bumpEntityKey("ChannelManager","probe.failure.delayed")}}};c.onSuccess=function(c){a.length!=2&&(o.streamingCapable=!1,b("BanzaiODS").bumpEntityKey("ChannelManager","probe.failure.data_loss"),j.error("probe_error",JSON.stringify({error:"beats.length = "+a.length}))),b("BanzaiODS").bumpEntityKey("ChannelManager","probe.success"),j.log("probe_success","{}")};c.onError=function(a){o.streamingCapable=!1,b("BanzaiODS").bumpEntityKey("ChannelManager","probe.failure.error"),j.error("probe_error",JSON.stringify(a))};c.send()},_sseProbeTest:function(){__p&&__p();if(!window.EventSource){b("BanzaiODS").bumpEntityKey("ChannelManager","sse_probe.failure.no_event_source");j.log("sse_probe.failure.no_event_source","{}");return}var a=[],c={mode:"sse",format:"json"};o.sticky_token&&(c.sticky_token=o.sticky_token);c=new(b("URI"))("/sse_probe").setDomain(o.fullHost+"."+o.domain).setPort(o.port).setSecure(new(b("URI"))(window.location.href).isSecure()).setQueryData(c);b("BanzaiODS").bumpEntityKey("ChannelManager","sse_probe.attempt");var d=new EventSource(c),e=b("setTimeoutAcrossTransitions")(function(){d.close(),b("BanzaiODS").bumpEntityKey("ChannelManager","sse_probe.failure.timeout"),j.log("sse_probe.failure.timeout","{}")},o.PROBE_HEARTBEATS_INTERVAL_HIGH*6);d.addEventListener("heartbeat",function(c){a.push(Date.now());if(a.length>=2){c=a[1]-a[0];c>=o.PROBE_HEARTBEATS_INTERVAL_LOW&&c<=o.PROBE_HEARTBEATS_INTERVAL_HIGH?(b("BanzaiODS").bumpEntityKey("ChannelManager","sse_probe.success"),j.log("sse_probe.success","{}")):(b("BanzaiODS").bumpEntityKey("ChannelManager","sse_probe.failure.delayed"),j.log("sse_probe.failure.delayed","{}"));b("clearTimeout")(e);d.close()}});d.onerror=function(a){b("BanzaiODS").bumpEntityKey("ChannelManager","sse_probe.failure.error"),j.error("sse_probe.failure.error",JSON.stringify(a)),b("clearTimeout")(e),d.close()}},startChannelManagerForApp:function(a){h.startChannelManager!==b("emptyFunction")&&h.startChannelManager(),b("ChannelInitialData").channelConfig&&o&&(o.profile=a)},startChannelManager:function(){b("ChannelInitialData").channelConfig?(h.configure(b("ChannelInitialData").channelConfig),/shutdown/.test(b("ChannelInitialData").state)&&(h._shutdownHint=b("ChannelConstants")[b("ChannelInitialData").reason]),h.init(b("ChannelInitialData").state,b("ChannelInitialData").reason),b("ChatReliabilityInstrumentation").logCHANNEL_INIT(),this.startChannelManager=b("emptyFunction")):b("ChatReliabilityInstrumentation").logCHANNEL_NOCONFIG()}};e.exports=h}),null);
__d("cssURL",[],(function(a,b,c,d,e,f){function a(a){return"url('"+a.replace(/[\ud800-\udfff].|[^-a-zA-Z0-9./_?]/g,function(a){return"\\"+a.codePointAt().toString(16)+" "})+"')"}e.exports=a}),null);
__d("timeString",["fbt","DateConsts"],(function(a,b,c,d,e,f,g){__p&&__p();var h=b("DateConsts").SEC_PER_MIN,i=b("DateConsts").SEC_PER_HOUR,j=b("DateConsts").SEC_PER_DAY,k=b("DateConsts").SEC_PER_YEAR,l=b("DateConsts").MS_PER_SEC;function m(a){var b,c;a<10?b=g._("just now"):a<h?b=g._("a few seconds ago"):a<h*2?b=g._("about a minute ago"):a<i?(c=Math.floor(a/h),b=g._("{number} minutes ago",[g._param("number",c)])):a<i*2?b=g._("about an hour ago"):a<j?(c=Math.floor(a/i),b=g._("{number} hours ago",[g._param("number",c)])):a<j*2?b=g._("about a day ago"):a<j*30?(c=Math.floor(a/j),b=g._("{number} days ago",[g._param("number",c)])):a<j*30*2?b=g._("about a month ago"):a<k?(c=Math.floor(a/j/30),b=g._("{number} months ago",[g._param("number",c)])):a<k*2?b=g._("over a year ago"):(c=Math.floor(a/k),b=g._("{number} years ago",[g._param("number",c)]));return b}function n(a){var b,c;a=Math.abs(a);a<10?b=g._("just now"):a<h?b=g._("in a few seconds"):a<h*2?b=g._("in about a minute"):a<i?(c=Math.floor(a/h),b=g._("in {number} minutes",[g._param("number",c)])):a<i*2?b=g._("in about an hour"):a<j?(c=Math.floor(a/i),b=g._("in {number} hours",[g._param("number",c)])):a<j*2?b=g._("in about a day"):a<j*30?(c=Math.floor(a/j),b=g._("in {number} days",[g._param("number",c)])):a<j*30*2?b=g._("in about a month"):a<k?(c=Math.floor(a/j/30),b=g._("in {number} months",[g._param("number",c)])):a<k*2?b=g._("in over a year"):(c=Math.floor(a/k),b=g._("in {number} years",[g._param("number",c)]));return b}function a(a,b){b=b||Date.now();b=Math.floor((b-a)/l);if(b>=0)return m(b);else return n(b)}e.exports=a}),null);
__d("createChunkedResponseParser",["invariant"],(function(a,b,c,d,e,f,g){"use strict";__p&&__p();var h="\r\n",i=2;function a(a,b){__p&&__p();var c=0,d=function(d,e,f){__p&&__p();b&&(d=b(d),d==null||typeof d==="string"||g(0));if(d){var j=d.length;while(c<j){var k=d.indexOf(h,c);if(k<0)if(f)k=j;else break;k=d.slice(c,k);c+=k.length+i;a(k,e,f&&c>=j)}}else f&&a("",e,!0)};d.parseStreaming=!0;return d}e.exports=a}),null);
__d("XVideoHomeShowController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/watch/{?section_id}/",{badge_count:{type:"Int"},from:{type:"String"},section_id:{type:"String"},query:{type:"String"},video_id:{type:"String"},upstream_player_source:{type:"Enum",enumType:1},start_timestamp_s:{type:"Int"},autoplay_expanded:{type:"Bool",defaultValue:!1}})}),null);