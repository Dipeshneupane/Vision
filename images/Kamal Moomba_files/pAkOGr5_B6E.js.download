if (self.CavalryLogger) { CavalryLogger.start_js(["fE\/jf"]); }

__d("ImageUtils",["UserAgent_DEPRECATED"],(function(a,b,c,d,e,f){__p&&__p();a={hasLoaded:function(a){__p&&__p();if(a.naturalWidth!==undefined)return a.complete&&a.width!==0;else if(a.height==20&&a.width==20&&a.complete)return!1;else if(a.complete===undefined&&b("UserAgent_DEPRECATED").webkit()<500){var c=new Image();c.src=a.src;return c.complete}return a.complete}};e.exports=a}),null);
__d("PhotoEverstoreLogger",["AsyncRequest","Event","ImageUtils"],(function(a,b,c,d,e,f){__p&&__p();var g={BATCH_WINDOW_MS:500,storedLog:[]};function h(){}Object.assign(h,{_log:function(a){g.storedLog.push(a),g.storedLog.length==1&&setTimeout(i,g.BATCH_WINDOW_MS)},logImmediately:function(a){h._log(a)},registerForLogging:function(a){var c=document.getElementById(a);c!=null&&(b("ImageUtils").hasLoaded(c)?h._log(c.src):b("Event").listen(c,"load",function(event){h._log(c.src)}))}});function i(){var a=g.storedLog;g.storedLog=[];a=JSON.stringify(a);new(b("AsyncRequest"))().setURI("/ajax/photos/logging/everstore_logging.php").setData({loggedUrls:a}).setMethod("POST").setOption("suppressErrorHandlerWarning",!0).setOption("suppressErrorAlerts",!0).send()}e.exports=h}),null);
__d("PhotoViewerImage",["PhotoEverstoreLogger","URI","Vector"],(function(a,b,c,d,e,f){__p&&__p();function g(a){"use strict";this._hiResDimensions=a.hiResDimensions&&b("Vector").deserialize(a.hiResDimensions),this._normalDimensions=a.normalDimensions&&b("Vector").deserialize(a.normalDimensions),this._info=a.info,this._video=a.video,this._shouldLog=a.everstoreLogThis,this._hiResSrc=a.hiResSrc,this._normalSrc=a.normalSrc,this._thumbSrc=a.thumbSrc,this._isInverted=!1,this._data=a}g.prototype.getURIString=function(){"use strict";return new(b("URI"))(this._info.permalink).getUnqualifiedURI().toString()};g.prototype.hasHiResDimensions=function(){"use strict";return!!this._hiResDimensions};g.prototype.getHiResDimensions=function(){"use strict";return this._hiResDimensions};g.prototype.getNormalDimensions=function(){"use strict";return this._normalDimensions};g.prototype.getHiResSrc=function(){"use strict";return this._hiResSrc};g.prototype.getNormalSrc=function(){"use strict";return this._normalSrc};g.prototype.getThumbSrc=function(){"use strict";return this._thumbSrc};g.prototype.getInfo=function(){"use strict";return this._info};g.prototype.getPermalink=function(){"use strict";return this._info.permalink};g.prototype.getHighestResSrc=function(){"use strict";return this._hiResSrc||this._normalSrc};g.prototype.preload=function(a){"use strict";var c;this.getHighestResSrc()&&(a&&!this._resource?(this._resource=new Image(),this._resource.src=this.getHighestResSrc(),c=this._resource.src,this._shouldLog&&b("PhotoEverstoreLogger").logImmediately(this._resource.src)):!a&&!this._small&&(this._small=new Image(),this._small.src=this._normalSrc||this._hiResSrc,c=this._small.src,this._shouldLog&&b("PhotoEverstoreLogger").logImmediately(this._small.src)));return c};g.prototype.setNormalDimensions=function(a,c){"use strict";this._normalDimensions=new(b("Vector"))(a,c)};g.prototype.setHiResDimensions=function(a,c){"use strict";this._hiResDimensions=new(b("Vector"))(a,c)};g.prototype.invertDimensions=function(){"use strict";this.hasHiResDimensions()&&(this._hiResDimensions=new(b("Vector"))(this._hiResDimensions.y,this._hiResDimensions.x)),this._normalDimensions=new(b("Vector"))(this._normalDimensions.y,this._normalDimensions.x),this._isInverted=!this._isInverted};g.prototype.copy=function(){"use strict";return new g(this._data)};e.exports=g}),null);
__d("PhotosConst",[],(function(a,b,c,d,e,f){a={VIEWER_PERMALINK:0,VIEWER_SNOWLIFT:6,VIEWER_VAULTBOX:8,VIEWER_SNOWFLAKE:14,VIEWER_COMPOSER:16,VIEWER_CAROUSEL:19,VIEWER_SPHERICAL:20,VIEWER_PERMALINK_STRING:"permalink",VIEWER_SNOWLIFT_STRING:"snowlift",VIEWER_VAULTBOX_STRING:"vaultbox",VIEWER_CAROUSEL_STRING:"carousel",BULK_EDITOR:3,BULK_EDITOR_REACT:15,EDITOR_MODAL:17,FLASH_UPLOADER:4,HTML5_UPLOADER:10,SIZE_NORMAL:"n",PIC_NORMAL_FBX_SIZE:180,ALBUM_NAME_MAXLEN:65};e.exports=a}),null);
__d("PhotoStreamCache",["DOM","HTML","PhotoEverstoreLogger","PhotosConst","PhotoViewerImage","Rect","UIPagelet","URI","Vector","ge"],(function(a,b,c,d,e,f){__p&&__p();function g(){"use strict"}g.prototype.init=function(a,b,c,d,e){"use strict";this.version=a,this.pageletName=b,this.pageletRootID=c,this.tagSuggestionMode=e,this.bufferSize=g.BUFFER_SIZE,this.fullBucketSize=g.FULL_BUCKET_SIZE,this.initError=!1,this.isActive=!0,this.usesOpaqueCursor=!1,this.usesNonCircularPhotoSet=!1,this.reachedLeftEnd=!1,this.reachedRightEnd=!1,this.leftLock=!1,this.rightLock=!1,this.useAjaxPipe=!0,this.logger=d,this.viewAsUser=null,this.reset()};g.prototype.setViewAs=function(a){"use strict";this.viewAsUser=a};g.prototype.isInViewAsMode=function(){"use strict";return!!this.viewAsUser};g.prototype.getViewAsUserId=function(){"use strict";return this.viewAsUser};g.prototype.getUsesOpaqueCursor=function(){"use strict";return this.usesOpaqueCursor};g.prototype.isNonCircularPhotoSet=function(){"use strict";return this.usesNonCircularPhotoSet};g.prototype.setReachedLeftEnd=function(){"use strict";this.reachedLeftEnd=!0};g.prototype.setReachedRightEnd=function(){"use strict";this.reachedRightEnd=!0};g.prototype.hasReachedLeftEnd=function(){"use strict";return this.reachedLeftEnd};g.prototype.hasReachedRightEnd=function(){"use strict";return this.reachedRightEnd};g.prototype.nonCircularPhotoSetCanPage=function(a){"use strict";if(!this.isNonCircularPhotoSet())return!0;if(a<0)return this.getCursorPos()||!this.hasReachedLeftEnd();return a>0?this.getLength()-1!=this.getCursorPos()||!this.hasReachedRightEnd():!0};g.prototype.setUseAjaxPipe=function(a){"use strict";this.useAjaxPipe=a};g.prototype.reset=function(){"use strict";this.cache={image:{},extra:{},html:{}},this.fbidList=[],this.loaded=!1,this.allLoaded=!1,this.permalinkMap={},this.position=0,this.totalCount=null,this.firstCursor=null,this.firstCursorIndex=null,this.firstOpaqueCursor=null};g.prototype.waitForInitData=function(){"use strict";this.fbidList.push(g.INIT_PLACEHOLDER)};g.prototype.destroy=function(){"use strict";this.reset(),this.isActive=!1};g.prototype.isLoaded=function(){"use strict";return this.loaded};g.prototype.canPage=function(){"use strict";if(!this.isLoaded())return!1;if(this.totalCount!==null)return this.totalCount>1;return this.usesNonCircularPhotoSet?!0:this.getLength()>1};g.prototype.errorInCurrent=function(){"use strict";if(this.initError)return!0;else if(!this.isLoaded())return!1;return this.checkErrorAt(this.getCursor())};g.prototype.getLength=function(){"use strict";return this.fbidList.length};g.prototype.getPhotoSet=function(){"use strict";return this.photoSetQuery.set};g.prototype.getPhotoSetQuery=function(){"use strict";return this.photoSetQuery};g.prototype.getCurrentImageData=function(){"use strict";return this.getImageData(this.getCursor())};g.prototype.getNextImageData=function(){"use strict";if(!this.fbidList||!this.fbidList.length)return null;var a=(this.position+1)%this.fbidList.length;return this.getImageData(this.getCursorAt(a))};g.prototype.getPreviousImageData=function(){"use strict";if(!this.fbidList||!this.fbidList.length)return null;var a=this.fbidList.length;a=(this.position+a-1)%a;return this.getImageData(this.getCursorAt(a))};g.prototype.addViewAsToURI=function(a){"use strict";a=new(b("URI"))(a);this.isInViewAsMode()&&a.addQueryData({viewas:this.getViewAsUserId()});return a};g.prototype.getOpaqueCursor=function(a){"use strict";if(this.getImageData(a))return this.version===b("PhotosConst").VIEWER_VAULTBOX?this.getImageData(a).getInfo().opaquecursor:this.getImageData(a).info.opaquecursor;return a==this.firstCursor?this.firstOpaqueCursor:null};g.prototype.getImageData=function(a){"use strict";a=this.getCacheContent(a,g.IMAGE_DATA);a&&(a.info.permalink=this.addViewAsToURI(a.info.permalink));return a};g.prototype.getCurrentHtml=function(){"use strict";return this.getCacheContent(this.getCursor(),g.HTML)};g.prototype.getCurrentExtraData=function(){"use strict";return this.getCacheContent(this.getCursor(),g.EXTRA)};g.prototype.getCacheContent=function(a,b){"use strict";return!a||a===g.ERROR_ID||a===g.INIT_PLACEHOLDER?null:this.cache[b][a]};g.prototype.getCursorPos=function(){"use strict";return this.position};g.prototype.getCursor=function(){"use strict";return this.position>=0&&this.position<this.getLength()?this.fbidList[this.position]:null};g.prototype.getCursorAt=function(a){"use strict";return this.fbidList[a]};g.prototype.getCursorForURI=function(a){"use strict";return this.permalinkMap[a]};g.prototype.calculatePositionForMovement=function(a){"use strict";a=this.position+a;if(this.allLoaded){var b=this.getLength();a=(b+a%b)%b}return a};g.prototype.isValidMovement=function(a){"use strict";if(!this.isLoaded()||!this.canPage())return!1;a=this.calculatePositionForMovement(a);return this.getCursor()>0||a>=0&&a<this.getLength()};g.prototype.moveCursor=function(a){"use strict";if(!this.isValidMovement(a))return;this.position=this.calculatePositionForMovement(a);a!==0&&this.loadMoreIfNeccessary(a>0)};g.prototype.checkErrorAt=function(a){"use strict";if(!this.isLoaded())return!1;return a===g.ERROR_ID?!0:!1};g.prototype.getRelativeMovement=function(a){"use strict";for(var b=0;b<this.getLength();b++)if(this.fbidList[b]==a)return b-this.position;return null};g.prototype.preloadImages=function(a){"use strict";var c,d=this.getLength(),e=this.cache.image,f=g.BUFFER_SIZE;d>f*2?(c=(this.position+d-f%d)%d,f=(this.position+f)%d):(c=0,f=d-1);while(c!=f){var h,i=this.fbidList[c],j=a&&a(e[i]);this.version===b("PhotosConst").VIEWER_VAULTBOX?h=e[i]&&e[i].preload(j):e[i]&&e[i].url&&(j&&!e[i].resource?(e[i].resource=new Image(),e[i].resource.src=e[i].url,h=e[i].url,e[i].everstoreLogThis===!0&&b("PhotoEverstoreLogger").logImmediately(e[i].resource.src)):!j&&!e[i].small&&(e[i].small=new Image(),e[i].small.src=e[i].smallurl||e[i].url,h=e[i].small.src,e[i].everstoreLogThis===!0&&b("PhotoEverstoreLogger").logImmediately(e[i].small.src)));this.logger&&h&&this.logger.log(h);c=(c+1)%d}};g.prototype.loadMoreIfNeccessary=function(a){"use strict";if(this.allLoaded||a&&this.rightLock||!a&&this.leftLock)return;a=a?1:-1;a=this.position+this.bufferSize*a;a<0&&!this.checkErrorAt(this.getEndCursor(!1))?(this.leftLock=!0,this.fetch(this.fullBucketSize,!1)):a>this.getLength()&&!this.checkErrorAt(this.getEndCursor(!0))&&(this.rightLock=!0,this.fetch(this.fullBucketSize,!0))};g.prototype.getEndCursor=function(a){"use strict";return a?this.fbidList[this.getLength()-1]:this.fbidList[0]};g.prototype.calculateRelativeIndex=function(a,b,c){"use strict";if(!this.totalCount)return null;b=this.fbidList.indexOf(b);c=this.fbidList.indexOf(c);if(b===-1||c===-1)return null;c=c-b;return(a+c+this.totalCount)%this.totalCount};g.prototype.calculateDistance=function(a,b){"use strict";a=this.fbidList.indexOf(a);b=this.fbidList.indexOf(b);return a===-1||b===-1?null:(b-a+this.getLength())%this.getLength()};g.prototype.fetch=function(a,c){"use strict";var d=this.getEndCursor(c);c=babelHelpers["extends"]({cursor:d,version:this.version,end:this.getEndCursor(!c),fetchSize:c?a:-1*a,relevant_count:this.relevantCount,opaqueCursor:this.getOpaqueCursor(d),tagSuggestionMode:this.tagSuggestionMode,is_from_groups:this.isFromGroups},this.photoSetQuery);this.isInViewAsMode()&&(c.viewas=this.getViewAsUserId());this.totalCount&&this.firstCursorIndex!==null&&(c.total=this.totalCount,c.cursorIndex=this.calculateRelativeIndex(this.firstCursorIndex,this.firstCursor,d));a=b("ge")(this.pageletRootID);a||(!1,a=b("DOM").create("div",{id:this.pageletRootID}),b("DOM").appendContent(document.body,a));b("UIPagelet").loadFromEndpoint(this.pageletName,a,c,{usePipe:this.useAjaxPipe,automatic:!0,jsNonblock:!0,crossPage:!0});this.useAjaxPipe||this.setUseAjaxPipe(!0)};g.prototype.storeToCache=function(a){"use strict";__p&&__p();var b={};if(!this.isActive)return b;if("error"in a){this.processErrorResult(a.error);b.error=!0;return b}"init"in a&&(this.processInitResult(a.init),b.init={logids:a.init.logids,fbid:a.init.fbid,loggedin:a.init.loggedin,fromad:a.init.fromad,withinbusiness:a.init.withinbusiness,eid:a.init.eid});"image"in a&&(this.processImageResult(a.image),b.image=!0);"data"in a&&(this.processDataResult(a.data),b.data=!0);return b};g.prototype.processInitResult=function(a){"use strict";__p&&__p();if(this.loaded)return;this.usesOpaqueCursor=a.usesopaquecursor;this.usesNonCircularPhotoSet=a.isnoncircularphotoset;this.setIsFromGroups(a.is_from_groups);this.loaded=!0;this.photoSetQuery=a.query;a.bufferSize&&(this.bufferSize=a.bufferSize);a.fullBucketSize&&(this.fullBucketSize=a.fullBucketSize);if(this.fbidList.length===0)this.fbidList.push(a.fbid),this.rightLock=!0;else{var c=this.fbidList.indexOf(g.INIT_PLACEHOLDER);c!=-1&&(this.fbidList[c]=a.fbid)}this.firstCursor=a.fbid;this.firstOpaqueCursor=a.opaquecursor;"initIndex"in a&&"totalCount"in a&&(this.firstCursorIndex=a.initIndex,this.totalCount=a.totalCount);if(this.version==b("PhotosConst").VIEWER_PERMALINK){c=a.initialBucketSize?a.initialBucketSize:g.INIT_BUCKET_SIZE;this.fetch(c,!0)}};g.prototype.processImageResult=function(a){"use strict";__p&&__p();for(var c in a){c===this.firstCursor&&a[c].everstoreLogThis&&b("PhotoEverstoreLogger").logImmediately(a[c].url);if(this.version===b("PhotosConst").VIEWER_VAULTBOX){var d=a[c];this.cache.image[c]=new(b("PhotoViewerImage"))(d);this.permalinkMap[this.cache.image[c].getURIString()]=c}else this.cache.image[c]=a[c],a[c].dimensions&&(this.cache.image[c].dimensions=b("Vector").deserialize(a[c].dimensions)),a[c].originalDimensions&&(this.cache.image[c].originalDimensions=b("Vector").deserialize(a[c].originalDimensions)),a[c].smalldims&&(this.cache.image[c].smalldims=b("Vector").deserialize(a[c].smalldims)),this.permalinkMap[new(b("URI"))(a[c].info.permalink).getUnqualifiedURI().toString()]=c}};g.prototype.attachToFbidsList=function(a,b,c){"use strict";__p&&__p();if(this.allLoaded)return;if(this.fbidList.length===1)for(var d=0;d<a.length;d++)if(this.fbidList.indexOf(a[d])!==-1)return;if(b===-1){for(var d=a.length-1;d>=0;d--)this.fbidList.unshift(a[d]),this.position++;this.leftLock=!1}else{for(var b=0;b<a.length;b++)this.fbidList.push(a[b]);this.rightLock=!1}c&&this.setAllLoaded()};g.prototype.setAllLoaded=function(){"use strict";this.allLoaded=!0,this.getCursor()===null&&(this.position=this.calculatePositionForMovement(0))};g.prototype.processDataResult=function(a){"use strict";__p&&__p();for(var c in a){this.cache.html[c]||(this.cache.html[c]={});for(var d in a[c].html){var e=a[c].html[d];typeof e==="string"&&(e=b("HTML")(e).getRootNode());e.childNodes?this.cache.html[c][d]=Array.from(e.childNodes):this.cache.html[c][d]=[]}if(!("extra"in a[c])){this.cache.extra[c]=null;continue}this.cache.extra[c]={tagRects:{}};if(!Array.isArray(a[c].extra.tagRects))for(var f in a[c].extra.tagRects)a[c].extra.tagRects[f]&&(this.cache.extra[c].tagRects[f]=b("Rect").deserialize(a[c].extra.tagRects[f]));Object.keys(a[c].extra).forEach(function(b){if(b=="tagRects")return;this.cache.extra[c][b]=a[c].extra[b]}.bind(this))}};g.prototype.processErrorResult=function(a){"use strict";if(!this.isLoaded()){this.initError=!0;return}a=a.side;var b=[g.ERROR_ID];this.attachToFbidsList(b,a)};g.prototype.setTotalCount=function(a){"use strict";this.totalCount=a};g.prototype.setFirstCursorIndex=function(a){"use strict";this.firstCursorIndex=a};g.prototype.setIsFromGroups=function(a){"use strict";this.isFromGroups=a};Object.assign(g,{ERROR:"error",HTML:"html",IMAGE_DATA:"image",EXTRA:"extra",BUFFER_SIZE:3,INIT_BUCKET_SIZE:4,FULL_BUCKET_SIZE:12,ERROR_ID:-1,INIT_PLACEHOLDER:1});e.exports=g}),null);
__d("XPhotosetSearchPivotController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/search-pivot/photoset/",{fbid:{type:"Int",required:!0},tags:{type:"IntToIntMap"}})}),null);
__d("PhotosetSearchPivotData",["Promise","AsyncRequest","PhotoStreamCache","XPhotosetSearchPivotController"],(function(a,b,c,d,e,f){__p&&__p();var g=/^(perm:)?tag:(\d+)/,h={};a={fetch:function(a,c){__p&&__p();if(!(a in h)){var d;(function(){__p&&__p();var e=b("XPhotosetSearchPivotController").getURIBuilder().setInt("fbid",a);c&&(d={},c.fbidList.forEach(function(a){a=c.getCacheContent(a,b("PhotoStreamCache").EXTRA);a&&Object.keys(a.tagRects).forEach(function(a){if(g.test(a)){a=RegExp.$2;a in d?d[a]++:d[a]=1}})}),e.setIntToIntMap("tags",d));h[a]=new(b("Promise"))(function(a,c){new(b("AsyncRequest"))().setURI(e.getURI()).setHandler(function(b){a(b.getPayload())}).setErrorHandler(c).setAllowCrossPageTransition(!0).send()})})()}return h[a]["catch"](function(b){delete h[a];throw b})}};e.exports=a}),null);
__d("SphericalPhotoViewerTypedLogger",["Banzai","GeneratedLoggerUtils","nullthrows"],(function(a,b,c,d,e,f){"use strict";__p&&__p();function a(){this.clear()}a.prototype.log=function(){b("GeneratedLoggerUtils").log("spherical_photo_viewer_log:SphericalPhotoViewerLoggerConfig",this.$1,b("Banzai").BASIC)};a.prototype.logVital=function(){b("GeneratedLoggerUtils").log("spherical_photo_viewer_log:SphericalPhotoViewerLoggerConfig",this.$1,b("Banzai").VITAL)};a.prototype.logImmediately=function(){b("GeneratedLoggerUtils").log("spherical_photo_viewer_log:SphericalPhotoViewerLoggerConfig",this.$1,{signal:!0})};a.prototype.clear=function(){this.$1={};return this};a.prototype.getData=function(){return babelHelpers["extends"]({},this.$1)};a.prototype.updateData=function(a){this.$1=babelHelpers["extends"]({},this.$1,a);return this};a.prototype.setAvgFrameRenderTime=function(a){this.$1.avg_frame_render_time=a;return this};a.prototype.setAvgTextureToScreenRatio2=function(a){this.$1.avg_texture_to_screen_ratio2=a;return this};a.prototype.setClientUserID=function(a){this.$1.client_userid=a;return this};a.prototype.setComposerSessionID=function(a){this.$1.composer_session_id=a;return this};a.prototype.setCountry=function(a){this.$1.country=a;return this};a.prototype.setDevicePixelRatio=function(a){this.$1.device_pixel_ratio=a;return this};a.prototype.setDt=function(a){this.$1.dt=a;return this};a.prototype.setErrorCode=function(a){this.$1.error_code=a;return this};a.prototype.setErrorMessage=function(a){this.$1.error_message=a;return this};a.prototype.setErrorStackTrace=function(a){this.$1.error_stack_trace=a;return this};a.prototype.setErrorType=function(a){this.$1.error_type=a;return this};a.prototype.setEventType=function(a){this.$1.event_type=a;return this};a.prototype.setFallbackUI=function(a){this.$1.fallback_ui=a;return this};a.prototype.setIsGyroEnabled=function(a){this.$1.is_gyro_enabled=a;return this};a.prototype.setMaxGpuMemoryUsed=function(a){this.$1.max_gpu_memory_used=a;return this};a.prototype.setMaxTileLevel=function(a){this.$1.max_tile_level=a;return this};a.prototype.setName=function(a){this.$1.name=a;return this};a.prototype.setNumberOfSphericalPhoto=function(a){this.$1.number_of_spherical_photo=a;return this};a.prototype.setPhotoID=function(a){this.$1.photo_id=a;return this};a.prototype.setPitch=function(a){this.$1.pitch=a;return this};a.prototype.setRenderMethod=function(a){this.$1.render_method=a;return this};a.prototype.setSphericalPhotoSessionID=function(a){this.$1.spherical_photo_session_id=a;return this};a.prototype.setSurface=function(a){this.$1.surface=a;return this};a.prototype.setTotalDataLoaded=function(a){this.$1.total_data_loaded=a;return this};a.prototype.setVfov=function(a){this.$1.vfov=a;return this};a.prototype.setViewportHeight=function(a){this.$1.viewport_height=a;return this};a.prototype.setViewportWidth=function(a){this.$1.viewport_width=a;return this};a.prototype.setYaw=function(a){this.$1.yaw=a;return this};c={avg_frame_render_time:!0,avg_texture_to_screen_ratio2:!0,client_userid:!0,composer_session_id:!0,country:!0,device_pixel_ratio:!0,dt:!0,error_code:!0,error_message:!0,error_stack_trace:!0,error_type:!0,event_type:!0,fallback_ui:!0,is_gyro_enabled:!0,max_gpu_memory_used:!0,max_tile_level:!0,name:!0,number_of_spherical_photo:!0,photo_id:!0,pitch:!0,render_method:!0,spherical_photo_session_id:!0,surface:!0,total_data_loaded:!0,vfov:!0,viewport_height:!0,viewport_width:!0,yaw:!0};e.exports=a}),null);
__d("SpotlightViewerLoggingEvents",[],(function(a,b,c,d,e,f){e.exports=Object.freeze({LOADED:"loaded",LOADING:"loading",ERROR:"error",ABORT:"abort",OPEN_BEGIN:"open_begin",OPEN_COMPLETE:"open_complete",CLOSE_BEGIN:"close_begin",CLOSE_COMPLETE:"close_complete",PAGE_BEGIN:"page_begin",PAGE_COMPLETE:"page_complete",PHOTO_CHANGE_BEGIN:"photo_change_begin",PHOTO_CHANGE_COMPLETE:"photo_change_complete",DATA_FETCH_BEGIN:"data_fetch_begin",DATA_FETCH_COMPLETE:"data_fetch_complete",PHOTO_FETCH:"photo_fetch"})}),null);
__d("PhotoLogger",["Banzai","BanzaiScuba","Event","SpotlightViewerLoggingEvents","SubscriptionsHandler"],(function(a,b,c,d,e,f){__p&&__p();function a(a){"use strict";this.$1=a,this.$2={}}a.prototype.log=function(a,c,d,e){"use strict";b("Banzai").post("profile_photos_view",{photo_fbid:c,source:d,profile_id:e}),this.$2[a]||(this.$3(a),this.$2[a]=!0)};a.prototype.$3=function(a){"use strict";this.$4(b("SpotlightViewerLoggingEvents").LOADING,{uri:a});var c=new(b("SubscriptionsHandler"))(),d=new Image();c.addSubscriptions(b("Event").listen(d,"load",function(){this.$4(b("SpotlightViewerLoggingEvents").LOADED,{uri:a}),c.release()}.bind(this)),b("Event").listen(d,"error",function(){this.$4(b("SpotlightViewerLoggingEvents").ERROR,{uri:a}),c.release()}.bind(this)),b("Event").listen(d,"abort",function(){this.$4(b("SpotlightViewerLoggingEvents").ABORT,{uri:a}),c.release()}.bind(this)));d.src=a};a.prototype.logEvent=function(a){"use strict";this.$4(a)};a.prototype.$4=function(a,c){"use strict";var d=new(b("BanzaiScuba"))("photos_client_loading",null,{addBrowserFields:!0});d.addNormal("event",a);d.addNormal("viewer",this.$1);for(var e in c)d.addNormal(e,c[e]);d.post()};e.exports=a}),null);
__d("PhotoSessionLog",["AsyncRequest","Run","URI","Vector","WWWBase"],(function(a,b,c,d,e,f){__p&&__p();function g(){}Object.assign(g,{UNKNOWN:0,ESC:1,X:2,OUTSIDE:3,UNLOAD:4,NAVIGATE:5,AGGREGATE:6,LEAVE:7,LOADING:8,PERMALINK:0,SNOWLIFT:6,SNOWDOWN:13,AGGREGATION_COUNT:20,set:null,time:null,views:0,fbidList:[],details:{},width:0,height:0,first:!1,last:!1,logIds:!1,version:null,source:null,buttonLikes:0,pagingAction:"",cycle:!1,endOfRelevant:!1,relevantCount:0,closingTypeToString:function(a){return{0:"UNKNOWN",1:"ESC",2:"X",3:"OUTSIDE",4:"UNLOAD",5:"NAVIGATE"}[a]||"UNKNOWN"},initLogging:function(a){__p&&__p();this.set=null;this.time=new Date();this.views=0;this.hiResLoads=0;this.fullScreenViews={};this.first=!0;this.last=!1;this.logIds=!1;this.eid="";this.version=a;this.buttonLikes=0;this.pagingAction="";this.cycle=!1;this.endOfRelevant=!1;this.relevantCount=0;this.topLevelPostId=0;if(a===g.SNOWLIFT){a=b("Vector").getViewportDimensions();this.width=a.x;this.height=a.y}},_isSnowlift:function(){return this.version===g.SNOWLIFT},setLogFbids:function(a){this.logIds=a},setTopLevelPostId:function(a){this.topLevelPostId=a},setEid:function(a){this.eid=a},setPhotoSet:function(a){this.set=a},addButtonLike:function(){this.buttonLikes++},setPagingAction:function(a){this.pagingAction=a},setCycle:function(a){this.cycle=a},setEndOfRelevant:function(a){this.endOfRelevant=a},setRelevantCount:function(a){this.relevantCount=a},setEndMetrics:function(a){this.endMetrics=a},setSource:function(a){this.source=a},addPhotoView:function(a,b,c){this.logIds&&this.views>=this.AGGREGATION_COUNT&&this.logPhotoViews(this.AGGREGATE),this.views++,a&&this.fbidList.push([a.fbid,a.owner,Date.now()]),b&&this.hiResLoads++,c&&(this.fullScreenViews[a.fbid]=!0)},logEnterFullScreen:function(a){this.fullScreenViews[a]=!0},addDetailData:function(a,b){this.details[a]||(this.details[a]={t:b.num_tags,l:b.has_location,c:b.has_caption,cm:b.comment_count,lk:b.like_count,w:b.width,h:b.height,ad:"{}",p:this.pagingAction})},updateAdData:function(a,b){this.details[a]&&(this.details[a].ad=JSON.stringify(b))},logPhotoViews:function(a){__p&&__p();if(!this.views)return;a!=this.AGGREGATE&&(this.last=!0);this.logData(a?a:this.UNKNOWN);this.views=0;this.hiResLoads=0;this.fbidList=[];this.details={};this.first=!1;this.buttonLikes=0;this.last&&(this.set=null,this.logIds=!1,this.fullScreenViews={})},logInitialLoad:function(){this.logData(g.LOADING)},logData:function(a){__p&&__p();var c=[],d={},e=0;a===this.LOADING?(e=this.topLevelPostId,this.topLevelPostId||(c=this.fbidList,d=this.details)):(c=this.fbidList,d=this.details);c={set:this.set,time:new Date()-this.time,fbids:c,details:d,eid:this.eid,first:this.first,last:this.last,close:a,button_likes:this.buttonLikes,version:this.version,endmetric:this.endMetrics,cycle:this.cycle,end_relev:this.endOfRelevant,relev_count:this.relevantCount,source:this.source,top_level_post_id:e};if(this.version===g.SNOWLIFT){d=b("Vector").getViewportDimensions();c.width=d.x||this.width;c.height=d.y||this.height;this.hiResLoads>0&&(c.hires_loads=this.hiResLoads);if(this.last){e=Object.keys(this.fullScreenViews).length;e>0&&(c.fullscreen=e)}}d=new(b("URI"))(b("WWWBase").uri).setPath("/ajax/photos/logging/session_logging.php");new(b("AsyncRequest"))().setAllowCrossPageTransition(!0).setURI(d).setOption("asynchronous_DEPRECATED",a!=g.UNLOAD).setOption("suppressErrorHandlerWarning",!0).setData(c).send()}});b("Run").onUnload(function(){g.logPhotoViews(g.UNLOAD)});b("Run").onLeave(function(){g.logPhotoViews(g.LEAVE)});e.exports=g}),null);
__d("PhotosUtils",["Vector"],(function(a,b,c,d,e,f){__p&&__p();function a(){}Object.assign(a,{getNearestBox:function(a,b){var c=Infinity,d=null;for(var e in a){var f=a[e];if(f.contains(b)){f=b.distanceTo(f.getCenter());f<c&&(c=f,d=e)}}return d},absoluteToNormalizedPosition:function(a,c){var d=b("Vector").getElementPosition(a);a=b("Vector").getElementDimensions(a);c=c.sub(d).mul(100/a.x,100/a.y);c.domain="pure";return c},normalizedToAbsolutePosition:function(a,c){var d=b("Vector").getElementPosition(a);a=b("Vector").getElementDimensions(a);c=c.mul(a.x/100,a.y/100).add(d);c.domain="document";return c},isFacebox:function(a){return a.match(/^face:/)},isTag:function(a){return a.match(/^tag:/)}});e.exports=a}),null);
__d("PhotoPermalinkURI",[],(function(a,b,c,d,e,f){__p&&__p();var g={isValid:function(a){return g.parse(a)!==null},parse:function(a){__p&&__p();if(this.isValidLegacy(a)){var b=a.getQueryData();if(b.fbid)return{photo_id:b.fbid,set_token:b.set};return b.id&&b.pid?{photo_id:b.id+":"+b.pid,set_token:b.set}:null}b=a.getPath();b[b.length-1]==="/"&&(b=b.substring(0,b.length-1));a=b.split("/");if(a.length>=3&&a[2]==="photos")if(a.length===4&&/^\d+$/.exec(a[3])!==null)return{photo_id:a[3],set_token:null};else if(a.length===5&&/^\d+$/.exec(a[4])!==null)return{photo_id:a[4],set_token:a[3]};return null},isValidLegacy:function(a){a=a.getPath();a[a.length-1]==="/"&&(a=a.substring(0,a.length-1));return a==="/photo.php"||a==="/force_photo/photo.php"||a==="/photo"||a==="/force_photo/photo/index.php"||a==="/photo/index.php"||a==="/force_photo/photo"||a==="/video.php"||a==="/video/video.php"?!0:!1}};e.exports=g}),null);
__d("PhotoTagSearchPivotLogger",["Banzai"],(function(a,b,c,d,e,f){__p&&__p();var g={};b("Banzai").subscribe(b("Banzai").SHUTDOWN,function(){Object.keys(g).forEach(function(a){var c=g[a];Object.keys(c).forEach(function(d){b("Banzai").post("photo_tag_search_pivot",{source:a,action:d,count:c[d]})})})});var h=/^(perm:)?tag:/,i;a={logImpression:function(a,b){a=a in g?g[a]:g[a]={};a[b]=b in a?a[b]+1:1},logImageImpression:function(a,b,c){i!==b&&(c.some(function(a){return h.test(a)})&&this.logImpression(a,"image_impression"),i=b)},logPivotImpression:function(a,b){h.test(b)&&this.logImpression(a,"pivot_impression")},logShowMorePhotos:function(){this.logImpression("photoset","show_more_photos")},logHideMorePhotos:function(){this.logImpression("photoset","hide_more_photos")},logSuggestMorePhotos:function(){this.logImpression("photoset","suggest_more_photos")},logMorePhotosNavigation:function(a){b("Banzai").post("photo_tag_search_pivot",{source:"photoset",action:"more_photos_search",query:a,count:1})}};e.exports=a}),null);
__d("PhotosetSearchPivot.react",["cx","fbt","LeftRight.react","PhotosetSearchPivotData","PhotoTagSearchPivotLogger","React","XUISpinner.react","XUIText.react","joinClasses"],(function(a,b,c,d,e,f,g,h){__p&&__p();var i;a=b("React").PropTypes;c=babelHelpers.inherits(j,b("React").Component);i=c&&c.prototype;function j(){var a,c;for(var d=arguments.length,e=Array(d),f=0;f<d;f++)e[f]=arguments[f];return c=(a=i.constructor).call.apply(a,[this].concat(e)),this.onClick=function(){b("PhotoTagSearchPivotLogger").logMorePhotosNavigation(this.props.normalized)}.bind(this),c}j.prototype.render=function(){"use strict";return b("React").createElement("div",{className:"_25r"},b("React").createElement("a",{onClick:this.onClick,href:this.props.uri,className:"_25t _3-8t"},b("React").createElement("div",{className:"_25u"},b("React").createElement("div",{className:"_25v _25w",style:{backgroundImage:"url("+this.props.images[0].uri+")"}}),b("React").createElement("div",{className:"_25x"},b("React").createElement("div",{className:"_25y"},b("React").createElement("div",{className:"_25z"}),b("React").createElement("div",{className:"_26r"},b("React").createElement("div",{className:"_273 _25w",style:{backgroundImage:"url("+this.props.images[1].uri+")"}}))),b("React").createElement("div",{className:"_274"},b("React").createElement("div",{className:"_25z"}),b("React").createElement("div",{className:"_26r"},b("React").createElement("div",{className:"_273 _25w",style:{backgroundImage:"url("+this.props.images[2].uri+")"}}))))),b("React").createElement(b("XUIText.react"),{display:"block",className:"_27f _2pi4",dangerouslySetInnerHTML:{__html:this.props.title.__html}})))};j.propTypes={normalized:a.string,title:a.object,uri:a.string,images:a.array};d=b("React").createClass({displayName:"PhotosetSearchPivot",propTypes:{fbid:a.string,endofalbum:a.bool,withBackground:a.bool,linesAroundHeader:a.bool,onclose:a.func},fetchPivots:function(a){b("PhotosetSearchPivotData").fetch(a).then(function(b){setTimeout(this.onFetchSuccess.bind(this,a,b.pivots),0)}.bind(this),function(b){setTimeout(this.onFetchError.bind(this,a),0)}.bind(this))},onFetchSuccess:function(a,b){if(!this.isMounted()||this.props.fbid!==a)return;b=b||[];a="show";b.length===0&&(a="hide");this.setState({pivots:b,action:a})},onFetchError:function(a){if(!this.isMounted()||this.props.fbid!==a)return;this.setState({pivots:[],action:"hide"})},getInitialState:function(){this.fetchPivots(this.props.fbid);return{pivots:[],action:"loading"}},UNSAFE_componentWillReceiveProps:function(a){a.fbid?(this.setState({action:"loading"}),this.fetchPivots(a.fbid)):this.setState({action:"hide",pivots:[]})},onExitClicked:function(){this.props.onclose()},render:function(){if(this.state.action==="loading")return b("React").createElement("div",{className:b("joinClasses")(this.props.className,"_27h _2ph_")},b("React").createElement(b("XUISpinner.react"),{size:"large"}));if(this.state.action==="hide")return b("React").createElement("span",null);var a=this.state.pivots.map(function(a){return b("React").createElement(j,{normalized:a.normalized,title:a.title,uri:a.uri,images:a.images})}),c=this.props.endofalbum?b("React").createElement("span",{className:"_2pij"},h._("End of album")):null,d="_27m _2pi3 _2pib"+(this.props.linesAroundHeader?" _3-te":"");c=b("React").createElement("span",null,c,b("React").createElement("span",{className:"_4ptz"},h._("Other photos you may like")));this.props.onclose?c=b("React").createElement(b("LeftRight.react"),{className:d},c,b("React").createElement("a",{href:"#",onClick:this.onExitClicked,className:"_27n"})):c=b("React").createElement("div",{className:d},c);return b("React").createElement("div",{className:b("joinClasses")(this.props.className,(this.state.action==="hide"?"_27j":"")+(this.state.action==="show"?" _27k":""))},b("React").createElement("div",{className:"_27l"+(this.props.withBackground?" _3-tf":"")},c,b("React").createElement("div",{className:"_27o _2pi8 clearfix"},a)))}});e.exports=d}),null);
__d("PhotosetPivotSlide.react",["ix","cx","fbt","xuiglyph","Image.react","Link.react","PhotosetSearchPivot.react","React","XUIText.react"],(function(a,b,c,d,e,f,g,h,i,j){__p&&__p();var k;c=b("React").PropTypes;d=babelHelpers.inherits(a,b("React").Component);k=d&&d.prototype;function a(){__p&&__p();var a,c;for(var d=arguments.length,e=Array(d),f=0;f<d;f++)e[f]=arguments[f];return c=(a=k.constructor).call.apply(a,[this].concat(e)),this.$1=function(){if(this.props.albumOwnerName)if(this.props.isAlbum)return i._("End of {user_name}'s album",[i._param("user_name",b("React").createElement(b("XUIText.react"),{weight:"bold"},this.props.albumOwnerName))]);else return i._("End of {user_name}'s photos",[i._param("user_name",b("React").createElement(b("XUIText.react"),{weight:"bold"},this.props.albumOwnerName))]);else if(this.props.isAlbum)return i._("End of album");else return i._("End of photos")}.bind(this),c}a.prototype.render=function(){"use strict";return b("React").createElement("div",{className:"_1_ap"+(this.props.visible?" _1_aq":"")},b("React").createElement("div",{className:"_1_ar"},b("React").createElement(b("XUIText.react"),{display:"block"},this.$1()),b("React").createElement(b("Link.react"),{className:"_1_as",onClick:this.props.onReturn},b("React").createElement(b("Image.react"),{className:"_1_at",src:g("88724")}),i._("Return to Beginning"))),b("React").createElement(b("PhotosetSearchPivot.react"),{className:"_1_au",fbid:this.props.visible?this.props.fbid:null,linesAroundHeader:!0}))};a.propTypes={fbid:c.string,isAlbum:c.bool,albumOwnerName:c.string,visible:c.bool,onReturn:c.func};e.exports=a}),null);
__d("DisableContextMenuMixin",["Event","emptyFunction"],(function(a,b,c,d,e,f){"use strict";a=b("emptyFunction");c={getContextMenuContainer:a,_contextMenuEventHandler:null,disableContextMenu:function(){if(this._contextMenuEventHandler)return;this._contextMenuEventHandler=b("Event").listen(this.getContextMenuContainer(),"contextmenu",function(a){a.preventDefault(),a.stopPropagation()})},enableContextMenu:function(){this._contextMenuEventHandler&&(this._contextMenuEventHandler.remove(),this._contextMenuEventHandler=null)}};e.exports=c}),null);
__d("ObjectionableContentFilterMixin",["csx","cx","CSS","DOM","emptyFunction"],(function(a,b,c,d,e,f,g,h){__p&&__p();a=b("emptyFunction");c={getObjectionableWarningContainer:a,getObjectionableWarningHiddenContent:a,_objectionableWarningMarkup:null,_objectionableWarningOverlay:null,_objectionableWarningHiddenContentWrapper:null,_objectionableWarningHiddenContent:null,showObjectionableWarning:function(a){var c="._f_2",d="._f_g";this._objectionableWarningMarkup&&this.hideObjectionableWarning();this._objectionableWarningOverlay=b("DOM").scry(a,c).pop();this._objectionableWarningHiddenContentWrapper=b("DOM").scry(a,d).pop();this._objectionableWarningOverlay&&b("CSS").show(this._objectionableWarningOverlay);this._objectionableWarningHiddenContentWrapper&&(this.getObjectionableWarningContainer().replaceChild(a,this.getObjectionableWarningHiddenContent()),this._objectionableWarningHiddenContentWrapper.appendChild(this.getObjectionableWarningHiddenContent()),b("CSS").addClass(a,"_dbl"));this._objectionableWarningMarkup=a;this._objectionableWarningHiddenContent=this.getObjectionableWarningHiddenContent()},hideObjectionableWarning:function(){if(!this.getObjectionableWarningContainer().contains(this._objectionableWarningMarkup))return;this.getObjectionableWarningContainer().replaceChild(this._objectionableWarningHiddenContent,this._objectionableWarningMarkup)}};e.exports=c}),null);
__d("PhotoSnowliftAds",["csx","Arbiter","CSS","DataAttributeUtils","DataStore","DOM","Event","PhotoSessionLog","UIPagelet","URI","Vector","cxodecode"],(function(a,b,c,d,e,f,g){__p&&__p();var h=void 0,i={REFRESH_RATE:3e4,UNITS_REGISTER_DELAY:1e3,root:null,availableDimensions:null,loadQuery:null,lastLoadTime:0,minAds:100,units:null,isLogAdData:null,displayedCallback:null,position:null,adsStatus:"null",adsEvents:{},resetEvents:function(){this.adsStatus="reset",this.adsEvents={}},addEvent:function(a,b){b&&(this.adsStatus=a);b=Date.now();this.adsEvents[a+"_"+b]=b},init:function(a,c,d,e){d.nonce&&(h=b("cxodecode")(d.nonce)),this.reset(),this.root=a,this.snowlift=c,this.minAds=d.min_ads,this.displayedCallback=e,this.addEvent("init",!0)},reset:function(){this.lastLoadTime=0,this.position=0,this.units=[],this.resetEvents(),this.addEvent("reset",!0)},resize:function(a){this.availableDimensions=a,this.loadQuery=this.snowlift.getLoadQuery(),this.processResize()},calculateUnitSizes:function(a,c,d){__p&&__p();var e={};a.forEach(function(a){__p&&__p();var f=a.root.firstChild.offsetHeight;a.units.forEach(function(a){if(!b("CSS").hasClass(a,"hidden")&&!this.getIsHoldout(a)&&!this.getIsShadow(a)){a=this.getHeight(a.firstChild,c);f-=a}}.bind(this));var g={height:f,visible:!1};a.units.forEach(function(a){var b=this.getIsAds(a),f=this.getHeight(a.firstChild,c),h=this.getUnitId(a);a=this.getIsHoldout(a);if(a&&d)return;e[h]={height:f,visible:!1,priority:0,is_ads:b,is_holdout:a,section_ref:g}}.bind(this))}.bind(this));return e},calculateVisibleUnits:function(a,b,c){__p&&__p();a=this.getUnitPriority(b);a.forEach(function(a){if(Object.prototype.hasOwnProperty.call(b,a)){a=b[a];var d=a.height;a.section_ref.visible||(d+=a.section_ref.height);a.height_below=c-d;a.visible=a.height_below>=0&&d>0;a.visible&&(a.section_ref.visible=!0,c-=d)}});return b},displayUnits:function(a,c){__p&&__p();a.forEach(function(a){__p&&__p();var d=!1,e=!0;a.units.forEach(function(a){__p&&__p();var f=this.getUnitId(a),g=c[f];if(!g)return;var h=g.visible,i=g.height_below;g=g.is_ads;b("CSS").conditionClass(a,"hidden",!h);if(g&&h&&e){a=b("DOM").find(a,"div.ego_unit");b("CSS").addClass(a,"ego_unit_no_top_border");e=!1}d=d||h;this.calcUnitStats(this.units[g][f],h,i)}.bind(this));b("CSS").conditionClass(a.root,"hidden",!d)}.bind(this)),b("Arbiter").inform("PhotoSnowliftAds/displayUnits")},getUnitsDisplayed:function(a,b){var c=0;a.forEach(function(a){a.units.forEach(function(a){a=this.getUnitId(a);a=b[a];if(!a||!a.visible)return;c++}.bind(this))}.bind(this));return c},getHeightsRequired:function(a,b){__p&&__p();var c=0,d=[];a.forEach(function(a){var e=!1;a.units.forEach(function(a){a=this.getUnitId(a);a=b[a];if(!a)return;c+=a.height;e||(c+=a.section_ref.height,e=!0);d.push(c)}.bind(this))}.bind(this));return d},getUnitPriority:function(a){__p&&__p();var b=[],c=0,d=0;for(var e in a){var f=a[e];b.push(e);var g=this.minAds+c+d;f.is_ads?(d<this.minAds&&(g=d),d++):c++;f.priority=g}b=b.sort(function(b,c){b=a[b];c=a[c];return b.priority-c.priority});return b},updateUnitsStatus:function(){__p&&__p();var a=this.availableDimensions.x,b=this.availableDimensions.y,c=this.calculateUnitSizes(this.sections,a);c=this.calculateVisibleUnits(this.sections,c,b);for(var d in c){if(!Object.prototype.hasOwnProperty.call(c,d))continue;var e=c[d];if(!e.is_holdout||!e.visible)continue;var f=this.units[1][d];this.calcUnitStats(f,e.visible,e.height_below)}c=this.calculateUnitSizes(this.sections,a,!0);c=this.calculateVisibleUnits(this.sections,c,b);this.displayUnits(this.sections,c);if(this.displayedCallback){f=this.getUnitsDisplayed(this.sections,c);e=this.getHeightsRequired(this.sections,c);this.displayedCallback(f,e)}},calcUnitStats:function(a,b,c){__p&&__p();if(!a)return;var d=Date.now();a.visible&&(a.totalTime+=d-a.lastShowTime);if(a.trackingCode!==null&&a.totalTime>=this.UNITS_REGISTER_DELAY){var e=a.trackingCode;a.trackingCode=null;this.registerImpression(e,a.registerUrl)}a.visible=b;a.heightBelow=c;a.lastShowTime=d},prepareResize:function(){var a=function(a){var c=b("DOM").create("div",{className:"inner"}),d=b("DOM").create("div",{className:"wrapper"},c);b("DOM").replace(a,d);b("DOM").setContent(c,a);return d};this.sections=b("DOM").scry(this.root,"div.ego_section").map(function(c){return{root:a(c),units:b("DOM").scry(c,"div.ego_unit").map(a)}})},processResize:function(){if(this.isLoading||this.lastLoadTime===0||this.availableDimensions===null){this.setLogData();return}this.updateUnitsStatus();this.setLogData();var a=this.nextRegisterTime();a!==Infinity&&setTimeout(this.processResize.bind(this),a)},setIsLogAdData:function(a){this.isLogAdData=a,this.addEvent("setIsLogAdData",!1),this.setLogData()},setLogData:function(){var a=this.snowlift.getImageId();if(this.isLogAdData&&a){var c=b("Vector").getElementDimensions(this.snowlift.getImage()),d=b("Vector").getElementDimensions(this.snowlift.getRHCHeader()),e=b("Vector").getElementDimensions(this.snowlift.getRHCBody()),f=b("Vector").getElementDimensions(this.snowlift.getRHCFooter());c={query_set:this.snowlift.getLoadQuery().set,window_x:window.innerWidth,window_y:window.innerHeight,image_x:c.x,image_y:c.y,header_x:d.x,header_y:d.y,body_x:e.x,body_y:e.y,footer_x:f.x,footer_y:f.y,ads_below_space:this.getAdsBelowSpace(),time:Date.now(),adsStatus:this.adsStatus,adsEvents:this.adsEvents,refreshRate:this.refreshUnitsRate,position:this.position};b("PhotoSessionLog").updateAdData(a,c)}},getAdsBelowSpace:function(){var a=[],b=this.units[1];for(var c in b)Object.prototype.hasOwnProperty.call(b,c)&&!this.getIsHoldout(this.getAdUnit(c))&&a.push(b[c].heightBelow);return a},getIsAds:function(a){a=b("DOM").scry(a,h||"div._4u8");return a.length},getUnitId:function(a){if(this.getIsAds(a))return this.getAdId(a);else return this.getEgoId(a)},getEgoId:function(a){a=b("DOM").find(a,"div.ego_unit");return a.getAttribute("data-ego-fbid")},getAdData:function(a){a=b("DOM").find(a,h||"div._4u8");a=b("DataAttributeUtils").getDataAttribute(a,"data-ad");return a&&JSON.parse(a)||{}},getAdId:function(a){return this.getAdData(a).adid},getIsHoldout:function(a){return a&&this.getIsAds(a)&&this.getAdData(a).holdout},getIsShadow:function(a){return a&&this.getIsAds(a)&&this.getAdData(a).shadow},getAdUnit:function(a){if(!this.sections)return null;var b=[];this.sections.forEach(function(a){b.push.apply(b,a.units)});for(var c=0;c<b.length;c++)if(this.getIsAds(b[c])&&this.getAdId(b[c])==a)return b[c];return null},nextRegisterTime:function(){var a=Infinity,b=babelHelpers["extends"]({},this.units[0],this.units[1]);for(var c in b)if(Object.prototype.hasOwnProperty.call(b,c)){var d=b[c];d.trackingCode!==null&&d.visible&&(a=Math.min(a,this.UNITS_REGISTER_DELAY-d.totalTime))}return a},getHeight:function(a,c){var d=b("DataStore").get(a,"height");return d&&d.x===c?d.y:this.cacheHeight(a,c)},cacheHeight:function(a,c){c={x:c,y:a.offsetHeight};b("DataStore").set(a,"height",c);return c.y},loadAdsAndEgo:function(){if(this.loadQuery){this.resetEvents();this.addEvent("adsRequested",!0);this.position++;var a=this.getCursorFBID(this.loadQuery);b("UIPagelet").loadFromEndpoint("WebEgoPane",this.root,{pid:34,data:[this.loadQuery.set,a,!1,this.snowlift.getOpaqueCursor(a)]},{crossPage:!0,bundle:!1})}},getCursorFBID:function(a){if(a){if(a.v!==undefined)return a.v;if(a.fbid!==undefined)return a.fbid}return"0"},unitsLoaded:function(a,b){var c;b?(c="/ai.php",this.addEvent("adsLoaded",!0)):(c="/ajax/ei.php",this.addEvent("egoLoaded",!0));var d={};for(var e in a)Object.prototype.hasOwnProperty.call(a,e)&&(d[e]={trackingCode:a[e],totalTime:0,lastShowTime:0,heightBelow:-1e4,visible:!1,registerUrl:c});this.units[b]=d;this.units[0]&&this.units[1]&&this.waitForImages(this.imagesLoaded.bind(this))},imagesLoaded:function(){this.prepareResize(),this.addEvent("imagesLoaded",!0),this.lastLoadTime=Date.now(),this.isLoading=!1,this.processResize(),b("CSS").removeClass(this.root,"loading")},loadAdsFromUserActivity:function(){var a=Date.now()-this.lastLoadTime;!this.isLoading&&a>i.REFRESH_RATE&&(b("CSS").addClass(this.root,"loading"),this.isLoading=!0,this.loadAdsAndEgo())},registerImpression:function(a,c){c=b("DOM").create("iframe",{src:new(b("URI"))(c).addQueryData({aed:a}),width:0,height:0,frameborder:0,scrolling:"no",className:"fbEmuTracking"});c.setAttribute("aria-hidden","true");b("DOM").appendContent(this.root,c)},waitForImages:function(a){var c=b("DOM").scry(this.root,"img.img"),d=c.length,e=d;e===0&&a();var f=function(){e--,e===0&&setTimeout(a,0)};for(var g=0;g<d;g++){var h=c[g];h.complete?f():b("Event").listen(h,{load:f,error:f,abort:f})}}};e.exports=i}),null);
__d("PhotoSnowliftBackLink.react",["cx","React"],(function(a,b,c,d,e,f,g){"use strict";__p&&__p();var h;c=b("React").PropTypes;h=babelHelpers.inherits(a,b("React").Component);h&&h.prototype;a.prototype.render=function(){return b("React").createElement("a",{className:"_1cac"+(this.props.visible?" _1cad":""),href:this.props.href},this.props.name)};function a(){h.apply(this,arguments)}a.propTypes={href:c.string,name:c.string,visible:c.bool};e.exports=a}),null);
__d("PhotoSnowliftViewable",["cx","CSS","DOM","EventEmitter","Vector"],(function(a,b,c,d,e,f,g){__p&&__p();var h,i=2e3;c=babelHelpers.inherits(a,b("EventEmitter"));h=c&&c.prototype;function a(){__p&&__p();var a=arguments.length<=0||arguments[0]===undefined?i:arguments[0],c=arguments.length<=1||arguments[1]===undefined?1:arguments[1];h.constructor.call(this);this.$PhotoSnowliftViewable5=b("DOM").create("div",{className:"_2-sx"});this.$PhotoSnowliftViewable4=a;this.$PhotoSnowliftViewable3=c;this.$PhotoSnowliftViewable1=null;this.$PhotoSnowliftViewable2=0;this.$PhotoSnowliftViewable6();setTimeout(function(){return this.whenReady(function(){return this.$PhotoSnowliftViewable7()}.bind(this))}.bind(this),0)}a.prototype.$PhotoSnowliftViewable6=function(){"use strict";this.$PhotoSnowliftViewable1=setTimeout(function(){return this.$PhotoSnowliftViewable8()}.bind(this),this.$PhotoSnowliftViewable4)};a.prototype.$PhotoSnowliftViewable8=function(){"use strict";if(this.isReady())return;this.$PhotoSnowliftViewable2<this.$PhotoSnowliftViewable3?(this.reload(),this.$PhotoSnowliftViewable2++,this.$PhotoSnowliftViewable6()):this.emit("loadingfailed")};a.prototype.reload=function(){"use strict"};a.prototype.$PhotoSnowliftViewable7=function(){"use strict";this.$PhotoSnowliftViewable1!==null&&(clearTimeout(this.$PhotoSnowliftViewable1),this.$PhotoSnowliftViewable1=null)};a.prototype.getElement=function(){"use strict";return this.$PhotoSnowliftViewable5};a.prototype.show=function(){"use strict";b("CSS").show(this.getElement())};a.prototype.hide=function(){"use strict";b("CSS").hide(this.getElement())};a.prototype.suspend=function(){"use strict"};a.prototype.resume=function(){"use strict"};a.prototype.onToggleIntoFullScreen=function(){"use strict"};a.prototype.onToggleOutOfFullScreen=function(){"use strict"};a.prototype.onEnterFullScreen=function(){"use strict"};a.prototype.onExitFullScreen=function(){"use strict"};a.prototype.getNaturalDimensions=function(){"use strict";return this.getDimensions()};a.prototype.getDimensions=function(){"use strict";return b("Vector").getElementDimensions(this.getElement())};a.prototype.setDimensions=function(a){"use strict";var b=this.getElement();b.style.width=a.x+"px";b.style.height=a.y+"px"};a.prototype.isReady=function(){"use strict";throw new Error("Viewable has no concept of readiness - should be calling a subclass")};a.prototype.whenReady=function(a){"use strict";this.isReady()?setTimeout(a,0):this.once("ready",a)};e.exports=a}),null);
__d("PhotoSnowliftViewableImageWrapper",["Event","EventProfiler","ImageUtils","PhotoSnowliftViewable","TimeSlice","Vector"],(function(a,b,c,d,e,f){__p&&__p();var g;c=babelHelpers.inherits(a,b("PhotoSnowliftViewable"));g=c&&c.prototype;function a(a){"use strict";__p&&__p();g.constructor.call(this);b("EventProfiler").tagCurrentActiveInteractionsAs("PSVImageWrapper");this.$PhotoSnowliftViewableImageWrapper1=a;this.getElement().appendChild(a);if(this.$PhotoSnowliftViewableImageWrapper1.complete)this.$PhotoSnowliftViewableImageWrapper2();else{a=b("TimeSlice").getGuardedContinuation("PhotoSnowLiftViewable photo load");b("Event").listen(this.$PhotoSnowliftViewableImageWrapper1,"load",a.bind(null,function(){return this.$PhotoSnowliftViewableImageWrapper2()}.bind(this)))}}a.prototype.$PhotoSnowliftViewableImageWrapper2=function(){"use strict";this.emit("ready"),b("EventProfiler").informPointOnActiveInteractions("snowlift_image_loaded",{isPointOfInterest:!0},!0)};a.prototype.isReady=function(){"use strict";return b("ImageUtils").hasLoaded(this.$PhotoSnowliftViewableImageWrapper1)};a.prototype.getNaturalDimensions=function(){"use strict";return this.$PhotoSnowliftViewableImageWrapper1&&this.$PhotoSnowliftViewableImageWrapper1.naturalWidth&&this.$PhotoSnowliftViewableImageWrapper1.naturalHeight?b("Vector").from(this.$PhotoSnowliftViewableImageWrapper1.naturalWidth,this.$PhotoSnowliftViewableImageWrapper1.naturalHeight):g.getNaturalDimensions.call(this)};e.exports=a}),null);
__d("PhotoSnowliftViewablePhoto",["Bootloader","DOM","EncryptedImg","Event","EventProfiler","ImageUtils","PhotoSnowliftViewable","TimeSlice","Vector"],(function(a,b,c,d,e,f){__p&&__p();var g;function h(a,c){a.src&&a.complete?setTimeout(c,0):(function(){var d=b("Event").listen(a,"load",function(){d.remove(),c()})})()}function i(a,c){b("EncryptedImg").isEncrypted(c)?b("EncryptedImg").insertIntoDOM(c,a):a.src=c}c=babelHelpers.inherits(a,b("PhotoSnowliftViewable"));g=c&&c.prototype;function a(a,c){__p&&__p();var d=arguments.length<=2||arguments[2]===undefined?!1:arguments[2],e=arguments[3],f=arguments[4],h=arguments.length<=5||arguments[5]===undefined?!1:arguments[5],i=arguments.length<=6||arguments[6]===undefined?!1:arguments[6],j=arguments[7],k=arguments.length<=8||arguments[8]===undefined?!1:arguments[8];g.constructor.call(this);b("EventProfiler").tagCurrentActiveInteractionsAs("PSVPhoto");this.$PhotoSnowliftViewablePhoto2=e;this.$PhotoSnowliftViewablePhoto7=a;this.$PhotoSnowliftViewablePhoto6=c;this.$PhotoSnowliftViewablePhoto3=d;this.$PhotoSnowliftViewablePhoto1=j;this.$PhotoSnowliftViewablePhoto8=f;this.$PhotoSnowliftViewablePhoto9=h;this.$PhotoSnowliftViewablePhoto10=i;this.$PhotoSnowliftViewablePhoto11=k;this.addListener("imageloaded",function(a){return this.$PhotoSnowliftViewablePhoto13(a)}.bind(this));this.$PhotoSnowliftViewablePhoto14()}a.prototype.$PhotoSnowliftViewablePhoto14=function(){"use strict";__p&&__p();this.$PhotoSnowliftViewablePhoto4&&this.$PhotoSnowliftViewablePhoto4.parentElement&&this.$PhotoSnowliftViewablePhoto4.parentElement.removeChild(this.$PhotoSnowliftViewablePhoto4);var a=b("DOM").create("img",{className:"spotlight",alt:this.$PhotoSnowliftViewablePhoto1});this.$PhotoSnowliftViewablePhoto2&&this.$PhotoSnowliftViewablePhoto2.setElementDimensions(a);this.$PhotoSnowliftViewablePhoto4=a;this.$PhotoSnowliftViewablePhoto4.setAttribute("aria-busy","true");this.getElement().appendChild(this.$PhotoSnowliftViewablePhoto4);this.$PhotoSnowliftViewablePhoto12=b("TimeSlice").getGuardedContinuation("PhotoSnowliftViewable image load");this.$PhotoSnowliftViewablePhoto15(this.$PhotoSnowliftViewablePhoto16());h(this.$PhotoSnowliftViewablePhoto4,this.$PhotoSnowliftViewablePhoto12.bind(undefined,function(){this.emit("imageloaded",a)}.bind(this)));this.whenReady(function(){return this.$PhotoSnowliftViewablePhoto17()}.bind(this));this.$PhotoSnowliftViewablePhoto18();this.$PhotoSnowliftViewablePhoto19()};a.prototype.$PhotoSnowliftViewablePhoto19=function(){"use strict";this.$PhotoSnowliftViewablePhoto10&&!this.$PhotoSnowliftViewablePhoto9&&b("Bootloader").loadModules(["PhotoSnowliftViewableWithContextMenuLogging"],function(a){a=a.setupContextMenuLogging;a(this.getElement(),this.$PhotoSnowliftViewablePhoto8)}.bind(this),"PhotoSnowliftViewablePhoto")};a.prototype.$PhotoSnowliftViewablePhoto18=function(){"use strict";if(!this.$PhotoSnowliftViewablePhoto11)return;b("Bootloader").loadModules(["PhotoSnowliftViewableWithShieldIconOverlay"],function(a){a=a.setupShieldIconOverlay;a(this.getElement())}.bind(this),"PhotoSnowliftViewablePhoto")};a.prototype.$PhotoSnowliftViewablePhoto15=function(a){"use strict";this.$PhotoSnowliftViewablePhoto5=a,i(this.$PhotoSnowliftViewablePhoto4,this.$PhotoSnowliftViewablePhoto5)};a.prototype.$PhotoSnowliftViewablePhoto13=function(a){"use strict";if(this.$PhotoSnowliftViewablePhoto4!==a)return;this.emit("ready")};a.prototype.reload=function(){"use strict";this.$PhotoSnowliftViewablePhoto12&&b("TimeSlice").cancel(this.$PhotoSnowliftViewablePhoto12),this.$PhotoSnowliftViewablePhoto14()};a.prototype.$PhotoSnowliftViewablePhoto16=function(){"use strict";return this.$PhotoSnowliftViewablePhoto3?this.$PhotoSnowliftViewablePhoto7:this.$PhotoSnowliftViewablePhoto6||this.$PhotoSnowliftViewablePhoto7};a.prototype.$PhotoSnowliftViewablePhoto17=function(){"use strict";this.$PhotoSnowliftViewablePhoto4.setAttribute("aria-busy","false")};a.prototype.isReady=function(){"use strict";return this.$PhotoSnowliftViewablePhoto4.src&&b("ImageUtils").hasLoaded(this.$PhotoSnowliftViewablePhoto4)};a.prototype.getNaturalDimensions=function(){"use strict";if(this.$PhotoSnowliftViewablePhoto2)return this.$PhotoSnowliftViewablePhoto2;return this.$PhotoSnowliftViewablePhoto4&&this.$PhotoSnowliftViewablePhoto4.naturalWidth&&this.$PhotoSnowliftViewablePhoto4.naturalHeight?b("Vector").from(this.$PhotoSnowliftViewablePhoto4.naturalWidth,this.$PhotoSnowliftViewablePhoto4.naturalHeight):g.getNaturalDimensions.call(this)};a.prototype.$PhotoSnowliftViewablePhoto20=function(){"use strict";return this.$PhotoSnowliftViewablePhoto5===this.$PhotoSnowliftViewablePhoto7};a.prototype.onToggleIntoFullScreen=function(){"use strict";this.$PhotoSnowliftViewablePhoto20()||this.$PhotoSnowliftViewablePhoto5!==this.$PhotoSnowliftViewablePhoto7&&i(new Image(),this.$PhotoSnowliftViewablePhoto7)};a.prototype.onEnterFullScreen=function(){"use strict";this.$PhotoSnowliftViewablePhoto20()||this.$PhotoSnowliftViewablePhoto15(this.$PhotoSnowliftViewablePhoto7)};e.exports=a}),null);
__d("SphericalMediaActions",[],(function(a,b,c,d,e,f){"use strict";e.exports={TURN_ON:"TURN_ON",TURN_OFF:"TURN_OFF",ENABLE_SPHERICAL:"ENABLE_SPHERICAL",DISABLE_SPHERICAL:"DISABLE_SPHERICAL",REQUEST_PHOTO_FAILED:"REQUEST_PHOTO_FAILED",REQUEST_PHOTO:"REQUEST_PHOTO",RECEIVE_PHOTO:"RECEIVE_PHOTO",UPDATE_BASE:"UPDATE_BASE",DRAG_START:"DRAG_START",GYRO_START:"GYRO_START",ZOOM_START:"ZOOM_START",SIGNIFICANT_MOVE:"SIGNIFICANT_MOVE",MOUSE_ANIMATION_START:"MOUSE_ANIMATION_START",MOUSE_ENTER:"MOUSE_ENTER",TAP_HEADING_INDICATOR:"TAP_HEADING_INDICATOR",VIEWPORT_CLICKED:"VIEWPORT_CLICKED",VISIBILITY_CHANGED:"VISIBILITY_CHANGED",UPDATE_DIMENSION:"UPDATE_DIMENSION",UPDATE_INITIAL_FOV:"UPDATE_INITIAL_FOV",UPDATE_INITIAL_VIEWPORT:"UPDATE_INITIAL_VIEWPORT",SETUP_RENDERER:"SETUP_RENDERER",WEBGL_CONTEXT_LOST:"WEBGL_CONTEXT_LOST",WEBGL_INIT_FAILED:"WEBGL_INIT_FAILED",WEBGL_RENDER_FAILED:"WEBGL_RENDER_FAILED",SOURCE_ONLOAD:"SOURCE_ONLOAD",REPLACE_BASE_STATE:"REPLACE_BASE_STATE",UPDATE_CTR_ELEM:"UPDATE_CTR_ELEM",SHOW_FALLBACK:"SHOW_FALLBACK",FALLBACK_MOUSE_OVER:"FALLBACK_MOUSE_OVER",FALLBACK_MOUSE_OUT:"FALLBACK_MOUSE_OUT",FALLBACK_INDICATOR_MOUSE_OVER:"FALLBACK_INDICATOR_MOUSE_OVER",FALLBACK_INDICATOR_MOUSE_OUT:"FALLBACK_INDICATOR_MOUSE_OUT",UPDATE_PARTIAL_LIMITS:"UPDATE_PARTIAL_LIMITS",USE_FALLBACK:"USE_FALLBACK",UPDATE_VIEW:"UPDATE_VIEW",UPDATE_VIEWPORT:"UPDATE_VIEWPORT",UPDATE_FOV:"UPDATE_FOV",UPDATE_YAW:"UPDATE_YAW",UPDATE_VIEWPORT_AND_FOV:"UPDATE_VIEWPORT_AND_FOV",START_ANIMATING:"START_ANIMATING",STOP_ANIMATING:"STOP_ANIMATING",UPDATE_FEED_ROOT_ELEMENT:"UPDATE_FEED_ROOT_ELEMENT",UPDATE_PHOTO_EDIT:"UPDATE_PHOTO_EDIT",CANCEL_EDITING:"CANCEL_EDITING",START_EDITING:"START_EDITING",STOP_EDITING:"STOP_EDITING",UPDATE_PHOTO:"UPDATE_PHOTO",UPDATE_PHOTO_FAILED:"UPDATE_PHOTO_FAILED",UPDATE_PHOTO_DONE:"UPDATE_PHOTO_DONE",UPDATE_RENDERER_PROJECTION_TYPE:108,UPDATE_RENDERER_PROJECTION_TYPE_FAILED:109,UPDATE_RENDERER_PROJECTION_TYPE_DONE:110,RESET_MOUSE_ANIMATION:"RESET_MOUSE_ANIMATION",START_MOUSE_ANIMATION:"START_MOUSE_ANIMATION",STOP_MOUSE_ANIMATION:"STOP_MOUSE_ANIMATION",DISABLE_SPHERICAL_ON_SAVE:"DISABLE_SPHERICAL_ON_SAVE",ENABLE_SPHERICAL_ON_SAVE:"ENABLE_SPHERICAL_ON_SAVE",ENABLE_EDITING:"ENABLE_EDITING",DISABLE_EDITING:"DISABLE_EDITING",TAKE_STATE_SNAPSHOT:"TAKE_STATE_SNAPSHOT",RESTORE_EDIT_STATE_FROM_SNAPSHOT:"RESTORE_EDIT_STATE_FROM_SNAPSHOT",RESTORE_TAGS_STATE_FROM_SNAPSHOT:"RESTORE_TAGS_STATE_FROM_SNAPSHOT",REMOVE_STATE_SNAPSHOT:"REMOVE_STATE_SNAPSHOT",PHOTO_REMOVED:"PHOTO_REMOVED",UPDATE_FILE_URL:"UPDATE_FILE_URL",CANVAS_RESIZE_START:"CANVAS_RESIZE_START",CANVAS_RESIZE_IMG_LOADED:"CANVAS_RESIZE_IMG_LOADED",CANVAS_RESIZE_SUCCESS:"CANVAS_RESIZE_SUCCESS",CANVAS_RESIZE_FAILED:"CANVAS_RESIZE_FAILED",OPEN_TAG_DIALOG:"OPEN_TAG_DIALOG",CLOSE_TAG_DIALOG:"CLOSE_TAG_DIALOG",SAVE_DIALOG_TAGS:"SAVE_DIALOG_TAGS",CANCEL_DIALOG_TAG_CHANGES:"CANCEL_DIALOG_TAG_CHANGES",PHOTO_RENDERER_STATS:"PHOTO_RENDERER_STATS",ENABLE_TAGGING:"ENABLE_TAGGING",DISABLE_TAGGING:"DISABLE_TAGGING",UPDATE_SPATIAL_TAGS:"UPDATE_SPATIAL_TAGS",UPDATE_SPATIAL_TAGS_FROM_COMPOSER:"UPDATE_SPATIAL_TAGS_FROM_COMPOSER",UPDATE_TAG_UNDER_MOUSE:"UPDATE_TAG_UNDER_MOUSE",TAGGING_START:"TAGGING_START",TAGGING_STOP:"TAGGING_STOP",UPDATE_TAG_CLICKED:"UPDATE_TAG_CLICKED",UPDATE_TAGGER:"UPDATE_TAGGER",ENTER_TAGGING_MODE:"ENTER_TAGGING_MODE",EXIT_TAGGING_MODE:"EXIT_TAGGING_MODE",UPDATE_TARGETED_TAG:"UPDATE_TARGETED_TAG",REDIRECT_FROM_CLICKED_TAG:"REDIRECT_FROM_CLICKED_TAG",DELETED_SPATIAL_TAG:"DELETED_SPATIAL_TAG",ADD_SPATIAL_TAG_FROM_PHOTO_TAGGER:"ADD_SPATIAL_TAG_FROM_PHOTO_TAGGER"}}),null);
__d("SphericalMediaActionNamespaces",[],(function(a,b,c,d,e,f){"use strict";e.exports={BASE:"BASE",CORE:"CORE",PHOTO:"PHOTO",PHOTO_EDIT:"PHOTO_EDIT",VIEW:"VIEW"}}),null);
__d("SphericalMediaBaseActions",["SphericalMediaActionNamespaces","SphericalMediaActions"],(function(a,b,c,d,e,f){"use strict";__p&&__p();e.exports={updateBase:function(a){return{namespace:b("SphericalMediaActionNamespaces").BASE,type:b("SphericalMediaActions").UPDATE_BASE,data:a}},dragStart:function(){return{namespace:b("SphericalMediaActionNamespaces").BASE,type:b("SphericalMediaActions").DRAG_START}},gyroStart:function(){return{namespace:b("SphericalMediaActionNamespaces").BASE,type:b("SphericalMediaActions").GYRO_START}},mouseAnimationStart:function(){return{namespace:b("SphericalMediaActionNamespaces").BASE,type:b("SphericalMediaActions").MOUSE_ANIMATION_START}},mouseEnter:function(){return{namespace:b("SphericalMediaActionNamespaces").BASE,type:b("SphericalMediaActions").MOUSE_ENTER}},tapHeadingIndicator:function(){return{namespace:b("SphericalMediaActionNamespaces").BASE,type:b("SphericalMediaActions").TAP_HEADING_INDICATOR}},significantMove:function(a){return{namespace:b("SphericalMediaActionNamespaces").BASE,type:b("SphericalMediaActions").SIGNIFICANT_MOVE,data:{view:a}}},viewportClicked:function(){return{namespace:b("SphericalMediaActionNamespaces").BASE,type:b("SphericalMediaActions").VIEWPORT_CLICKED}},visibilityChanged:function(a){return{namespace:b("SphericalMediaActionNamespaces").BASE,type:b("SphericalMediaActions").VISIBILITY_CHANGED,data:a}},zoomStart:function(){return{namespace:b("SphericalMediaActionNamespaces").BASE,type:b("SphericalMediaActions").ZOOM_START}},updateDimension:function(a,c){return{namespace:b("SphericalMediaActionNamespaces").BASE,type:b("SphericalMediaActions").UPDATE_DIMENSION,data:{width:a,height:c}}},updateInitialViewport:function(a,c){return{namespace:b("SphericalMediaActionNamespaces").BASE,type:b("SphericalMediaActions").UPDATE_INITIAL_VIEWPORT,data:{initialYaw:a,initialPitch:c}}},updateInitialFOV:function(a){return{namespace:b("SphericalMediaActionNamespaces").BASE,type:b("SphericalMediaActions").UPDATE_INITIAL_FOV,data:{initialFov:a}}},setupRenderer:function(a,c){return{namespace:b("SphericalMediaActionNamespaces").BASE,type:b("SphericalMediaActions").SETUP_RENDERER,data:{renderer:a,dt:c}}},webGlInitFailed:function(a){return{namespace:b("SphericalMediaActionNamespaces").BASE,type:b("SphericalMediaActions").WEBGL_INIT_FAILED,data:{error:a}}},webGlRenderFailed:function(a,c){return{namespace:b("SphericalMediaActionNamespaces").BASE,type:b("SphericalMediaActions").WEBGL_RENDER_FAILED,data:{error:a,view:c}}},webGlContextLost:function(){return{namespace:b("SphericalMediaActionNamespaces").BASE,type:b("SphericalMediaActions").WEBGL_CONTEXT_LOST}},sourceOnLoad:function(){return{namespace:b("SphericalMediaActionNamespaces").BASE,type:b("SphericalMediaActions").SOURCE_ONLOAD}},replaceBaseState:function(a){return{namespace:b("SphericalMediaActionNamespaces").BASE,type:b("SphericalMediaActions").REPLACE_BASE_STATE,data:a}},updateSpatialTags:function(a){return{namespace:b("SphericalMediaActionNamespaces").BASE,type:b("SphericalMediaActions").UPDATE_SPATIAL_TAGS,data:a}},updateSpatialTagsFromComposer:function(a){return{namespace:b("SphericalMediaActionNamespaces").BASE,type:b("SphericalMediaActions").UPDATE_SPATIAL_TAGS_FROM_COMPOSER,data:a}},updateTagUnderMouse:function(a){return{namespace:b("SphericalMediaActionNamespaces").BASE,type:b("SphericalMediaActions").UPDATE_TAG_UNDER_MOUSE,data:a}},updateFileURL:function(a){return{namespace:b("SphericalMediaActionNamespaces").BASE,type:b("SphericalMediaActions").UPDATE_FILE_URL,data:a}},canvasResizeStart:function(){return{namespace:b("SphericalMediaActionNamespaces").BASE,type:b("SphericalMediaActions").CANVAS_RESIZE_START}},canvasResizeImgLoaded:function(a,c){return{namespace:b("SphericalMediaActionNamespaces").BASE,type:b("SphericalMediaActions").CANVAS_RESIZE_IMG_LOADED,data:{width:a,height:c}}},canvasResizeSuccess:function(a){return{namespace:b("SphericalMediaActionNamespaces").BASE,type:b("SphericalMediaActions").CANVAS_RESIZE_SUCCESS,data:a}},canvasResizeFailed:function(a){return{namespace:b("SphericalMediaActionNamespaces").BASE,type:b("SphericalMediaActions").CANVAS_RESIZE_FAILED,data:a}},enableTagging:function(){return{namespace:b("SphericalMediaActionNamespaces").BASE,type:b("SphericalMediaActions").ENABLE_TAGGING}},disableTagging:function(){return{namespace:b("SphericalMediaActionNamespaces").BASE,type:b("SphericalMediaActions").DISABLE_TAGGING}},taggingStart:function(){return{namespace:b("SphericalMediaActionNamespaces").BASE,type:b("SphericalMediaActions").TAGGING_START}},taggingStop:function(){return{namespace:b("SphericalMediaActionNamespaces").BASE,type:b("SphericalMediaActions").TAGGING_STOP}},updateTagClicked:function(a){return{namespace:b("SphericalMediaActionNamespaces").BASE,type:b("SphericalMediaActions").UPDATE_TAG_CLICKED,data:a}},updateTagger:function(a){return{namespace:b("SphericalMediaActionNamespaces").BASE,type:b("SphericalMediaActions").UPDATE_TAGGER,data:a}},enterTaggingMode:function(){return{namespace:b("SphericalMediaActionNamespaces").BASE,type:b("SphericalMediaActions").ENTER_TAGGING_MODE}},exitTaggingMode:function(){return{namespace:b("SphericalMediaActionNamespaces").BASE,type:b("SphericalMediaActions").EXIT_TAGGING_MODE}},updateTargetedTag:function(a){return{namespace:b("SphericalMediaActionNamespaces").BASE,type:b("SphericalMediaActions").UPDATE_TARGETED_TAG,data:a}},redirectFromClickedTag:function(){return{namespace:b("SphericalMediaActionNamespaces").BASE,type:b("SphericalMediaActions").REDIRECT_FROM_CLICKED_TAG}},deletedSpatialTag:function(){return{namespace:b("SphericalMediaActionNamespaces").BASE,type:b("SphericalMediaActions").DELETED_SPATIAL_TAG}},addSpatialTagFromPhotoTagger:function(){return{namespace:b("SphericalMediaActionNamespaces").BASE,type:b("SphericalMediaActions").ADD_SPATIAL_TAG_FROM_PHOTO_TAGGER}},updateCtrElem:function(a){return{namespace:b("SphericalMediaActionNamespaces").BASE,type:b("SphericalMediaActions").UPDATE_CTR_ELEM,data:{element:a}}},showFallbackUI:function(){return{namespace:b("SphericalMediaActionNamespaces").BASE,type:b("SphericalMediaActions").SHOW_FALLBACK}},requestPhoto:function(){return{namespace:b("SphericalMediaActionNamespaces").BASE,type:b("SphericalMediaActions").REQUEST_PHOTO}},requestPhotoFailed:function(a,c){return{namespace:b("SphericalMediaActionNamespaces").BASE,type:b("SphericalMediaActions").REQUEST_PHOTO_FAILED,data:{id:a,error:c}}},receivePhoto:function(a,c){return{namespace:b("SphericalMediaActionNamespaces").BASE,type:b("SphericalMediaActions").RECEIVE_PHOTO,data:c}},updatePartialLimits:function(a){return{namespace:b("SphericalMediaActionNamespaces").BASE,type:b("SphericalMediaActions").UPDATE_PARTIAL_LIMITS,data:a}},useFallbackUI:function(){return{namespace:b("SphericalMediaActionNamespaces").BASE,type:b("SphericalMediaActions").USE_FALLBACK}},updateFeedRootElement:function(a){return{namespace:b("SphericalMediaActionNamespaces").BASE,type:b("SphericalMediaActions").UPDATE_FEED_ROOT_ELEMENT,data:a}}}}),null);
__d("SphericalMediaBootloaded.react",["cx","BootloadedComponent.react","JSResource","LoadingIndicator.react","React","SphericalMediaConstants"],(function(a,b,c,d,e,f,g){"use strict";__p&&__p();var h,i=b("SphericalMediaConstants").COMP_PHOTO_EDIT_THUMB,j=b("SphericalMediaConstants").COMP_PHOTO_VIEWER,k=function(a,c){return b("React").createElement("div",{className:a,style:c},b("React").createElement(b("LoadingIndicator.react"),{className:"_4qlq",size:"small",color:"white"}))};h=babelHelpers.inherits(a,b("React").PureComponent);h&&h.prototype;a.prototype.render=function(){var a=void 0;switch(this.props.componentName){case i:var c=this.props.loadingElement||k("_7d7",{width:this.props.width,height:this.props.height});return b("React").createElement(b("BootloadedComponent.react"),babelHelpers["extends"]({bootloadLoader:b("JSResource")("SphericalPhotoEditThumbnail.react").__setRef("SphericalMediaBootloaded.react"),bootloadPlaceholder:c},this.props));case j:a=b("React").createElement("div",null);return b("React").createElement(b("BootloadedComponent.react"),babelHelpers["extends"]({bootloadLoader:b("JSResource")("SphericalPhotoViewer.react").__setRef("SphericalMediaBootloaded.react"),bootloadPlaceholder:a},this.props));default:return null}};function a(){h.apply(this,arguments)}e.exports=a}),null);
__d("SphericalMediaGyroOverlay.react",["cx","CSS","React","ReactDOM","joinClasses"],(function(a,b,c,d,e,f,g){"use strict";__p&&__p();var h,i=800,j=function(a){var b=arguments.length<=1||arguments[1]===undefined?!0:arguments[1],c=arguments.length<=2||arguments[2]===undefined?!1:arguments[2];return{gyroRoot:"_1zvy"+(a?" _2dz7":"")+(b?" _4z8s":"")+(c?" _4z8p":""),gyroOuter:"_4z8q",gyroInner:"_4z8r",gyroMeridian:"_4z8t",gyroEquator:"_4z8u",gyroTextShell:"_4z8v",gyroText:"_4z8w"}};h=babelHelpers.inherits(a,b("React").PureComponent);h&&h.prototype;a.prototype.componentDidUpdate=function(a){if(a.isActive&&!this.props.isActive)setTimeout(function(){var a=b("ReactDOM").findDOMNode(this);a instanceof Element&&b("CSS").hide(a)}.bind(this),i);else if(!this.props.isActive){a=b("ReactDOM").findDOMNode(this);a instanceof Element&&b("CSS").hide(a)}};a.prototype.componentDidMount=function(){if(!this.props.isActive){var a=b("ReactDOM").findDOMNode(this);a instanceof Element&&b("CSS").hide(a)}};a.prototype.render=function(){var a=this.props,c=a.className,d=a.isActive,e=a.isInfinite;a=a.isPaused;d=j(d,e,a);return b("React").createElement("div",{className:b("joinClasses")(c,d.gyroRoot)},b("React").createElement("div",{className:d.gyroOuter},b("React").createElement("div",{className:d.gyroInner},b("React").createElement("div",{className:d.gyroMeridian}),b("React").createElement("div",{className:d.gyroEquator})),b("React").createElement("div",{className:d.gyroTextShell},b("React").createElement("span",{className:d.gyroText},"360"))))};function a(){h.apply(this,arguments)}e.exports=a}),null);
__d("SphericalPhotoPlaceHolderWithGyroOverlay.react",["cx","BackgroundImage.react","Image.react","React","SphericalMediaGyroOverlay.react"],(function(a,b,c,d,e,f,g){"use strict";var h;h=babelHelpers.inherits(a,b("React").PureComponent);h&&h.prototype;a.prototype.render=function(){return b("React").createElement("div",{className:"_5nxw _1c1o"},this.props.showNewRenderer?b("React").createElement(b("BackgroundImage.react"),{backgroundSize:"contain",height:this.props.height,src:this.props.placeholderImageURL,width:this.props.width}):b("React").createElement(b("Image.react"),{className:"_1c1p",height:this.props.height,src:this.props.placeholderImageURL,width:this.props.width}),b("React").createElement(b("SphericalMediaGyroOverlay.react"),{className:"_1c1q",isActive:!0}))};function a(){h.apply(this,arguments)}e.exports=a}),null);
__d("SphericalPhotoViewerLogEvents",[],(function(a,b,c,d,e,f){e.exports=Object.freeze({CDN_IMAGE_FAILURE:"spherical_photo_cdn_image_failure",CUBE_LOAD_TIME:"spherical_photo_cube_load_time",DRAG_MOUSE_ANIMATION:"spherical_photo_drag_mouse_animation",DRAG_START:"spherical_photo_drag_start",ENTER_FULLSCREEN:"spherical_photo_tap_feed_to_fullscreen",EXIT_FULLSCREEN:"spherical_photo_fullscreen_exited",FALLBACK_LEARNMORE:"spherical_photo_fallback_learnmore",FALLBACK_PREVIEW:"spherical_photo_fallback_preview",FEED_VP_ENTERED:"spherical_photo_feed_vp_entered",FEED_VP_EXITED:"spherical_photo_feed_vp_exited",LOADED:"spherical_photo_loaded",MOUSEOVER_START:"spherical_photo_mouseover_start",PHONE_PAN_ANIMATION:"spherical_photo_phone_pan_animation",RENDER_FRAME_RATE:"spherical_photo_render_frame_rate",RENDERER_SETUP:"spherical_photo_renderer_setup",RENDERER_STATS:"spherical_photo_renderer_stats",SHOW_VIEW_IN_VR:"spherical_photo_show_view_in_vr",SIGNIFICANT_MOVEMENT:"spherical_photo_significant_movement",TAP_HEADING_INDICATOR:"spherical_photo_tap_heading_indicator",TAP_VIEW_IN_VR:"spherical_photo_tap_view_in_vr",WEBGL_CONTEXT_LOST:"spherical_photo_webgl_context_lost",WEBGL_INIT_FAILURE:"spherical_photo_webgl_init_failure",WEBGL_RENDER_FAILURE:"spherical_photo_webgl_render_failure",M_SENSOR_SETUP_FAILURE:"spherical_photo_m_sensor_setup_failure",WWW_ENTER_SNOWLIFT:"spherical_photo_www_enter_snowlift",WWW_EXIT_SNOWLIFT:"spherical_photo_www_exit_snowlift",WWW_GYRO_START:"spherical_photo_www_gyro_start",ZOOM_START:"spherical_photo_zoom_start",INITIAL_VIEW_MODIFIED:"spherical_photo_initial_view_modified",POST_EVENT:"spherical_photo_post_event",TOGGLE_OFF:"spherical_photo_toggle_off",TOGGLE_ON:"spherical_photo_toggle_on",WWW_IVS_OPEN:"spherical_photo_www_ivs_open",WWW_IVS_CANCEL:"spherical_photo_www_ivs_cancel",WWW_IVS_ENABLE_ON_SAVE:"spherical_photo_www_ivs_enable_on_save",WWW_IVS_DISABLE_ON_SAVE:"spherical_photo_www_ivs_disable_on_save",WWW_IVS_REQUEST_DONE:"spherical_photo_www_ivs_request_done",WWW_IVS_REQUEST_FAILED:"spherical_photo_www_ivs_request_failed",WWW_IVS_REQUEST_START:"spherical_photo_www_ivs_request_start",WWW_IVS_UPDATE_DONE:"spherical_photo_www_ivs_update_done",WWW_IVS_UPDATE_FAILED:"spherical_photo_www_ivs_update_failed",WWW_IVS_UPDATE_START:"spherical_photo_www_ivs_update_start",SERVER_IVS_UPDATE_DONE:"spherical_photo_server_ivs_update_done",SERVER_IVS_UPDATE_FAILED:"spherical_photo_server_ivs_update_failed",SERVER_IVS_UPDATE_START:"spherical_photo_server_ivs_update_start",DRAG_START_DEPRECATED:"drag_start_360_photo",PHONE_PAN_ANIMATION_DEPRECATED:"phone_pan_animation_360_photo",SHOW_VIEW_IN_VR_DEPRECATED:"show_360_photo_view_in_vr",SIGNIFICANT_MOVEMENT_DEPRECATED:"significant_movement_360_photo",TAP_FEED_TO_FULLSCREEN_DEPRECATED:"tap_360_photo_feed_to_fullscreen",TAP_HEADING_INDICATOR_DEPRECATED:"tap_360_photo_heading_indicator",TAP_VIEW_IN_VR_DEPRECATED:"tap_360_photo_view_in_vr",ZOOM_START_DEPRECATED:"zoom_start_360_photo"})}),null);
__d("SphericalPhotoViewerLoggerUtil",["Bootloader","CSS","FullScreen","ProfileTabUtils","SphericalPhotoViewerLogEvents","SphericalPhotoViewerTypedLogger","URI","SphericalMediaConstants"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g="timelineLayout",h=b("SphericalMediaConstants").LOGGER_SURFACES,i=function(a){__p&&__p();if(b("FullScreen").isFullScreen())return h.fullpage;var c=b("URI").getMostRecentURI();if(Object.prototype.hasOwnProperty.call(c.getQueryData(),"theater"))return h.snowlift;if(c.getPath()==="/"||c.getPath()==="/home.php")return h.newsfeed;var d=a.getTabKeyFromURI(c);a=a.getVanityFromURI(c);return a&&b("ProfileTabUtils").isTimelineTab(d)&&document.body&&b("CSS").hasClass(document.body,g)?h.timeline:h.other},j={logTapHeadingIndicator:function(){var a=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];j._log(b("SphericalPhotoViewerLogEvents").TAP_HEADING_INDICATOR,a)},logDragStart:function(){var a=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];j._log(b("SphericalPhotoViewerLogEvents").DRAG_START,a)},logMouseOverStart:function(){var a=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];j._log(b("SphericalPhotoViewerLogEvents").MOUSEOVER_START,a)},logWWWGyroStart:function(){var a=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];j._log(b("SphericalPhotoViewerLogEvents").WWW_GYRO_START,a)},logZoomStart:function(){var a=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];j._log(b("SphericalPhotoViewerLogEvents").ZOOM_START,a)},logDragMouseAnimation:function(){var a=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];j._log(b("SphericalPhotoViewerLogEvents").DRAG_MOUSE_ANIMATION,a)},logEnterSnowlift:function(){var a=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];j._log(b("SphericalPhotoViewerLogEvents").WWW_ENTER_SNOWLIFT,a)},logExitSnowlift:function(){var a=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];j._log(b("SphericalPhotoViewerLogEvents").WWW_EXIT_SNOWLIFT,a)},logEnterFullScreen:function(){var a=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];j._log(b("SphericalPhotoViewerLogEvents").ENTER_FULLSCREEN,a)},logExitFullScreen:function(){var a=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];j._log(b("SphericalPhotoViewerLogEvents").EXIT_FULLSCREEN,a)},logSignificantMovement:function(){var a=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];j._log(b("SphericalPhotoViewerLogEvents").SIGNIFICANT_MOVEMENT,a)},logIVSOpen:function(){var a=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];j._log(b("SphericalPhotoViewerLogEvents").WWW_IVS_OPEN,a)},logIVSCancel:function(){var a=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];j._log(b("SphericalPhotoViewerLogEvents").WWW_IVS_CANCEL,a)},logIVSEnableSphericalOnSave:function(){var a=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];j._log(b("SphericalPhotoViewerLogEvents").WWW_IVS_ENABLE_ON_SAVE,a)},logIVSDisableSphericalOnSave:function(){var a=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];j._log(b("SphericalPhotoViewerLogEvents").WWW_IVS_DISABLE_ON_SAVE,a)},logToggleOn:function(){var a=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];j._log(b("SphericalPhotoViewerLogEvents").TOGGLE_ON,a)},logToggleOff:function(){var a=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];j._log(b("SphericalPhotoViewerLogEvents").TOGGLE_OFF,a)},logIVSRequestStart:function(){var a=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];j._log(b("SphericalPhotoViewerLogEvents").WWW_IVS_REQUEST_START,a)},logIVSRequestFailed:function(){var a=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];j._log(b("SphericalPhotoViewerLogEvents").WWW_IVS_REQUEST_FAILED,a)},logIVSRequestDone:function(){var a=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];j._log(b("SphericalPhotoViewerLogEvents").WWW_IVS_REQUEST_DONE,a)},logIVSUpdateStart:function(){var a=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];j._log(b("SphericalPhotoViewerLogEvents").WWW_IVS_UPDATE_START,a)},logIVSUpdateFailed:function(){var a=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];j._log(b("SphericalPhotoViewerLogEvents").WWW_IVS_UPDATE_FAILED,a)},logIVSUpdateDone:function(){var a=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];j._log(b("SphericalPhotoViewerLogEvents").WWW_IVS_UPDATE_DONE,a)},logWebGlInitFailed:function(){var a=arguments.length<=0||arguments[0]===undefined?{}:arguments[0],c=arguments.length<=1||arguments[1]===undefined?{}:arguments[1];j._log(b("SphericalPhotoViewerLogEvents").WEBGL_INIT_FAILURE,a,c)},logWebGlRenderFailed:function(){var a=arguments.length<=0||arguments[0]===undefined?{}:arguments[0],c=arguments.length<=1||arguments[1]===undefined?{}:arguments[1];j._log(b("SphericalPhotoViewerLogEvents").WEBGL_RENDER_FAILURE,a,c)},logWebGlContextLost:function(){var a=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];j._log(b("SphericalPhotoViewerLogEvents").WEBGL_CONTEXT_LOST,a)},logNumberOfSphericalPhoto:function(){var a=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];j._log(b("SphericalPhotoViewerLogEvents").POST_EVENT,a)},logRendererSetup:function(){var a=arguments.length<=0||arguments[0]===undefined?{}:arguments[0],c=arguments[1];a.renderMethod=c?"tiled":"cubestrip";j._log(b("SphericalPhotoViewerLogEvents").RENDERER_SETUP,a)},logRendererStats:function(){var a=arguments.length<=0||arguments[0]===undefined?{}:arguments[0],c=arguments.length<=1||arguments[1]===undefined?{}:arguments[1];j._log(b("SphericalPhotoViewerLogEvents").RENDERER_STATS,a,c)},_log:function(a,c){var d=arguments.length<=2||arguments[2]===undefined?{}:arguments[2];if(!c.surface){b("Bootloader").loadModules(["TimelineURI"],function(b){c.surface=i(b),j._logWithSurface(a,c,d)},"SphericalPhotoViewerLoggerUtil");return}j._logWithSurface(a,c,d)},_logWithSurface:function(a,c){var d=arguments.length<=2||arguments[2]===undefined?{}:arguments[2];new(b("SphericalPhotoViewerTypedLogger"))().setComposerSessionID(c.composerSessionID).setDt(c.dt).setErrorMessage(c.errorMessage).setName(a).setNumberOfSphericalPhoto(c.numberOfSphericalPhoto).setPhotoID(c.photoID).setPitch(c.pitch).setRenderMethod(c.renderMethod||"").setSphericalPhotoSessionID(c.sessionID).setSurface(c.surface).setVfov(c.vfov).setViewportHeight(c.viewportHeight).setViewportWidth(c.viewportWidth).setYaw(c.yaw).updateData(d).log()}};e.exports=j}),null);
__d("PhotoSnowliftViewableSphericalPhoto",["cx","Arbiter","Bootloader","CSS","DOM","DOMQuery","EventProfiler","PhotoSnowliftViewable","React","ReactDOM","SphericalMediaActions","SphericalMediaBaseActions","SphericalMediaBootloaded.react","SphericalMediaConstants","SphericalPhotoPlaceHolderWithGyroOverlay.react","SphericalPhotoTypedConfig","SphericalPhotoViewerLoggerUtil","SubscriptionsHandler","Vector","getViewportDimensions"],(function(a,b,c,d,e,f,g){"use strict";__p&&__p();var h,i=b("SphericalMediaBaseActions").deletedSpatialTag,j=b("SphericalMediaBaseActions").enterTaggingMode,k=b("SphericalMediaBaseActions").exitTaggingMode,l=b("SphericalMediaBaseActions").taggingStop,m=b("SphericalMediaBaseActions").updateDimension,n=b("SphericalMediaBaseActions").updateFeedRootElement,o=b("SphericalMediaBaseActions").updateSpatialTags,p=b("SphericalMediaBaseActions").updateTagger,q=b("SphericalMediaBaseActions").updateTargetedTag,r=b("SphericalMediaConstants").COMP_PHOTO_VIEWER,s=b("SphericalMediaConstants").LOGGER_SURFACES,t=b("SphericalMediaConstants").UNTAGGED_FACEBOX,u=b("SphericalPhotoViewerLoggerUtil").logEnterFullScreen,v=b("SphericalPhotoViewerLoggerUtil").logEnterSnowlift,w=b("SphericalPhotoViewerLoggerUtil").logExitFullScreen,x=b("SphericalPhotoViewerLoggerUtil").logExitSnowlift,y=2e3*16,z=360;c=babelHelpers.inherits(a,b("PhotoSnowliftViewable"));h=c&&c.prototype;function a(a,c,d,e,f,g,i){__p&&__p();var j=arguments.length<=7||arguments[7]===undefined?!1:arguments[7],k=arguments[8],l=arguments[9],m=arguments[10],n=arguments[11],o=arguments[12],p=arguments[13],q=arguments[14];h.constructor.call(this,y);A.call(this);b("EventProfiler").tagCurrentActiveInteractionsAs("PSVSphericalPhoto");this.$PhotoSnowliftViewableSphericalPhoto1=q;this.$PhotoSnowliftViewableSphericalPhoto2=d;this.$PhotoSnowliftViewableSphericalPhoto3=k;this.$PhotoSnowliftViewableSphericalPhoto6=p;this.$PhotoSnowliftViewableSphericalPhoto7=m;this.$PhotoSnowliftViewableSphericalPhoto8=!1;this.$PhotoSnowliftViewableSphericalPhoto9=j;this.$PhotoSnowliftViewableSphericalPhoto10=!1;this.$PhotoSnowliftViewableSphericalPhoto11=!1;this.$PhotoSnowliftViewableSphericalPhoto14=l;this.$PhotoSnowliftViewableSphericalPhoto15=n;this.$PhotoSnowliftViewableSphericalPhoto16=o;this.$PhotoSnowliftViewableSphericalPhoto17=c;this.$PhotoSnowliftViewableSphericalPhoto18=new(b("SubscriptionsHandler"))();this.$PhotoSnowliftViewableSphericalPhoto20=e;this.$PhotoSnowliftViewableSphericalPhoto21=a;this.$PhotoSnowliftViewableSphericalPhoto5=b("DOM").create("div",{className:"_zq_ _5nxw"});this.$PhotoSnowliftViewableSphericalPhoto4=b("DOM").create("div",{className:"_zr0 _5nxw"});this.getElement().appendChild(this.$PhotoSnowliftViewableSphericalPhoto5);this.getElement().appendChild(this.$PhotoSnowliftViewableSphericalPhoto4);b("CSS").addClass(this.getElement(),"_zr1");this.$PhotoSnowliftViewableSphericalPhoto12={fov:f,pitch:g,yaw:i};this.$PhotoSnowliftViewableSphericalPhoto19=new(b("SubscriptionsHandler"))();b("CSS").addClass(this.$PhotoSnowliftViewableSphericalPhoto15.stage,"_1ziy");this.$PhotoSnowliftViewableSphericalPhoto22();v(this.$PhotoSnowliftViewableSphericalPhoto23())}a.prototype.$PhotoSnowliftViewableSphericalPhoto23=function(){return{photoID:this.$PhotoSnowliftViewableSphericalPhoto7,surface:s.snowlift}};a.prototype.$PhotoSnowliftViewableSphericalPhoto24=function(a){this.$PhotoSnowliftViewableSphericalPhoto20.useTiledRenderer&&b("SphericalPhotoTypedConfig").show_new_renderer?b("ReactDOM").render(b("React").createElement(b("SphericalPhotoPlaceHolderWithGyroOverlay.react"),{placeholderImageURL:this.$PhotoSnowliftViewableSphericalPhoto25(),showNewRenderer:!0,width:a.x,height:a.y}),this.$PhotoSnowliftViewableSphericalPhoto4):b("ReactDOM").render(b("React").createElement(b("SphericalPhotoPlaceHolderWithGyroOverlay.react"),{placeholderImageURL:this.$PhotoSnowliftViewableSphericalPhoto25()}),this.$PhotoSnowliftViewableSphericalPhoto4)};a.prototype.$PhotoSnowliftViewableSphericalPhoto22=function(){var a=this.$PhotoSnowliftViewableSphericalPhoto26(),c=[this.$PhotoSnowliftViewableSphericalPhoto27,this.$PhotoSnowliftViewableSphericalPhoto28,this.$PhotoSnowliftViewableSphericalPhoto29,this.$PhotoSnowliftViewableSphericalPhoto30];b("SphericalPhotoTypedConfig").www_can_viewer_tag&&c.push(this.$PhotoSnowliftViewableSphericalPhoto31);this.$PhotoSnowliftViewableSphericalPhoto24(a);b("ReactDOM").render(b("React").createElement(b("SphericalMediaBootloaded.react"),{ambientAudio:this.$PhotoSnowliftViewableSphericalPhoto1,componentName:r,canvasNamespace:"Snowlift",cubeImageURI:this.$PhotoSnowliftViewableSphericalPhoto2,fallback:this.$PhotoSnowliftViewableSphericalPhoto6,enableGyro:!0,enableZoom:!0,enableTagging:!0,enableRubberBanding:!0,height:a.y,initialView:this.$PhotoSnowliftViewableSphericalPhoto12,photoID:this.$PhotoSnowliftViewableSphericalPhoto7,partialLimits:this.$PhotoSnowliftViewableSphericalPhoto14,photoSphereMetadata:this.$PhotoSnowliftViewableSphericalPhoto16,surface:s.snowlift,tiledSphericalConfig:this.$PhotoSnowliftViewableSphericalPhoto20,middlewares:c,useLargeVolumeIcon:!0,width:a.x}),this.$PhotoSnowliftViewableSphericalPhoto5);this.$PhotoSnowliftViewableSphericalPhoto10=!0;this.emit("ready")};a.prototype.$PhotoSnowliftViewableSphericalPhoto32=function(){this.$PhotoSnowliftViewableSphericalPhoto19.release(),this.$PhotoSnowliftViewableSphericalPhoto18.release(),b("ReactDOM").unmountComponentAtNode(this.$PhotoSnowliftViewableSphericalPhoto4),b("ReactDOM").unmountComponentAtNode(this.$PhotoSnowliftViewableSphericalPhoto5)};a.prototype.suspend=function(){this.$PhotoSnowliftViewableSphericalPhoto32()};a.prototype.resume=function(){this.$PhotoSnowliftViewableSphericalPhoto22()};a.prototype.reload=function(){this.$PhotoSnowliftViewableSphericalPhoto22()};a.prototype.hide=function(){b("CSS").shown(this.getElement())&&x(this.$PhotoSnowliftViewableSphericalPhoto23()),h.hide.call(this),this.$PhotoSnowliftViewableSphericalPhoto32()};a.prototype.getDimensions=function(){var a=b("getViewportDimensions")(),c=a.width;a=a.height;b("SphericalPhotoTypedConfig").should_snowlift_fit_to_screen?(this.$PhotoSnowliftViewableSphericalPhoto8||(c-=z),(!this.isRenderReady()||this.$PhotoSnowliftViewableSphericalPhoto16&&this.$PhotoSnowliftViewableSphericalPhoto16.ProjectionType==="transverse-cylindrical")&&(c=a=Math.min(c,a))):c=a=Math.min(c,a);return b("Vector").from(c,a)};a.prototype.$PhotoSnowliftViewableSphericalPhoto26=function(){return b("Vector").getElementDimensions(this.getElement())};a.prototype.$PhotoSnowliftViewableSphericalPhoto33=function(a){var c=this.getElement().parentElement;a=new(b("Vector"))(a.x,a.y);if(c&&c instanceof HTMLElement){c=b("Vector").getElementDimensions(c);var d=b("Vector").getElementDimensions(this.getElement());(c.x!==d.x||a.x<c.x||a.y<c.y)&&(a.x=c.x,a.y=c.y)}return a};a.prototype.isReady=function(){return this.$PhotoSnowliftViewableSphericalPhoto10};a.prototype.isRenderReady=function(){return this.$PhotoSnowliftViewableSphericalPhoto11};a.prototype.setDimensions=function(a){h.setDimensions.call(this,this.$PhotoSnowliftViewableSphericalPhoto33(a));if(this.$PhotoSnowliftViewableSphericalPhoto20.useTiledRenderer&&b("SphericalPhotoTypedConfig").show_new_renderer){a=this.$PhotoSnowliftViewableSphericalPhoto26();!this.$PhotoSnowliftViewableSphericalPhoto11&&(!this.$PhotoSnowliftViewableSphericalPhoto3||this.$PhotoSnowliftViewableSphericalPhoto3.x!==a.x||this.$PhotoSnowliftViewableSphericalPhoto3.y!==a.y)&&this.$PhotoSnowliftViewableSphericalPhoto24(a);this.$PhotoSnowliftViewableSphericalPhoto3=a}this.emit("onSetDimensions")};a.prototype.onToggleIntoFullScreen=function(){};a.prototype.onEnterFullScreen=function(){if(this.$PhotoSnowliftViewableSphericalPhoto8)return;this.$PhotoSnowliftViewableSphericalPhoto8=!0;this.emit("onEnterFullScreen");u(this.$PhotoSnowliftViewableSphericalPhoto23());b("CSS").addClass(this.getElement(),"_tz-")};a.prototype.onExitFullScreen=function(){if(!this.$PhotoSnowliftViewableSphericalPhoto8)return;this.$PhotoSnowliftViewableSphericalPhoto8=!1;this.emit("onExitFullScreen");w(this.$PhotoSnowliftViewableSphericalPhoto23());b("CSS").removeClass(this.getElement(),"_tz-")};a.prototype.$PhotoSnowliftViewableSphericalPhoto25=function(){return this.$PhotoSnowliftViewableSphericalPhoto9?this.$PhotoSnowliftViewableSphericalPhoto21:this.$PhotoSnowliftViewableSphericalPhoto17||this.$PhotoSnowliftViewableSphericalPhoto21};var A=function(){__p&&__p();this.$PhotoSnowliftViewableSphericalPhoto30=function(a){var b=a.dispatch;a.getState;b(n(this.$PhotoSnowliftViewableSphericalPhoto5));return function(a){return function(b){return a(b)}}}.bind(this),this.$PhotoSnowliftViewableSphericalPhoto31=function(a){__p&&__p();var c=a.dispatch,d=a.getState;this.$PhotoSnowliftViewableSphericalPhoto15.getTagger()?c(p(this.$PhotoSnowliftViewableSphericalPhoto15.getTagger())):this.$PhotoSnowliftViewableSphericalPhoto19.addSubscriptions(b("Arbiter").subscribe(this.$PhotoSnowliftViewableSphericalPhoto15.getEventString("TAGGER_READY"),function(a,b){c(p(this.$PhotoSnowliftViewableSphericalPhoto15.getTagger()))}.bind(this)));this.$PhotoSnowliftViewableSphericalPhoto19.addSubscriptions(b("Arbiter").subscribe("PhotoTagger.START_TAGGING",function(a,b){c(j())}),b("Arbiter").subscribe("PhotoTagger.STOP_TAGGING",function(a,b){c(k())}),b("Arbiter").subscribe("PhotoTags.SHOWTAG",function(a,e){b("Bootloader").loadModules(["SphericalMediaTaggingUtils"],function(a){a=a.getSpatialTagFromFBID;a=a(e,d().base.tags);c(q(a))},"PhotoSnowliftViewableSphericalPhoto")}),b("Arbiter").subscribe("PhotoTags.HIDETAG",function(a,b){c(q(null))}),b("Arbiter").subscribe(this.$PhotoSnowliftViewableSphericalPhoto15.getEventString("EXTRA_DATA_CHANGE"),function(a,b){__p&&__p();var d=this,e=b?b.spatialTags:null;e&&Array.isArray(e)&&(function(){__p&&__p();c(o(e));c(l());var a=0;e.forEach(function(b){b.type!==t&&a++});if(d.$PhotoSnowliftViewableSphericalPhoto13&&d.$PhotoSnowliftViewableSphericalPhoto13>a){var b=d.$PhotoSnowliftViewableSphericalPhoto13-a;for(var f=0;f<b;f++)c(i())}d.$PhotoSnowliftViewableSphericalPhoto13=a})()}.bind(this)));return function(a){return function(b){return a(b)}}}.bind(this),this.$PhotoSnowliftViewableSphericalPhoto29=function(a){__p&&__p();a.getState;return function(a){return function(c){if(c.type===b("SphericalMediaActions").SHOW_FALLBACK){this.$PhotoSnowliftViewableSphericalPhoto11=!0;b("CSS").hide(this.$PhotoSnowliftViewableSphericalPhoto4);var d=b("DOMQuery").scry(this.$PhotoSnowliftViewableSphericalPhoto15.stageWrapper,".fbPhotosPhotoActionsTag.tagButton");d.length>0&&b("CSS").hide(d[0])}return a(c)}.bind(this)}.bind(this)}.bind(this),this.$PhotoSnowliftViewableSphericalPhoto27=function(){return function(a){return function(c){c.type===b("SphericalMediaActions").SETUP_RENDERER&&(this.$PhotoSnowliftViewableSphericalPhoto11=!0,b("CSS").hide(this.$PhotoSnowliftViewableSphericalPhoto4),this.$PhotoSnowliftViewableSphericalPhoto15.adjustStageSize());return a(c)}.bind(this)}.bind(this)}.bind(this),this.$PhotoSnowliftViewableSphericalPhoto28=function(a){__p&&__p();a.getState;var c=a.dispatch;return function(a){return function(d){if(d.type===b("SphericalMediaActions").TURN_ON||d.type===b("SphericalMediaActions").SHOW_FALLBACK){var e=function(){var a=this.$PhotoSnowliftViewableSphericalPhoto26();c(m(a.x,a.y))}.bind(this);this.$PhotoSnowliftViewableSphericalPhoto18.addSubscriptions(this.addListener("onEnterFullScreen",e),this.addListener("onExitFullScreen",e),this.addListener("onSetDimensions",e));e()}return a(d)}.bind(this)}.bind(this)}.bind(this)};e.exports=a}),null);
__d("PhotoSnowliftViewableUtils",["cx","DOM","EventProfiler","PhotoSnowliftViewableImageWrapper","PhotoSnowliftViewablePhoto","PhotoSnowliftViewableSphericalPhoto","React","ReactDOM","SphericalMediaGyroOverlay.react"],(function(a,b,c,d,e,f,g){__p&&__p();var h=65,i=0,j=0;function a(a,c){return new(b("PhotoSnowliftViewableSphericalPhoto"))(a.url,a.smallurl,a.cubeImageURI,a.tiledSphericalConfig,a.initialView.fov||h,a.initialView.pitch||i,a.initialView.yaw||j,c.shouldShowHiRes(a),a.dimensions,a.partialLimits,String(a.fbid),c,a.photoSphereMetadata,a.fallback,a.ambientAudio)}function c(a,c){if(a.spherical)return new(b("PhotoSnowliftViewableSphericalPhoto"))(a.url,a.smallurl,a.spherical.cubestripuri,a.spherical.tiledsphericalconfig,a.spherical.initialviewverticalfov||h,a.spherical.initialpitch||i,a.spherical.initialheading||j,c.shouldShowHiRes(a),a.dimensions,a.spherical.partialLimits,String(a.info.fbid),c,a.spherical.photosphereMetadata,a.spherical.fallback,a.spherical.ambientAudio);else return new(b("PhotoSnowliftViewablePhoto"))(a.url,a.smallurl,c.shouldShowHiRes(a),a.dimensions,String(a.info.fbid),!!a.info.disablecontextmenu,!!a.info.logcontextmenu,a.info.caption,a.info.shouldshowshield)}function k(){var a=b("DOM").create("div",{className:"_4yca _5nxw"});b("ReactDOM").render(b("React").createElement(b("SphericalMediaGyroOverlay.react"),{isActive:!0}),a);return a}function d(a,c){var d=a.parentElement;a=new(b("PhotoSnowliftViewableImageWrapper"))(a);d&&d.appendChild(a.getElement());c&&(b("EventProfiler").tagCurrentActiveInteractionsAs("PSVSphericalImage"),a.getElement().appendChild(k()));return a}e.exports={fromSphericalPhotoData:a,fromStreamData:c,fromImageElement:d}}),null);
__d("PhotoViewer",["Bootloader","CSS","DOM"],(function(a,b,c,d,e,f){__p&&__p();function a(){"use strict";this.image=null,this.root=null,this.stream=null}a.prototype.getEventString=function(a){"use strict";var b=this.getEventPrefix();return b?b+"."+a:null};a.prototype.getImage=function(){"use strict";return this.image};a.prototype.getPosition=function(){"use strict";return this.stream?this.stream.getCursor():null};a.prototype.getRoot=function(){"use strict";return this.root};a.prototype.hiliteAllBoxes=function(){"use strict";b("DOM").scry(this.stageWrapper,"div.tagsWrapper div.faceBox").forEach(function(a){b("CSS").addClass(a,"otherActive")}),b("DOM").scry(this.stageWrapper,"div.tagsWrapper div.fbPhotosPhotoTagboxBaseComments").forEach(function(a){b("CSS").addClass(a,"otherActive")})};a.prototype.getEventPrefix=function(){"use strict";return null};a.prototype.getSourceString=function(){"use strict";return null};a.prototype.getVersionConst=function(){"use strict";return null};a.prototype.getViewerSource=function(){"use strict";return null};a.prototype.getViewerSet=function(){"use strict";return null};a.bootstrap=function(a,c){"use strict";b("Bootloader").loadModules(["PhotoSnowlift"],function(b){b.bootstrap(a,c)},"PhotoViewer")};e.exports=a}),null);
__d("ReactComponentRenderer",["React","ReactDOM","warning"],(function(a,b,c,d,e,f){"use strict";__p&&__p();function a(a,b){this.klass=a,this.container=b,this.props={},this.component=null}a.prototype.replaceProps=function(a,b){this.props={},this.setProps(a,b)};a.prototype.setProps=function(a,c){if(this.klass==null)return;Object.assign(this.props,a);a=b("React").createElement(this.klass,this.props);var d=this;b("ReactDOM").render(a,this.container,function(){d.component=this,c&&c.call(this)})};a.prototype.unmount=function(){b("ReactDOM").unmountComponentAtNode(this.container),this.klass=null};e.exports=a}),null);
__d("SnowliftVideoPivotsCarouselController",[],(function(a,b,c,d,e,f){a={setPivotsCarousel:function(a,b){this._pivotsCarousel=a,this.adjustCarousel(b)},adjustCarousel:function(a){this._pivotsCarousel&&this._pivotsCarousel.pageTo(a)},adjustCarouselOnAutoPlay:function(){this._pivotsCarousel&&this._pivotsCarousel.page()}};e.exports=a}),null);
__d("PhotoSnowlift",["csx","cx","fbt","invariant","Arbiter","AsyncRequest","Bootloader","CSS","CurrentUser","DataAttributeUtils","DataStore","Dialog","DisableContextMenuMixin","DOM","DOMControl","DOMQuery","EncryptedImg","Event","FullScreen","FunnelLogger","ImageUtils","Input","JSReliabilityFixesGatingConfig","Keys","Layer","LikeConfirmer","LinkController","LitestandShareAttachment","LitestandStoryInsertionStatus","Locale","ObjectionableContentFilterMixin","PageTransitions","Parent","PhotoLogger","PhotoPermalinkURI","PhotosConst","PhotoSessionLog","PhotosetPivotSlide.react","PhotosetSearchPivot.react","PhotosetSearchPivotData","PhotoSnowliftActionsGating","PhotoSnowliftAds","PhotoSnowliftBackLink.react","PhotoSnowliftLoader","PhotoSnowliftLoggingConfig","PhotoSnowliftViewableUtils","PhotoStreamCache","PhotosUtils","PhotoTagSearchPivotLogger","PhotoViewer","React","ReactComponentRenderer","ReactDOM","Rect","ScriptPath","ScrollableArea","SnowliftDestroyVideoPlayerExperiment","SnowliftUFIContextualParentExperiment","SnowliftVideoPivotsCarouselController","Style","SubscriptionsHandler","TimeSlice","Toggler","Tooltip","TrackingNodes","TrackingNodeTypes","UFIFeedbackTargets","UFIRootRegistry","UFIUIEvents","UIPagelet","URI","UserAgent_DEPRECATED","Vector","VideoData","VideoPermalinkURI","VideoPlayerAbortLoadingExperiment","VideoPlayerReason","$","classWithMixins","computeRelativeURI","emptyFunction","ge","getActiveElement","goURI","isNode","mixin","setImmediate","setTimeoutAcrossTransitions"],(function(a,b,c,d,e,f,g,h,i,j){"use strict";__p&&__p();var k,l=b("JSReliabilityFixesGatingConfig").should_get_fix,m="WWW_SNOWLIFT_ACTIONS_FUNNEL",n=74,o=75,p=70,q=76,r=315,s=200,t=2e3,u=new RegExp("\\/posts\\/(\\d+)\\/?$");a=babelHelpers.inherits(v,b("classWithMixins")(b("PhotoViewer"),b("mixin")(b("ObjectionableContentFilterMixin"),b("DisableContextMenuMixin"))));k=a&&a.prototype;function v(){k.constructor.call(this),this.switchTimer=null,this.imageRefreshTimer=null,this.imageLoadingTimer=null,this.lastPage=0,this.currentMinSize=null,this.currentImageSize=null,this.resetUriStack=!0,this.thumbSpherical=!1,this.thumbSrc=null,this.shouldStretch=!1,this.sphericalPhotoData=null,this.stageMax=v.STAGE_NORMAL_MAX,this.stageChrome=v.STAGE_CHROME,this.stagePagerPrev=null,this.ua=null,this.PhotoTagger=null,this._inputBarAdjusted=!1,this._seenTags={},this._navCount=0,this._navHistory=[],this._preloadTimeout=0,this.clearAlbumBoundaries()}v.prototype.preload=function(a,c){b("Bootloader").loadModules(["PhotoTagger","Live","PhotoTagApproval","PhotoTags","TagTokenizer","css:fb-photos-snowlift-fullscreen-css"],function(a){this.PhotoTagger=a}.bind(this),"PhotoSnowlift")};v.prototype.bootstrap=function(a,c){__p&&__p();this.preload(a,c);this._href=a;this._elem=c;if(this.closeDirty){setTimeout(this.bootstrap.bind(this,a,c),0);return}b("PhotoSnowliftAds").reset();this.resetUriStack=!0;if(this.isOpen)if(this.openExplicitly)this.closeCleanup(),this.resetUriStack=!1;else return;this._dataFt=null;var d=null;c&&(d=b("Parent").bySelector(c,"._4oep"));if(d===null){var e=b("Parent").byAttribute(c,"data-cursor");if(e)try{var f=JSON.parse(b("DataAttributeUtils").getDataFt(e));this._dataFt=f}catch(a){}else try{e=b("Parent").byAttribute(c,"data-ad");e=b("DataAttributeUtils").getParentByAttributeOrDataStoreKey(c,"data-ad","data-ad");f=JSON.parse(b("DataAttributeUtils").getDataAttribute(e,"data-ad"));this._dataFt={ad_id:f.adid}}catch(a){}}this.returningToStart=!1;this.loading&&b("CSS").removeClass(this.loading,"loading");if(c){b("CSS").addClass(this.loading=c,"loading");void 0;b("SnowliftUFIContextualParentExperiment").useUfiContextualParent?e=d||b("Parent").byClass(c,"uiStreamStory")||b("Parent").bySelector(c,"._5jmm"):e=b("Parent").byClass(c,"uiStreamStory")||d||b("Parent").bySelector(c,"._5jmm");if(e)this.storyID=e.id;else{f=b("Parent").bySelector(c,"._5b9c");f&&(this.storyID=f.getAttribute("data-ownerid"))}this._updateContainerOwnerID();this.getThumbAndSize(c)}else this.loading=null;b("Arbiter").inform("PhotoSnowlift.GO",a,b("Arbiter").BEHAVIOR_STATE);this.loadFrameIfUninitialized()};v.prototype._updateContainerOwnerID=function(){this.container&&(this.storyID?this.container.setAttribute("data-ownerid",this.storyID):this.container.removeAttribute("data-ownerid"))};v.prototype.getEventPrefix=function(){return"PhotoSnowlift"};v.prototype.getRoot=function(){return this.root};v.prototype.getSourceString=function(){return"snowlift"};v.prototype.getViewerSource=function(){return this.source};v.prototype.getViewerSet=function(){return this.stream.getPhotoSet()};v.prototype.getVersionConst=function(){return b("PhotosConst").VIEWER_SNOWLIFT};v.prototype.getImage=function(){return this._viewable.getElement()};v.prototype.getImageId=function(){return this.stream.getCursor()};v.prototype.getRHCHeader=function(){return this.rhcHeader};v.prototype.getRHCBody=function(){return this.ufiForm};v.prototype.getRHCFooter=function(){return this.rhcFooter};v.prototype.getLoadQuery=function(){return this.loadQuery};v.prototype.getCurrentPhotoInfo=function(){var a=this.stream.getCurrentImageData();return a?a.info:null};v.prototype.getOwnerId=function(){var a=this.stream.getCurrentImageData();return a?a.info.owner:null};v.prototype.getThumbAndSize=function(a){__p&&__p();this.currentImageSize=null;this.thumbSpherical=!1;this.thumbSrc=null;var c=new(b("URI"))(a.getAttribute("ajaxify")).getQueryData();if(!c.size)return;c=b("Vector").deserialize(c.size);if(!c.x||!c.y)return;this.currentImageSize=c;if(a.getAttribute("data-cropped"))return;c=b("DOM").scry(a,"img")[0];var d=b("DOM").scry(a,"i")[0];a=b("Parent").byAttribute(a,"data-size");this.shouldStretch=a&&this.currentImageSize&&c&&a.getAttribute("data-size")==="2"&&this.currentImageSize.x>this.currentImageSize.y&&this.currentImageSize.x<=v.TIMELINE_STRETCH_WIDTH&&c.offsetWidth===v.TIMELINE_STRETCH_WIDTH;if(c)a=c.src,this.thumbSpherical=Boolean(c.getAttribute("data-is-spherical-photo")),this.sphericalPhotoData=b("DataStore").get(c,"sphericalPhotoData");else if(d)a=b("Style").get(d,"backgroundImage").replace(/.*url\(\"?([^\"]*)\"?\).*/,"$1");else return;this.thumbSrc=a};v.prototype.loadFrameIfUninitialized=function(){if(this.root)return;var a=String(b("URI").getMostRecentURI().getQueryData().viewas);b("PhotoSnowliftLoader").loadFrame(a)};v.prototype.init=function(a,c){this.init=b("emptyFunction"),this._shouldLog=c.photos_client_loading,this._logger=null,this._shouldLog&&(this._logger=new(b("PhotoLogger"))(b("PhotosConst").VIEWER_SNOWLIFT_STRING)),this._showHover=c.pivot_hover,this._showMorePhotos=c.show_more_photos,this._extraSlidePivot=c.extra_slide_pivot,this._uiRefresh=c.snowlift_ui_refresh,b("PhotoSessionLog").setEndMetrics(c.pivot_end_metric),this.startingMousePos=null,this.haveLeftBufferRegion=!1,this.showingTypeaheadSuggestions=!1,this.fullscreen=b("FullScreen").isSupportedWithKeyboardInput(),this.showOGVideos=c.og_videos,this.resizeCommentsForAds=c.resize_comments_for_ads,this.spotlight=a,this.spotlight.subscribe("blur",function(){this.closingAction=b("PhotoSessionLog").OUTSIDE}.bind(this)),this.spotlight.subscribe("hide",this.closeHandler.bind(this)),this.spotlight.subscribe("key",this.keyHandler.bind(this)),this._actionMenuOpen=!1,this._mouseOnPhotoStage=!1,this.initializeNodes(this.spotlight.getRoot()),this.disableContextMenu(),b("PhotoSnowliftAds").init(this.sideAdUnit,this,c,this.adsDisplayedCallback.bind(this)),this.inAdsDisplayedCallback=!1,this.lastAdsHeight=0,this.subscription||(b("LinkController").registerHandler(this.handleNavigateAway.bind(this)),this.subscription=b("Arbiter").subscribe("PhotoSnowlift.GO",function(a,c){this.openExplicitly=!0,this.loading&&b("CSS").removeClass(this.loading,"loading"),this.open(c)}.bind(this))),this.transitionHandlerRegistered=!1,this.returningToStart=!1,b("PageTransitions").registerHandler(this.openHandler.bind(this)),this.openHandlerRegistered=!0,b("Arbiter").subscribe("PhotoTagApproval.HILITE_TAG",this.onHiliteTag.bind(this)),b("Arbiter").subscribe("PhotoTagApproval.UPDATE_TAG_BOX",this.onUpdateTagBox.bind(this)),this.fullscreen&&b("FullScreen").subscribe("changed",this.onFullScreenChange.bind(this)),this.buttonTruncateGk=c.snowlift_button_truncate,this.allowIrrelevantRequests=!!c.snowlift_allow_irrelevant_requests,this.snowflake&&(b("CSS").addClass(this.root,"snowflake"),this.extraClasses.forEach(function(a){b("CSS").addClass(this.root,a)},this))};v.prototype.onFullScreenChange=function(){if(!this.isOpen)return;var a=b("FullScreen").isFullScreen();b("CSS").conditionClass(document.body,"fbPhotoSnowliftFullScreenMode",a);a?(this.lastFullscreenEnter=Date.now(),b("CSS").hasClass(this.root,"fbPhotoSnowliftEditMode")||this.collapseRHC(),this._viewable.onEnterFullScreen(),this.adjustForResize()):(this.uncollapseRHC(),this._viewable.onExitFullScreen(),b("UserAgent_DEPRECATED").chrome()&&this.lastPage>this.lastFullscreenEnter&&!b("CSS").hasClass(this.root,"fbPhotoSnowliftEditMode")&&this.page(0,!1),b("Arbiter").inform("reflow"));b("Toggler").hide()};v.prototype.initializeNodes=function(a){this.root=a,this.container=b("DOM").find(a,"div.fbPhotoSnowliftContainer"),this._updateContainerOwnerID(),this.snowliftPopup=b("DOM").find(this.container,"div.fbPhotoSnowliftPopup"),this.rhc=b("DOM").find(this.snowliftPopup,"div.rhc"),this.rhcHeader=b("DOM").find(this.rhc,"div.rhcHeader"),this.rhcFooter=b("DOM").find(this.rhc,"div.rhcFooter"),this.taglist=b("DOM").find(this.rhc,"span.fbPhotoTagList"),this.ufiForm=b("DOM").find(this.rhc,"form.fbPhotosSnowliftFeedbackForm"),this.ufiInputContainer=b("DOM").find(this.rhc,"div.fbPhotosSnowboxFeedbackInput"),this.scroller=b("DOM").find(this.rhc,"div.rhcScroller"),this.scrollerBody=b("DOM").find(this.scroller,"div.uiScrollableAreaBody"),this.stageWrapper=b("DOM").find(this.snowliftPopup,"div.stageWrapper"),this.overlay=b("DOM").find(this.snowliftPopup,"div.snowliftOverlay"),this.errorBox=b("DOM").find(this.stageWrapper,"div.stageError"),this._viewable=b("PhotoSnowliftViewableUtils").fromImageElement(b("DOM").find(this.stageWrapper,"img.spotlight")),this.stage=b("DOM").find(this.stageWrapper,"div.stage"),this.videoStage=b("DOM").find(this.stageWrapper,"div.videoStage"),this.prevPager=b("DOM").find(this.snowliftPopup,"a.snowliftPager.prev"),this.nextPager=b("DOM").find(this.snowliftPopup,"a.snowliftPager.next"),this.stageActions=b("DOM").find(a,"div.stageActions"),this._uiRefresh||(this.buttonActions=b("DOM").find(this.stageActions,"div.fbPhotosPhotoButtons")),this.placeInfo=b("DOM").find(this.rhc,"div.fbPhotosSnowliftPlaceInfo"),this.seeMore=b("DOM").find(this.rhc,"._jke"),this.sideAdUnit=b("DOM").find(a,"._5ciw"),b("CSS").conditionClass(this.root,"fullScreenAvailable",this.fullscreen)};v.prototype.getContextMenuContainer=function(){return this.stageWrapper};v.prototype.getObjectionableWarningContainer=function(){return this.stageWrapper};v.prototype.getObjectionableWarningHiddenContent=function(){return this.isVideo()?this.videoStage:this.stage};v.prototype.isVideo=function(){var a=this.stream.getCurrentImageData();return a&&a.info.video?!0:!1};v.prototype.initializeScroller=function(){__p&&__p();this.initializeScroller=b("emptyFunction");b("CSS").addClass(this.scroller,"_467y");this.scrollableArea=b("ScrollableArea").fromNative(this.scroller,{fade:!0,persistent:!0});var a=function(event){__p&&__p();var a=b("Event").$E(event).getTarget();if(b("DOM").contains(this.ufiInputContainer,a)){var c=b("DOMControl").getInstance(a);if(c){this.scrollableArea.scrollToBottom();var d=c.subscribe("resize",function(){var a=this.scrollableArea.isScrolledToBottom();this.adjustScroller();a&&this.scrollableArea.scrollToBottom()}.bind(this)),e=b("Event").listen(a,"blur",function(){c.unsubscribe(d),e.remove()})}}(a.classList.contains("UFIPagerLink")||a.classList.contains("UFICommentLink"))&&(this.autoplayOptionScreenConfig&&this.autoplayOptionScreenConfig.enabled&&(this.haltAutoplay=!0))}.bind(this);b("Arbiter").subscribe(b("UFIUIEvents").InputHeightChanged,function(a,c){b("DOM").contains(this.ufiInputContainer,c.node)&&this.adjustScroller()}.bind(this));b("Arbiter").subscribe(b("UFIUIEvents").PhotoPreviewHeightChanged,function(a,c){(!c.node||b("DOM").contains(this.ufiInputContainer,c.node))&&this.adjustScroller()}.bind(this));b("Arbiter").subscribe(b("UFIUIEvents").Changed,function(a,b){this.ufiForm===b.form&&this.adjustScrollerIfNecessary()}.bind(this));b("Arbiter").subscribe(b("UFIUIEvents").Comment,function(a,b){this.ufiForm===b.form&&(this.adjustScrollerIfNecessary(),b.isinverted?this.scrollableArea.scrollToTop():this.scrollableArea.scrollToBottom())}.bind(this));b("Event").listen(this.rhc,"click",function(event){var a=event.getTarget();(b("Parent").byTag(a,"a")||b("Parent").byTag(a,"button")||b("DOM").isNodeOfType(a,"input"))&&this.adjustScrollerIfNecessary()}.bind(this));b("Arbiter").subscribe(["reflow",b("UFIUIEvents").CommentPager],function(){this.isOpen&&this.adjustScrollerIfNecessary()}.bind(this));b("Arbiter").subscribe(b("UFIUIEvents").TranslationRendered,function(){this.adjustScrollerIfNecessary()}.bind(this));b("Event").listen(this.ufiForm,"focusin",a)};v.prototype.openHandler=function(a){if(this.isOpen||!b("PhotoPermalinkURI").isValid(a)||this.returningToStart||a.getQueryData().closeTheater||a.getQueryData().permPage){this.openHandlerRegistered=!1;return!1}this.open(a);this._uriStack.push(new(b("URI"))(a).getQualifiedURI().toString());b("PageTransitions").transitionComplete(!0);return!0};v.prototype.addHaltAutoplaySubscription=function(){b("Arbiter").subscribe([b("UFIUIEvents").Focus],function(){this.haltAutoplay=!0}.bind(this)),b("Arbiter").subscribe([b("UFIUIEvents").Blur],function(a,b){this.haltAutoplay=b.hasEnteredText}.bind(this))};v.prototype.open=function(a){__p&&__p();var c=new(b("URI"))(a),d=c.getQueryData(),e=Object.create(null),f=b("PhotoPermalinkURI").parse(c);f!=null&&(d.fbid=f.photo_id,d.set=f.set_token,e.snowlift_content_id=f.photo_id);f=b("VideoPermalinkURI").parse(c);f!=null&&(d.v=f.video_id,d.set=f.set_token,e.snowlift_content_id=f.video_id);this._elem!=null&&(d.external_log_id=this._elem.getAttribute("data-external-log-id"),d.player_origin=this._elem.getAttribute("data-player-origin"));b("ScriptPath").openOverlayView("snowlift",e);if(!d.fbid&&!d.v&&!d.pid){f=u.exec(c.getPath());f&&(d.v=f[1])}this.resetUriStack&&(this._uriStack=[]);this.initialLoad||(d.firstLoad=!0,this.initialLoad=!0,b("LitestandStoryInsertionStatus").registerBlocker(function(){return this.isOpen}.bind(this)));this.sessionID=Date.now();this.loadQuery=Object.assign(d,{ssid:this.sessionID});this._dataFt&&(this.loadQuery.data_ft=this._dataFt);this.isOpen=!0;this.pagersShown=!1;this.refreshOnClose=!1;this.hilitedTag=null;this.loadingStates={image:!1,html:!1};this.replaceUrl=!1;this.movementDelta=0;this.pivotsCarouselElement=null;this.autoplayOptionScreenConfig=null;this.haltAutoplay=!1;this.shouldRenderVideoPivots=!1;b("CSS").show(this.nextPager);b("CSS").show(this.prevPager);this.source=null;this.saveTagSubscription=b("Arbiter").subscribe("PhotoTagger.SAVE_TAG",this.onTagSaved.bind(this));this.taggedPhotoIds=[];this.stream=new(b("PhotoStreamCache"))();this.stream.init(b("PhotosConst").VIEWER_SNOWLIFT,"PhotoViewerPagelet","pagelet_photo_viewer",this._shouldLog?this._logger:null,d.tagSuggestionMode||"everyone");b("URI").getMostRecentURI().getQueryData().viewas&&this.stream.setViewAs(b("URI").getMostRecentURI().getQueryData().viewas+"");b("URI").getMostRecentURI().getQueryData().ifg&&this.stream.setIsFromGroups(b("URI").getMostRecentURI().getQueryData().ifg);this.fetchInitialData();this.setLoadingState(v.STATE_HTML,!0);this.rhcCollapsed=!1;this._open(a);b("Bootloader").loadModules(["PhotosButtonTooltips"],function(a){a.init()},"PhotoSnowlift");this._navHistory.push(c.getQualifiedURI().toString())};v.prototype._open=function(a){__p&&__p();this.createLoader();this.spotlight.show();b("Arbiter").inform("layer_shown",{type:"PhotoSnowlift"});b("Arbiter").inform("PhotoSnowlift.OPEN");this.stageHandlers=[b("Event").listen(window,"resize",this.adjustForResize.bind(this)),b("Event").listen(this.stageWrapper,"click",function(event){__p&&__p();var a=b("DataAttributeUtils").getClickTrackingParent(event.getTarget());if(!a)return;try{a=JSON.parse(b("DataAttributeUtils").getDataFt(a));if(!a.tn)return;var c=b("TrackingNodes").parseTrackingNodeString(a.tn);a=Object.keys(b("TrackingNodeTypes")).filter(function(a){return b("TrackingNodeTypes")[a]===c});a.length&&b("FunnelLogger").appendAction(m,"click_"+a.join("_"))}catch(a){}}),b("Event").listen(this.stageWrapper,"click",this.buttonListener.bind(this)),b("Event").listen(this.stageWrapper,"mouseleave",function(event){var a=event.getTarget();if(b("Parent").bySelector(a,"._khz"))return;b("Parent").byClass(a,"snowliftOverlay")||b("Parent").byClass(a,"fbPhotoSnowliftTagApproval")||b("Parent").byClass(a,"tagPointer")||b("Parent").byClass(a,"arrow")||b("Parent").byClass(a,"faceboxSuggestion")||b("Parent").byClass(a,"typeaheadWrapper")||b("Parent").byClass(a,"photoTagTypeahead")||b("Parent").byClass(a,"fbPhotoTagger")||this.unhiliteAllTags();this._mouseOnPhotoStage=!1;this.hidePagers()}.bind(this)),b("Event").listen(this.stageWrapper,"mousemove",this.hilitePager.bind(this)),b("Event").listen(this.stageWrapper,"mousemove",this.hiliteTagsOnMouseMove.bind(this)),b("Event").listen(this.stageWrapper,"mouseenter",function(){return this._mouseOnPhotoStage=!0}.bind(this)),b("Event").listen(this.overlay,"mouseenter",this.unhiliteAllTags.bind(this)),b("Event").listen(this.container,"mousemove",this._enableMouseOver.bind(this)),b("Event").listen(this.container,"mouseover",this._interceptMouseOver.bind(this)),b("Event").listen(this.stageWrapper,"focusin",this.hilitePager.bind(this)),b("Event").listen(this.rhc,"focusin",this.hidePagers.bind(this))];this.stageHandlers.push(b("Event").listen(this.root,"click",function(event){__p&&__p();var a=event.getTarget();if(b("Parent").bySelector(a,"._418x")){if(b("FullScreen").isFullScreen()){b("FunnelLogger").appendActionWithTagIfNew(m,"fullscreen_exit","fbPhotoSnowlift/close");b("FullScreen").toggleFullScreen();return}this.closingAction=b("PhotoSessionLog").X;this.spotlight.hide()}else this._isLiveBroadcast&&b("Parent").bySelector(a,"._3ixn")&&this.spotlight.hide()}.bind(this)),b("Event").listen(this.container,"click",function(event){__p&&__p();var a=event.getTarget();if(b("Parent").byClass(a,"rotateRight"))b("FunnelLogger").appendActionWithTag(m,"rotate_image","right"),this.rotate("right");else if(b("Parent").byClass(a,"rotateLeft"))b("FunnelLogger").appendActionWithTag(m,"rotate_image","left"),this.rotate("left");else if(b("Parent").bySelector(a,"._32_l")){b("FunnelLogger").appendAction(m,"click-pivot-item");var c=b("Parent").bySelector(a,"._32_l");c=c.getAttribute("data-fbid");var d=this.stream.getCursor();d=this.stream.calculateDistance(d,c);c=this.stream.fbidList.indexOf(c);b("SnowliftVideoPivotsCarouselController").adjustCarousel(c);this.page(d,!1);this.haltAutoplay=!1;this.removeAutoplayOptionScreen()}else b("Parent").byClass(a,"fbPhotoSnowliftZoom")?this.openZoom(event):this.fullscreen&&(b("Parent").byClass(a,"fbPhotoSnowliftFullScreen")?(b("FunnelLogger").appendActionWithTagIfNew(m,b("FullScreen").isFullScreen()?"fullscreen_exit":"fullscreen_enter","fbPhotoSnowliftFullScreen"),this.toggleFullScreen()):b("Parent").byClass(a,"fbPhotoSnowliftCollapse")?(this.toggleCollapse(),b("FunnelLogger").appendAction(m,"toggle_collapse-rhc")):b("FullScreen").isFullScreen()&&b("Parent").bySelector(a,".overlayBarButtons .comment_link")&&(this.toggleCollapse(),b("FunnelLogger").appendAction(m,"toggle_collapse-rhc")));c=b("Parent").byAttribute(a,"data-action-type");if(c){d=c.getAttribute("data-action-type");c=c.getAttribute("data-action-tag");b("FunnelLogger").appendActionWithTag(m,d,c)}else if(b("Parent").byClass(a,"addLocation")){d=b("Parent").byClass(a,"addLocation");b("FunnelLogger").appendActionWithTag(m,"add_location",b("CSS").hasClass(d,"photosTruncatingUIButton")?null:"from-action-bar")}else if(b("Parent").byClass(a,"fbPhotosPhotoActionsTag")){c=b("Parent").byClass(a,"fbPhotosPhotoActionsTag");b("CSS").hasClass(c,"tagButton")?b("FunnelLogger").appendActionWithTag(m,"tag_photo","start-tagging"):b("CSS").hasClass(c,"doneTaggingLink")?b("FunnelLogger").appendActionWithTag(m,"tag_photo","end-tagging"):b("CSS").hasClass(c,"taggingOff")?b("FunnelLogger").appendActionWithTag(m,"tag_photo","tagging-off"):b("CSS").hasClass(c,"taggingOn")&&b("FunnelLogger").appendActionWithTag(m,"tag_photo","tagging-on")}else b("Parent").byClass(a,"UFILikeLink")&&b("FunnelLogger").appendAction(m,"like-photo")}.bind(this)));a=b("ge")("fbPhotoSnowliftFeedback");a&&this.stageHandlers.push(b("Event").listen(a,"click",function(event){var a=event.getTarget();(b("Parent").byClass(a,"like_link")||b("Parent").byClass(a,"UFILikeLink")&&b("Parent").byClass(a,"UIActionLinks"))&&this.toggleLikeButton();a=b("Parent").byClass(event.getTarget(),"uiUfiCollapsedComment");a&&(b("FunnelLogger").appendActionWithTag(m,"like-photo","snowlift-feedback"),b("CSS").addClass(a,"uiUfiCollapsedCommentToggle"))}.bind(this)));a=b("ge")("fbPhotoSnowliftOnProfile");a&&this.stageHandlers.push(b("Event").listen(a,"click",function(event){b("Parent").byClass(event.getTarget(),"fbPhotoRemoveFromProfileLink")&&(this.refreshOnClose=!0)}.bind(this)));this.resetUriStack&&(this.startingURI=b("URI").getMostRecentURI().addQueryData({closeTheater:1}).getUnqualifiedURI());this.setLoadingState(v.STATE_IMAGE_DATA,!0);this.transitionHandlerRegistered||(b("PageTransitions").registerHandler(this.transitionHandler.bind(this)),this.transitionHandlerRegistered=!0);b("PhotoSessionLog").initLogging(b("PhotoSessionLog").SNOWLIFT);this._dataFt&&b("PhotoSessionLog").setTopLevelPostId(this._dataFt.top_level_post_id);this.pivots&&b("PhotoSessionLog").setRelevantCount(this.pivots.relevantCount)};v.prototype.toggleFullScreen=function(){var a=b("FullScreen").toggleFullScreen(document.documentElement);a?(this._viewable.onToggleIntoFullScreen(),b("PhotoSessionLog").logEnterFullScreen(this.stream.getCursor())):this._viewable.onToggleOutOfFullScreen()};v.prototype._getIsZoomAllowed=function(a){return!!(a&&!a.video&&!a.spherical&&a.dimensions&&(a.dimensions.x>window.innerWidth||a.dimensions.y>window.innerHeight))};v.prototype.showZoom=function(a){b("CSS").conditionClass(this.root,"zoomAvailable",this._getIsZoomAllowed(a))};v.prototype.openZoom=function(event){__p&&__p();var a=this.stream.getCurrentImageData();this._viewable.onToggleIntoFullScreen();var c=b("DOM").find(this.stageWrapper,"._2-sx"),d=c.getBoundingClientRect();c.style.width="auto";c.style.height="auto";c.classList.add("zoom");var e=void 0,f=void 0;if(a){a=a.dimensions;e=Math.max(0,a.x-window.innerWidth);f=Math.max(0,a.y-window.innerHeight)}else{a=c.getBoundingClientRect();e=Math.max(0,a.width-window.innerWidth);f=Math.max(0,a.height-window.innerHeight)}a=!1;e&&(a=!0,e+=s*2,c.classList.add("overflowX"));f&&(a=!0,f+=s*2,c.classList.add("overflowY"));var g=void 0;if(a){a=-event.clientX/window.innerWidth*e+"px";var h=-event.clientY/window.innerHeight*f+"px";c.style.transform="translate3d("+a+","+h+",0)";g=b("Event").listen(c,"mousemove",function(event){var b=-event.clientX/window.innerWidth*e+"px",a=-event.clientY/window.innerHeight*f+"px";c.style.transform="translate3d("+b+","+a+",0)"})}var i=null,j=null;a=function(){c.style.width=d.width+"px";c.style.height=d.height+"px";c.style.transform="";c.classList.remove("zoom","overflowX","overflowY");g&&g.remove();i.remove();k.unsubscribe(j);k.destroy();return!1};var k=new(b("Layer"))({},document.createElement("div"));j=k.subscribe("key",a);k.show();i=b("Event").listen(c,"click",a);this._viewable.onEnterFullScreen()};v.prototype.getStream=function(){return this.stream};v.prototype.fetchInitialData=function(){this.stream.waitForInitData();var a=this.loadQuery.within_business?this.loadQuery.business_thread_id:this.loadQuery.fbid;a=b("UFIFeedbackTargets").getFeedbackTargetIfExists(a)||{};b("UIPagelet").loadFromEndpoint("PhotoViewerInitPagelet",b("ge")("pagelet_photo_viewer_init",this.root),this.loadQuery,{actorID:a.actorforpost||null,usePipe:!0,jsNonblock:!0,crossPage:!0,allowIrrelevantRequests:this.allowIrrelevantRequests});this.adjustScroller();this.disableAds=!b("CurrentUser").isLoggedIn()||this.loadQuery.eid||this.loadQuery.within_business||this.loadQuery.viewas;this.loadAds()};v.prototype.toggleCollapse=function(){this.rhcCollapsed?this.uncollapseRHC():this.collapseRHC()};v.prototype.collapseRHC=function(){this.rhcCollapsed=!0,b("CSS").addClass(this.root,"collapseRHC"),this.adjustForResize()};v.prototype.uncollapseRHC=function(){this.rhcCollapsed=!1,b("CSS").removeClass(this.root,"collapseRHC"),this.adjustForResize()};v.prototype.closeHandler=function(){if(!this.isOpen)return;this.closingAction=this.closingAction||b("PhotoSessionLog").ESC;if(b("URI").getMostRecentURI().addQueryData({closeTheater:1}).getUnqualifiedURI().toString()==this.startingURI.toString()){this.close();return}this.returnToStartingURI(this.refreshOnClose);this.close()};v.prototype.returnToStartingURI=function(a,c){__p&&__p();a||(c?this.squashNextTransition(b("goURI").bind(null,c)):this.squashNextTransition());this.returningToStart=!0;var d=b("Arbiter").subscribe("page_transition",function(){this.returningToStart=!1,d.unsubscribe()}.bind(this));c=a||isNaN(b("UserAgent_DEPRECATED").opera());a=this._uriStack.length;if(c&&a<window.history.length)window.history.go(-a);else{c=this.startingURI;a=new(b("URI"))(c).removeQueryData("closeTheater");c.getQueryData().sk=="approve"&&c.getPath()=="/profile.php"&&(a.removeQueryData("highlight"),a.removeQueryData("notif_t"));b("goURI")(a)}};v.prototype.squashNextTransition=function(a){this.squashNext=!0,b("PageTransitions").registerHandler(function(){if(this.squashNext){this.squashNext=!1;a&&setTimeout(a,0);b("PageTransitions").transitionComplete(!0);return!0}return!1}.bind(this),7)};v.prototype.handleNavigateAway=function(a){__p&&__p();var c=b("computeRelativeURI")(b("PageTransitions").getMostRecentURI().getQualifiedURI(),a.getAttribute("href"));if(this.backButton&&b("ReactDOM").findDOMNode(this.backButton)===a){this._navHistory.pop();this.resetUriStack=!1;this.open(c.toString());this._navHistory.pop();this.currentAuthorName=null;return!1}if(b("Parent").bySelector(a,"._56lp a")){this.resetUriStack=!1;this.open(c.toString());return!1}if(this.isOpen&&c instanceof b("URI")&&c.getUnqualifiedURI().toString()!=this.startingURI.toString()&&c.getPath()!="/photo.php"){this.closingAction||(this.closingAction=b("PhotoSessionLog").NAVIGATE);this.returnToStartingURI(!1,c);this.close();return!1}(c instanceof b("URI")||!l)&&c.getPath()=="/photo.php"&&b("URI").getMostRecentURI().getPath()!=="/photo.php"&&this.close();return!0};v.prototype.postProcessTaggedPhotos=function(){if(this.taggedPhotoIds&&this.taggedPhotoIds.length>0){var a=null;this.source===v.COLLECTIONS_UNTAGGED_PHOTOS?a="/ajax/photos/photo/edit/skiptag/":(this.source===v.PHOTOS_OF_YOU_SUGGESTIONS||this.source===v.FRIENDS_IN_PHOTOS_SUGGESTIONS)&&(a="/ajax/photos/photo/add_to_star_grid/");a&&new(b("AsyncRequest"))().setURI(a).setAllowCrossPageTransition(!0).setData({media_id:this.taggedPhotoIds,source:this.source}).send()}};v.prototype.onTagSaved=function(a,b){if(this.taggedPhotoIds){if(this.source===v.PHOTOS_OF_YOU_SUGGESTIONS&&!b.self_tag)return;this.taggedPhotoIds.push(b.photo_fbid)}};v.prototype.clearAlbumBoundaries=function(){this._albumBoundaries={start:0,end:0,dir:0}};v.prototype.close=function(){__p&&__p();if(!this.isOpen)return;b("FunnelLogger").appendActionWithTag(m,"close_snowlift",b("PhotoSessionLog").closingTypeToString(this.closingAction));b("FunnelLogger").endFunnel(m);this._albumFBID=null;this.hideMorePhotos();this.hidePivotSlide();this._pauseVideoIfNeeded();this._destroyVideoIfNeeded();this.isOpen=!1;this._navCount=0;this.clearAlbumBoundaries();this.fullscreen&&b("FullScreen").disableFullScreen();b("CSS").removeClass(document.body,"fbPhotoSnowliftFullScreenMode");this.spotlight.hide();this.openExplicitly=!1;this.postProcessTaggedPhotos();b("Arbiter").unsubscribe(this.saveTagSubscription);this.taggedPhotoIds=[];this.closeDirty=!0;b("setTimeoutAcrossTransitions")(this.closeCleanup.bind(this),0);this.snowflake&&(b("CSS").removeClass(this.root,"snowflake"),this.extraClasses.forEach(function(a){b("CSS").removeClass(this.root,a)},this));b("UFIRootRegistry").cleanupSnowliftNodes();this.extraClasses=[];this.snowflake=!1;this.firstInSet=null;this.movementDelta=0};v.prototype.closeCleanup=function(){__p&&__p();b("ScriptPath").closeOverlayView("snowlift");this.closeDirty=!1;b("CSS").removeClass(this.root,"dataLoading");b("PhotoSessionLog").logPhotoViews(this.closingAction);this.destroy();b("CSS").hide(this.errorBox);this._viewable.hide();this.thumbSpherical=!1;this.thumbSrc=null;this.shouldStretch=!1;this.resetUriStack=!0;var a=this.stream.getCursor();if(b("VideoPlayerAbortLoadingExperiment").canAbort){var c;for(c=0;c<this.stream.getLength();c++){var d=this.stream.getImageData(this.stream.getCursorAt(c));d&&d.video&&d.controller&&d.controller.abortLoading()}}b("CSS").removeClass(this.stageWrapper,"showVideo");this._emptyVideoStage();this.PhotoSnowliftVideoNode&&this.PhotoSnowliftVideoNode.destroyVideoNode();this.uncollapseRHC();this.currentImageSize=null;this.currentMinSize=null;this.setStagePagersState("reset");this.recacheData();b("DOM").empty(this.sideAdUnit);this.stream.destroy();this.root.setAttribute("aria-busy","true");this._navHistory=[];d=this.closingAction===b("PhotoSessionLog").NAVIGATE;this.closingAction=null;this.openHandlerRegistered||(b("PageTransitions").registerHandler(this.openHandler.bind(this)),this.openHandlerRegistered=!0);b("Arbiter").inform("layer_hidden",{type:"PhotoSnowlift"});b("Arbiter").inform("PhotoSnowlift.CLOSE",{is_navigating:d,fbid:a})};v.prototype.createLoader=function(a){__p&&__p();if(this.currentImageSize===null)this.adjustStageSize(v.STAGE_MIN);else{var c=this.getStageSize(this.currentImageSize);c=new(b("Vector"))(Math.max(c.x,this.getMinimumStageWidth()),Math.max(c.y,v.STAGE_MIN.y));c=this.getImageSizeInStage(this.currentImageSize,c);this._elem&&this._elem.getAttribute("data-ploi")&&(this.thumbSrc=b("PhotoSnowliftLoader").getImageURL(this._elem));if(this.thumbSrc===null)this.adjustStageSize(c);else{var d=b("TimeSlice").getGuardedContinuation("Snowlift thumb image load");d=b("DOM").create("img",{className:"spotlight",alt:"",src:this.thumbSrc,style:{width:c.x+"px",height:c.y+"px"},onload:d.bind(undefined,b("emptyFunction"))});var e;void 0;this.thumbSpherical&&this.sphericalPhotoData?e=b("PhotoSnowliftViewableUtils").fromSphericalPhotoData(this.sphericalPhotoData,this):e=b("PhotoSnowliftViewableUtils").fromImageElement(d,this.thumbSpherical);this._useViewable(e,c,!1)}}this.setLoadingState(this.STATE_IMAGE_PIXELS,!0);a&&setTimeout(function(){__p&&__p();var c=function(){var b=arguments.length<=0||arguments[0]===undefined?null:arguments[0];if(!this.isOpen)return;(!this.stream||!this.stream.errorInCurrent())&&(this._switchViewable(b?b:a,this.currentImageSize),this.setLoadingState(v.STATE_IMAGE_DATA,!1))}.bind(this),d=b("TimeSlice").getGuardedContinuation("PhotoSnowlift image load");c=d.bind(null,c);if(b("EncryptedImg").isEncrypted(a))b("EncryptedImg").load(a,c);else{var e=new Image(),f=b("Event").listen(e,"load",c);c=function(){f&&(b("TimeSlice").cancel(d),f.remove(),f=null)};b("Arbiter").subscribeOnce("PhotoSnowlift.SWITCH_IMAGE",c);b("Arbiter").subscribeOnce("PhotoSnowlift.CLOSE",c);e.src=a}this._log(a)}.bind(this),0);b("CSS").hide(this.stageActions);this.setStagePagersState("disabled")};v.prototype.initialDataFetched=function(a){__p&&__p();b("PhotoSessionLog").setPhotoSet(this.stream.getPhotoSet());b("PhotoSessionLog").setLogFbids(a.logids);a.eid&&b("PhotoSessionLog").setEid(a.eid);this._albumBoundaries.start=this.stream.getCursor();a=this.stream.getCurrentImageData();if(a){var c=this.getImageURL(a);c=!b("PhotoSnowliftLoggingConfig").checkForImage||c;c&&(b("PhotoSessionLog").addPhotoView(a.info,this.shouldShowHiRes(a),this.fullscreen&&b("FullScreen").isFullScreen()),b("PhotoSnowliftLoggingConfig").logOnlyOnInit&&b("PhotoSessionLog").logInitialLoad())}c=this.stream.getCurrentExtraData();this._showHover&&c&&b("PhotoTagSearchPivotLogger").logImageImpression("snowlift",String(this.stream.getCursor()),Object.keys(c.tagRects));c&&c.source!==undefined&&(this.source=parseInt(c.source,10),b("PhotoSessionLog").setSource(this.source));this.pageHandlers||(this.pageHandlers=[b("Event").listen(this.root,"click",this.pageListener.bind(this)),b("Event").listen(this.root,"mouseleave",this.mouseLeaveListener.bind(this))]);this.showZoom(a);b("CSS").show(this.stageActions);this.root.setAttribute("aria-busy","false");a.info.ocmarkup?this.showObjectionableWarning(a.info.ocmarkup):this.hideObjectionableWarning();a.info.disablecontextmenu?this.disableContextMenu():this.enableContextMenu()};v.prototype.adjustScrollerIfNecessary=function(){clearTimeout(this.scrollerTimeout),this.scrollerTimeout=setTimeout(this.adjustScroller.bind(this),0)};v.prototype.adjustScroller=function(a){__p&&__p();clearTimeout(this.scrollerTimeout);this.initializeScroller();this.scrollableArea.resize();var c=b("Vector").getElementDimensions(this.rhc),d=c.y;d-=b("Vector").getElementDimensions(this.rhcHeader).y;d-=b("Vector").getElementDimensions(this.ufiInputContainer).y;this.seeMore&&(d-=b("Vector").getElementDimensions(this.seeMore).y);if(this.placeInfo){var e=b("Vector").getElementDimensions(this.placeInfo);d-=e.y;b("Style").set(this.sideAdUnit,"bottom",e.y+"px")}a==null&&(a=this.resizeCommentsForAds?this.lastAdsHeight:0);this.lastAdsHeight=a;d=Math.max(0,d);e=b("Vector").getElementDimensions(this.scrollerBody).y;a=Math.max(v.MIN_UFI_HEIGHT,d-a);e>=a?(d>a?(b("CSS").removeClass(this.rhc,"pinnedUfi"),d-=a):(b("CSS").addClass(this.rhc,"pinnedUfi"),d=0),b("Style").set(this.scroller,"height",a+"px")):(b("Style").set(this.scroller,"height","auto"),b("CSS").removeClass(this.rhc,"pinnedUfi"),d-=e);b("PhotoSnowliftAds").resize(new(b("Vector"))(c.x,d));this.scrollableArea.adjustGripper()};v.prototype.adjustForResize=function(){this.currentMinSize=null,this.adjustStageSize(),this.adjustForNewData()};v.prototype.shouldShowHiRes=function(a){if(!a||!a.smallurl)return!1;var b=this.getStageSize(a.dimensions);b=this._adjustStageSizeForPixelRatio(b);a=this.getImageSizeInStage(a.dimensions,b);return a.x>v.STAGE_NORMAL_MAX.x||a.y>v.STAGE_NORMAL_MAX.y};v.prototype._adjustStageSizeForPixelRatio=function(a){window.devicePixelRatio&&window.devicePixelRatio>1&&(a=new(b("Vector"))(a.x*window.devicePixelRatio,a.y*window.devicePixelRatio));return a};v.prototype.getImageURL=function(a){if(a.video)return null;else if(a.smallurl&&!this.shouldShowHiRes(a))return a.smallurl;return a.url};v.prototype.getImageOrVideoDimensions=function(a){if(a.video){a=this.getVideoElement(a.video);if(a)return this.getVideoSize(a)}return this._viewable.getNaturalDimensions()};v.prototype.getStageSize=function(a,c){__p&&__p();var d=b("Vector").getViewportDimensions();this._isLiveBroadcast&&(d.y-=200);var e=new(b("Vector"))(a.x,a.y);c&&(e=new(b("Vector"))(Math.max(a.x,c.x),Math.max(a.y,c.y)));if(this.fullscreen&&b("FullScreen").isFullScreen()){a=screen.height-v.FULL_SCREEN_PADDING*2;return new(b("Vector"))(this.rhcCollapsed?screen.width:screen.width-v.SIDEBAR_SIZE_MAX,a)}else{c=Math.min(e.x,d.x-v.SIDEBAR_SIZE_MAX-v.STAGE_CHROME.x);d=d.y-v.STAGE_CHROME.y;a=Math.min(e.y,d)}if(c===0&&a===0)return new(b("Vector"))(0,0);d=c/a;e=e.x/e.y;return d<e?new(b("Vector"))(c,Math.round(c/e)):new(b("Vector"))(Math.round(a*e),a)};v.prototype.getExtraVerticalSpace=function(){return this.getVideoOnStage()?v.VIDEO_BOTTOM_BAR_SPACE*2:0};v.prototype.getComponentsHeight=function(){var a=this.getVideoOnStage();if(a){a=b("ge")(a);if(a)return this.getVideoComponentsHeight(a)}return 0};v.prototype.getMinimumStageWidth=function(){var a=v.STAGE_MIN.x;if(this.getVideoOnStage())return a;b("PhotoSnowliftActionsGating").ALLOW_MAKE_PROFILE_PICTURE_BUTTON&&(a+=v.PROFILE_PICTURE_BUTTON_WIDTH);return a};v.prototype.getImageSizeInStage=function(a,c){__p&&__p();var d=a.x;a=a.y;var e=this.getComponentsHeight(),f=this.getExtraVerticalSpace();a-=e;c=new(b("Vector"))(c.x,c.y-e-f);if(d>=c.x||a>=c.y){f=c.x/c.y;var g=d/a;f<g?(d=c.x,a=Math.round(d/g)):f>g?(a=c.y,d=Math.round(a*g)):(d=c.x,a=c.y)}return new(b("Vector"))(d,a+e)};v.prototype.adjustStageSize=function(a){__p&&__p();var c=this.currentImageSize;if(a)c=a;else{a=this.stream&&this.stream.getCurrentImageData();a&&(c=this.getImageOrVideoDimensions(a))}if(!c)return;this.currentImageSize=c;a=this.getExtraVerticalSpace();this.shouldStretch&&!this.getVideoOnStage()&&c.x>c.y&&c.x<=v.TIMELINE_STRETCH_WIDTH&&c.x>=v.TIMELINE_STRETCH_MIN&&(c.y=Math.round(c.y*v.TIMELINE_STRETCH_WIDTH/c.x),c.x=v.TIMELINE_STRETCH_WIDTH);var d=this.getStageSize(c,this.currentMinSize);this.currentMinSize||(this.currentMinSize=new(b("Vector"))(0,0));this.currentMinSize=new(b("Vector"))(Math.max(d.x,this.getMinimumStageWidth(),this.currentMinSize.x),Math.max(d.y,v.STAGE_MIN.y,this.currentMinSize.y));d=this.getImageSizeInStage(c,this.currentMinSize);c=this.currentMinSize.x-d.x;var e=this.currentMinSize.y-d.y;c>0&&c<v.PADDING_MIN?this.currentMinSize.x-=c:e>0&&e<v.PADDING_MIN&&(this.currentMinSize.y-=e);e=this.currentMinSize.x+v.SIDEBAR_SIZE_MAX;this.rhcCollapsed&&(e=this.currentMinSize.x);var f=this.getVideoOnStage()&&this.pivotsCarouselElement,g=0,h=this.currentMinSize.y;if(f){var i=this.pivotsCarouselElement.clientHeight;g=Math.ceil(i/100)*100;h+=g}this.snowliftPopup.style.cssText="width:"+e+"px;height:"+h+"px;";i=this.currentMinSize.y-a;e=i+g;if(b("UserAgent_DEPRECATED").firefox()){var j=b("Style").get(this.stageWrapper,"font-size");i=i/parseFloat(j)+"em";e=e/parseFloat(j)+"em"}else i+="px",e+="px";this.stageWrapper.style.cssText="width:"+this.currentMinSize.x+"px;line-height:"+i+";";if(this.getVideoOnStage()){this.videoStage.style.cssText="width:"+this.currentMinSize.x+"px;height:"+e+";";if(!this._inputBarAdjusted&&this._isLiveBroadcast){h=parseInt(b("Style").get(this._liveInputBar,"right"),10);b("Style").set(this._liveInputBar,"right",h+c/2+"px");this._inputBarAdjusted=!0}}d.y-=this.getComponentsHeight();this.setMediaElementSize(d);f&&this.setPivotCarouselElementWidth(j);a=this.getTagger();a&&a.repositionTagger();this.adjustScrollerIfNecessary()};v.prototype.setMediaElementSize=function(a){__p&&__p();var c=this.image;if(this.getVideoOnStage())if(this._videoPlayerStateManager&&this._videoPlayerStateManager.setDimensions){this._videoPlayerStateManager.setDimensions(a.x,a.y);return}else c=b("DOM").scry(this.videoStage,"._53j5")[0]||c;else{this._viewable.setDimensions(a);return}if(!c)return;c.style.cssText="width:"+a.x+"px;height:"+a.y+"px;"};v.prototype.setPivotCarouselElementWidth=function(a){var c=this.videoStage.clientWidth;b("UserAgent_DEPRECATED").firefox()?c=c/parseFloat(a)+"em":c+="px";this.pivotsCarouselElement.style.width=c};v.prototype.adjustForNewData=function(){var a=this._viewable.getDimensions(),c=b("DOM").scry(this.stage,"div.tagsWrapper")[0];c&&(b("Style").set(c,"width",a.x+"px"),b("Style").set(c,"height",a.y+"px"))};v.prototype.adsDisplayedCallback=function(a,b){a=this.resizeCommentsForAds&&!this.inAdsDisplayedCallback&&!this.disableAds&&a<v.MIN_ADS_VISIBLE&&b.length>=v.MIN_ADS_VISIBLE;if(a){this.inAdsDisplayedCallback=!0;a=b[v.MIN_ADS_VISIBLE-1];this.adjustScroller(a);this.inAdsDisplayedCallback=!1}};v.prototype.setLoadingState=function(a,c){__p&&__p();switch(a){case v.STATE_IMAGE_PIXELS:b("CSS").conditionClass(this.root,"imagePixelsLoading",c);break;case v.STATE_IMAGE_DATA:this.loadingStates[a]=c;b("CSS").conditionClass(this.root,"imageLoading",c);break;case v.STATE_HTML:this.loadingStates[a]=c;b("CSS").conditionClass(this.root,"dataLoading",c);this.rhc.setAttribute("aria-busy",c?"true":"false");break}};v.prototype.destroy=function(){this.stageHandlers.forEach(function(a){a.remove()}),this.pageHandlers&&(this.pageHandlers.forEach(function(a){a.remove()}),this.pageHandlers=null),this._actionsMenuSubscriptionsHandler&&(this._actionsMenuSubscriptionsHandler.release(),this._actionsMenuSubscriptionsHandler=null),this._videoPlayerStateManager=null};v.prototype.checkState=function(a){__p&&__p();var c=arguments.length<=1||arguments[1]===undefined?!1:arguments[1];if(a!=v.STATE_ERROR&&!this.loadingStates[a])return;switch(a){case v.STATE_IMAGE_DATA:var d=this.stream.getCurrentImageData();if(d){var e=this.getImageURL(d);e?this._switchViewable(e,null,!0,c):d.video&&(d.shouldDelayStartupVideo?b("setImmediate")(function(){return this.switchVideo(d.video,!0)}.bind(this)):this.switchVideo(d.video,!0));this.setLoadingState(a,!1)}break;case v.STATE_HTML:this.stream.getCurrentHtml()&&(this.swapData(),this.setLoadingState(a,!1));break;default:this.stream.errorInCurrent()&&(this._viewable.hide(),b("CSS").show(this.errorBox));break}};v.prototype.buttonListener=function(event){__p&&__p();var a=event.getTarget(),c=Date.now();if(b("Parent").byClass(a,"fbPhotoTagApprovalBox")){b("FunnelLogger").appendAction(m,"approve_photo_tag");return}if(c-this.lastPage<350)return;if(b("Parent").byClass(a,"fbPhotosPhotoLike"))this.likePhoto();else if(b("Parent").byClass(a,"tagApproveIgnore"))this.updateTagBox(event,a),b("FunnelLogger").appendAction(m,"ignore_photo_tag");else if(b("Parent").bySelector(a,"._5ymu")){if(!this._showingMorePhotos){b("PhotoTagSearchPivotLogger").logShowMorePhotos();c=this.stream.getCursor();c&&this.showMorePhotos(String(c))}else b("PhotoTagSearchPivotLogger").logHideMorePhotos(),this.hideMorePhotos();return}this.hideMorePhotos()};v.prototype.likePhoto=function(){b("FunnelLogger").appendActionWithTag(m,"like_photo","snowlift-feedback");b("PhotoSessionLog").addButtonLike();var a=b("$")("fbPhotoSnowliftFeedback"),c=b("DOM").scry(a,"button.like_link")[0];c||(c=b("DOM").scry(a,"a.UFILikeLink")[0]);a=c.getAttribute("href");b("FullScreen").isFullScreen()&&(b("UserAgent_DEPRECATED").chrome()&&c.setAttribute("href","javascript:;"));c.click();c.setAttribute("href",a)};v.prototype.toggleLikeButton=function(){var a=b("DOM").scry(this.buttonActions,"a.fbPhotosPhotoLike")[0];if(a){var c=b("DOM").find(this.root,".likeCount"),d=b("DOM").find(c,".likeCountNum"),e=b("CSS").hasClass(a,"viewerLikesThis");b("FunnelLogger").appendActionWithTag(m,e?"unlike_photo":"like_photo","snowlift-feedback");c&&(e?b("DOM").setContent(d,parseInt(d.textContent,10)-1):b("DOM").setContent(d,parseInt(d.textContent,10)+1));b("CSS").toggleClass(a,"viewerLikesThis");b("CSS").removeClass(a,"viewerAlreadyLikedThis")}};v.prototype.likePhotoWithKey=function(){return b("LikeConfirmer").like(this.likePhoto.bind(this),b("getActiveElement")())};v.prototype.updateTagBox=function(a,c){this.unhiliteAllTags();a=b("ge")(a);if(!a)return;b("CSS").addClass(a,"tagBox");b("CSS").addClass(a,"tagBoxPendingResponse");b("CSS").removeClass(a,"tagBoxPending");b("CSS").hide(b("DOM").find(a,"span.tagForm"));c?b("CSS").show(b("DOM").find(a,"span.tagApproved")):b("CSS").show(b("DOM").find(a,"span.tagIgnored"))};v.prototype.rotate=function(a){__p&&__p();var c=this.stream.getCursor();if(this.getVideoOnStage()){var d=a=="left"?270:90;!this.videoRotateURI&&j(0);b("Bootloader").loadModules(["VideoRotate"],function(a){new a(c,this.videoRotateURI).motionRotate(d)}.bind(this),"PhotoSnowlift");return}var e=babelHelpers["extends"]({fbid:c,opaquecursor:this.stream.getOpaqueCursor(c),cs_ver:b("PhotosConst").VIEWER_SNOWLIFT},this.stream.getPhotoSetQuery());e[a]=1;this.setLoadingState(v.STATE_IMAGE_DATA,!0);this.setLoadingState(this.STATE_IMAGE_PIXELS,!0);this._viewable.hide();new(b("AsyncRequest"))("/ajax/photos/photo/rotate/").setAllowCrossPageTransition(!0).setData(e).setErrorHandler(this.rotationError.bind(this,c)).setFinallyHandler(this.rotationComplete.bind(this,c)).setMethod("POST").setReadOnly(!1).send()};v.prototype.rotationComplete=function(a,b){a==this.stream.getCursor()&&(this.setLoadingState(v.STATE_IMAGE_DATA,!1),this._switchViewable(this.getImageURL(this.stream.getCurrentImageData())),this.swapData())};v.prototype.rotationError=function(a,c){a==this.stream.getCursor()&&(this.setLoadingState(v.STATE_IMAGE_DATA,!1),this._switchViewable(this.getImageURL(this.stream.getCurrentImageData())),b("Bootloader").loadModules(["AsyncResponse"],function(a){a.defaultErrorHandler(c)},"PhotoSnowlift"))};v.prototype.saveTagsFromPayload=function(a){this.storeFromData(a),"data"in a&&this.stream.getCursor()in a.data&&this.swapData()};v.prototype.saveEdit=function(){if(!b("CSS").hasClass(this.root,"fbPhotoSnowliftEditMode"))return;b("Bootloader").loadModules(["PhotoInlineEditor","FormSubmit"],function(a,b){a=a.getInstance(this.getViewerConst());a&&b.send(a.getForm().controller)}.bind(this),"PhotoSnowlift")};v.prototype.mouseLeaveListener=function(event){this.unhiliteAllTags(),this.reHilitePendingTag()};v.prototype.hilitePager=function(event){var a=b("Vector").getEventPosition(event),c=b("Vector").getElementPosition(this.stage),d=b("Vector").getElementDimensions(this.stage);b("Locale").isRTL()?this.stagePagerPrev=d.x-(a.x-c.x)<v.GOPREV_AREA:this.stagePagerPrev=a.x-c.x<v.GOPREV_AREA;b("CSS").hasClass(this.prevPager,"hilightPager")!==this.stagePagerPrev&&b("CSS").conditionClass(this.prevPager,"hilightPager",this.stagePagerPrev);b("CSS").hasClass(this.nextPager,"hilightPager")===this.stagePagerPrev&&b("CSS").conditionClass(this.nextPager,"hilightPager",!this.stagePagerPrev);var e;d=event.getTarget();!b("Parent").byClass(d,"snowliftOverlay")&&!b("Parent").byClass(d,"bottomBarActions")&&!b("Parent").byClass(d,"snowliftPager")&&(e=v.PAGER_FADE);this.showPagers(e)};v.prototype.showPagers=function(a){clearTimeout(this.fadePagerTimer),this.setStagePagersActivated(!0),a!==undefined&&(this.fadePagerTimer=setTimeout(this.hidePagers.bind(this),a))};v.prototype.hidePagers=function(){if(this._mouseOnPhotoStage||this._actionMenuOpen)return;clearTimeout(this.fadePagerTimer);this.setStagePagersActivated(!1)};v.prototype.getTagger=function(){return this.PhotoTagger&&this.PhotoTagger.getInstance(b("PhotosConst").VIEWER_SNOWLIFT)};v.prototype.unhiliteAllTags=function(){__p&&__p();clearTimeout(this.unhiliteTimer);b("DOM").scry(this.stage,"div.tagsWrapper div.hover").forEach(function(a){b("CSS").removeClass(a,"hover")});b("DOM").scry(this.stage,"div.tagsWrapper div.otherActive").forEach(function(a){b("CSS").removeClass(a,"otherActive")});this.hilitedTag=null;this.showingTypeaheadSuggestions=!1;if(!b("CSS").hasClass(this.root,"taggingMode")){var a=this.getTagger();a&&!a.isSpherical&&(a.hideTagger(),a.setCurrentFacebox(null))}};v.prototype.switchHilitedTags=function(a,c){__p&&__p();this.switchTimer!==null&&(clearTimeout(this.switchTimer),this.switchTimer=null);this.unhiliteAllTags();this.hiliteAllBoxes();var d=b("ge")(a);if(d){this.hilitedTag=a;if(!b("CSS").hasClass(this.root,"taggingMode")&&b("PhotosUtils").isFacebox(this.hilitedTag)){var e=this.getTagger();if(e){b("CSS").addClass(d,"hover");a=e.getFacebox(a);e.setCurrentFacebox(a);a&&e.addTagFromFacebox(a)}}else b("CSS").addClass(d,"hover");b("CSS").hasClass(d,"tagBoxPending")&&!b("CSS").hasClass(d,"showPendingTagName")&&c===!0&&(b("DOM").scry(this.stage,"div.tagsWrapper div.showPendingTagName").forEach(function(a){b("CSS").removeClass(a,"showPendingTagName")}),b("CSS").addClass(d,"showPendingTagName"))}};v.prototype.reHilitePendingTag=function(){var a=b("ge")(this.hilitedTag);if(a&&b("CSS").hasClass(a,"showPendingTagName"))return;a=b("DOM").scry(this.stage,"div.tagsWrapper div.showPendingTagName")[0];a&&this.switchHilitedTags(a.id)};v.prototype.hiliteTagsOnMouseMove=function(event){__p&&__p();if(!this.stream.getCurrentExtraData()||this.getVideoOnStage())return;if(this.switchTimer!==null)return;var a=event.getTarget();if(b("Parent").byClass(a,"snowliftOverlay")||b("Parent").byClass(a,"fbPhotoSnowliftTagApproval")||b("Parent").byClass(a,"tagPointer")||b("Parent").byClass(a,"arrow")||b("Parent").byClass(a,"faceboxSuggestion")||b("Parent").byClass(a,"typeaheadWrapper")||b("Parent").byClass(a,"photoTagTypeahead")||b("Parent").byClass(a,"ufiContainer"))return;a=b("Parent").byClass(a,"tagBoxPending");var c=!1;if(this.hilitedTag){var d=b("ge")(this.hilitedTag);c=d&&b("CSS").hasClass(d,"tagBoxPending")}d=!this.hilitedTag&&a||!c&&a;if(d){this.switchHilitedTags(a.id);return}if(a&&a.id==this.hilitedTag)return;d=250;a=15;var e=b("Vector").getEventPosition(event);this.startingMousePos||(this.startingMousePos=e);var f=b("PhotosUtils").absoluteToNormalizedPosition(this._viewable.getElement(),e);if(!this.haveLeftBufferRegion&&this.startingMousePos.distanceTo(e)<a)return;else this.haveLeftBufferRegion=!0;if(this.currentTagHasPrecedence(f))return;e=b("PhotosUtils").getNearestBox(this.stream.getCurrentExtraData().tagRects,f);if(!e){c||(this.unhiliteAllTags(),this.reHilitePendingTag());return}a=null;if(c){var g={};g[this.hilitedTag]=this.stream.getCurrentExtraData().tagRects[this.hilitedTag];a=b("PhotosUtils").getNearestBox(g,f)}if(a!==null&&c)return;this.hilitedTag!=e&&(c?this.switchTimer=setTimeout(this.switchHilitedTags.bind(this,e),d):(this._showHover&&!this._seenTags[e]&&(this._seenTags[e]=!0,b("PhotoTagSearchPivotLogger").logPivotImpression("snowlift",e)),this.switchHilitedTags(e)))};v.prototype.currentTagHasPrecedence=function(a){if(!this.hilitedTag)return!1;if(this.stream.getCurrentExtraData().tagRects[this.hilitedTag]===undefined){this.hilitedTag=null;return!1}var c=this.stream.getCurrentExtraData().tagRects[this.hilitedTag];c=new(b("Rect"))(c.t+c.h()/2,c.r,c.b+(b("PhotosUtils").isFacebox(this.hilitedTag)?10:0),c.l,c.domain);return c.contains(a)};v.prototype.getVideoOnStage=function(){var a=this.stream&&this.stream.getCurrentImageData();return a&&a.video};v.prototype.shouldPageOnAction=function(a,c){__p&&__p();if(!this.isOpen||b("LikeConfirmer").isShowingConfirmation())return!1;var d=b("isNode")(c)&&(b("Parent").byClass(c,"snowliftPager")||b("Parent").byClass(c,"stagePagers")||b("Parent").byClass(c,"pivotPageColumn")),e=b("isNode")(c)&&b("Parent").byClass(c,"stage"),f=b("CSS").hasClass(c,"faceBox");f=!b("CSS").hasClass(this.root,"taggingMode")&&f&&!d;if(f){this.showingTypeaheadSuggestions||(this.getTagger().updateWithSuggestions(),setTimeout(function(){b("DOM").find(this.getTagger().tagger,"input.textInput").focus()}.bind(this),0));this.showingTypeaheadSuggestions=!this.showingTypeaheadSuggestions;return!1}c=e&&b("CSS").hasClass(this.root,"taggingMode")||b("Parent").byClass(c,"tagBoxPending")||b("Parent").byClass(c,"tagBoxPendingResponse")||b("Parent").byClass(c,"fbPhotoTagApprovalBox")||b("Parent").byClass(c,"tag")||b("Parent").byClass(c,"sphericalHeadingIndicator")||b("Parent").byClass(c,"sphericalVolumeControl")||b("Parent").byClass(c,"sphericalPhotoWrapper");return c?!1:a==b("Keys").LEFT||a==b("Keys").RIGHT||a==n||a==o||d||f||e};v.prototype.keyHandler=function(a,event){__p&&__p();if(event.getModifiers().any||b("Layer").getTopmostLayer()!==this.spotlight)return!0;switch(b("Event").getKeyCode(event)){case b("Keys").LEFT:case b("Keys").RIGHT:case n:case o:this.pageListener(event);return!1;case p:b("FunnelLogger").appendActionWithTagIfNew(m,b("FullScreen").isFullScreen()?"fullscreen_exit":"fullscreen_enter","key-f");return this.toggleFullScreen();case q:return this.likePhotoWithKey();case b("Keys").SPACE:this.showPagers(v.PAGER_FADE);return!1}return null};v.prototype.shouldHandlePendingTag=function(event){var a=this.getTagger();if(!a||!a.tags.length)return!1;var c=b("PhotosUtils").absoluteToNormalizedPosition(this.getImage(),b("Vector").getEventPosition(event));a=a.findNearestTag(c);if(!a||!b("CSS").hasClass(a.node,"tagBoxPending"))return!1;b("Arbiter").inform("PhotoTagApproval.PENDING_TAG_PHOTO_CLICK",{id:a.id,version:this.getVersionConst()});return!0};v.prototype.pageListener=function(event){__p&&__p();var a=b("Event").getKeyCode(event),c=event.getTarget();if(!this.shouldPageOnAction(a,c))return;if(this.shouldHandlePendingTag(event))return;var d=0,e=null;if(a==b("Keys").RIGHT||a==o)d=1,b("FunnelLogger").appendActionWithTag(m,"image_prev","key-right"),b("PhotoSessionLog").setPagingAction("key_right"),this._disableMouseOver=!0;else if(a==b("Keys").LEFT||a==n)d=-1,b("FunnelLogger").appendActionWithTag(m,"image_next","key-left"),b("PhotoSessionLog").setPagingAction("key_left"),this._disableMouseOver=!0;else if(b("Parent").byClass(c,"next"))d=1,b("FunnelLogger").appendActionWithTag(m,"image_next","button-next"),b("PhotoSessionLog").setPagingAction("click_next");else if(b("Parent").byClass(c,"prev"))d=-1,b("FunnelLogger").appendActionWithTag(m,"image_prev","button-prev"),b("PhotoSessionLog").setPagingAction("click_prev");else if(e=b("Parent").byClass(c,"seek")){a=b("DataStore").get(e,"seek-fbid");d=this.stream.getRelativeMovement(a);b("PhotoSessionLog").setPagingAction("seek")}else!this.stagePagerPrev?(d=1,b("FunnelLogger").appendAction(m,"image_next","click-stage"),b("PhotoSessionLog").setPagingAction("click_stage")):(d=-1,b("FunnelLogger").appendAction(m,"image_prev","click-stage"),b("PhotoSessionLog").setPagingAction("click_stage_back"));c=b("DOM").scry(this.ufiForm,"input.mentionsHidden");e=!1;for(var a=0;a<c.length;a++)if(!b("Input").isEmpty(c[a])){e=!0;break}e||b("CSS").hasClass(this.root,"fbPhotoSnowliftEditMode")?this.warnLeavePage(this.page.bind(this,d)):this.page(d,b("UserAgent_DEPRECATED").chrome()&&b("FullScreen").isFullScreen())};v.prototype.warnLeavePage=function(a){new(b("Dialog"))().setTitle(i._("Are You Sure You Want To Leave This Page?")).setBody(i._("You have unsaved changes that will be lost if you leave the page.")).setButtons([{name:"leave_page",label:i._("Leave This Page"),handler:a},{name:"continue_editing",label:i._("Stay on This Page"),className:"inputaux"}]).setModal(!0).show()};v.prototype.getUsesOpaqueCursor=function(){return this.stream.getUsesOpaqueCursor()};v.prototype.getOpaqueCursor=function(a){return this.stream.getOpaqueCursor(a)};v.prototype.setReachedLeftEnd=function(){this.stream.setReachedLeftEnd()};v.prototype.setReachedRightEnd=function(){this.stream.setReachedRightEnd()};v.prototype._initLitestandShareAttachments=function(){var a=b("DOMQuery").scry(this.root,"."+b("LitestandShareAttachment").getSimpleCropClass());a.forEach(function(a){return b("LitestandShareAttachment").init(a)})};v.prototype.page=function(a,c,d){__p&&__p();if(!this.stream.isValidMovement(a)||!this.stream.nonCircularPhotoSetCanPage(a)){this.showPagers(v.PAGER_FADE);return}var e=this.stream.getCursorAt(this.stream.calculatePositionForMovement(a));if(this.snowflake&&(this.stream.getCursor()==this.firstInSet&&a<0||this.firstInSet==e&&a>0)){this.showPagers(v.PAGER_FADE);return}this.lastPage=Date.now();this.unhiliteAllTags();this.startingMousePos=null;this.haveLeftBufferRegion=!1;this._seenTags={};this._navCount+=a;var f=this.stream.allLoaded?Math.abs(this._navCount)-this.stream.getLength():null;if(this._extraSlidePivot&&this._albumFBID){!this._albumBoundaries.end&&f===0?(this._albumBoundaries.end=this.stream.getCursor(),this._albumBoundaries.dir=a):f===-1&&b("PhotosetSearchPivotData").fetch(this._albumFBID,this.stream);if(!this.onExtraSlide)if(this.stream.getCursor()===this._albumBoundaries.end&&e===this._albumBoundaries.start&&a===this._albumBoundaries.dir){this.showPivotSlide(this._albumFBID,c);return}else this.stream.getCursor()===this._albumBoundaries.start&&e===this._albumBoundaries.end&&a===-this._albumBoundaries.dir&&this.showPivotSlide(this._albumFBID,c);else{this.hidePivotSlide();if(a===-this._albumBoundaries.dir)return}}e=this.getVideoOnStage();e&&this.switchVideo(e,!1);if(this.pivots&&this.pivots.page(a))return;b("Arbiter").inform("PhotoSnowlift.PAGE");b("Toggler").hide();this.recacheData();this.stream.moveCursor(a);this._viewable.hide();a!==0&&(this.storyID=null,this._updateContainerOwnerID());if(this.stream.errorInCurrent()){this.setLoadingState(v.STATE_HTML,!0);b("CSS").show(this.errorBox);return}this.movementDelta+=a;e=this.stream.getCurrentImageData();if(e){a=this.getImageURL(e);a?this._switchViewable(a,null,!0):e.video&&this.switchVideo(e.video,!0,d);e.info.ocmarkup?this.showObjectionableWarning(e.info.ocmarkup):this.hideObjectionableWarning();e.info.disablecontextmenu?this.disableContextMenu():this.enableContextMenu();c||(this.replaceUrl=!0,b("goURI")(e.info.permalink));this.setLoadingState(v.STATE_IMAGE_DATA,!1)}else this.setLoadingState(v.STATE_IMAGE_PIXELS,!0),this.setLoadingState(v.STATE_IMAGE_DATA,!0);this.stream.getCurrentHtml()?this.swapData():this.setLoadingState(v.STATE_HTML,!0);this.disableAds=!this.isLoggedInViewer||this.stream.isInViewAsMode();this.loadAds();this.setLeftAndRightPagersState();!this._extraSlidePivot&&this._showMorePhotos&&this._albumFBID&&(f===-1?b("PhotosetSearchPivotData").fetch(this._albumFBID,this.stream):f===0?(b("PhotoTagSearchPivotLogger").logSuggestMorePhotos(),this.showMorePhotos(this._albumFBID,!0),this.showPagers(),this._navCount=0):(this.hideMorePhotos(),this.hidePagers()));this._initLitestandShareAttachments()};v.prototype.showMorePhotos=function(a,c){if(this._showingMorePhotos)return;this._showingMorePhotos=!0;this.searchPivot||(this.searchPivot=this.overlay.appendChild(document.createElement("div")));b("CSS").addClass(this.stageWrapper,"_5ymv");this.searchPivotComponent=new(b("ReactComponentRenderer"))(b("PhotosetSearchPivot.react"),this.searchPivot);this.searchPivotComponent.setProps({className:"_27g",fbid:a,onclose:this.hideMorePhotos.bind(this),endofalbum:c||!1,withBackground:!0})};v.prototype.hideMorePhotos=function(){this.searchPivotComponent&&this._showingMorePhotos&&(this._showingMorePhotos=!1,b("CSS").removeClass(this.stageWrapper,"_5ymv"),this.searchPivotComponent.setProps({fbid:null}))};v.prototype.showPivotSlide=function(a,c){if(this.onExtraSlide)return;this.onExtraSlide=!0;b("CSS").addClass(this.stageWrapper,"_3tvf");this.pivotSlide||(this.pivotSlide=b("DOM").create("div"),b("DOM").insertBefore(this.stageActions,this.pivotSlide));this.pivotSlideComponent=new(b("ReactComponentRenderer"))(b("PhotosetPivotSlide.react"),this.pivotSlide);this.pivotSlideComponent.setProps({fbid:a,isAlbum:this._isAlbum,albumOwnerName:this._albumOwnerName,visible:!0,onReturn:this.page.bind(this,this._albumBoundaries.dir,c)})};v.prototype.hidePivotSlide=function(){this.pivotSlideComponent&&this.onExtraSlide&&(this.pivotSlideComponent.setProps({visible:!1}),b("CSS").removeClass(this.stageWrapper,"_3tvf")),this.onExtraSlide=!1};v.prototype.logImpressionDetailsForPhoto=function(){__p&&__p();var a=[].concat(b("DOM").scry(b("$")("fbPhotoSnowliftTagList"),"input.photoImpressionDetails"),b("DOM").scry(b("$")("fbPhotoSnowliftFeedback"),"input.photoImpressionDetails"));if(a.length===0)return;var c={};for(var d=0;d<a.length;d++)c[a[d].name]=a[d].value;if(this.getVideoOnStage())c.width=0,c.height=0;else{a=this._viewable.getNaturalDimensions();c.width=a.x;c.height=a.y}b("PhotoSessionLog").addDetailData(this.stream.getCursor(),c);b("PhotoSnowliftAds").setIsLogAdData(!0)};v.prototype.loadAds=function(){if(this.disableAds)return;b("PhotoSnowliftAds").loadAdsFromUserActivity()};v.prototype.transitionHandler=function(a){__p&&__p();if(a.getQueryData().closeTheater||a.getQueryData().permPage||this.returningToStart){this.isOpen&&this.close();this.transitionHandlerRegistered=!1;return!1}if(this.replaceUrl){this.replaceUrl=!1;this._uriStack.push(a.getQualifiedURI().toString());b("PageTransitions").transitionComplete(!0);return!0}var c=this._uriStack.length;c>=2&&this._uriStack[c-2]==a.getQualifiedURI().toString()&&this._uriStack.pop();c=this.stream.getCursorForURI(a.getUnqualifiedURI().toString());if(c){a=this.stream.getRelativeMovement(c);this.page(a,!0);b("PageTransitions").transitionComplete(!1);return!0}if(this.isOpen){b("PageTransitions").transitionComplete(!0);this.close();return!0}this.transitionHandlerRegistered=!1;return!1};v.prototype.recacheData=function(){if(!this.loadingStates.html){var a=this.stream.getCurrentHtml();for(var c in a){var d=b("$")(c);a[c]=Array.from(d.childNodes);b("DOM").empty(d)}}};v.prototype.reloadIfTimeout=function(){if(!b("ImageUtils").hasLoaded(this.image)){var a=this.makeNewImage(this.image.src,!0);b("Event").listen(a,"load",this.useImage.bind(this,a,null,!0));this._log(a.src)}};v.prototype._useViewable=function(a,c,d){__p&&__p();arguments.length<=3||arguments[3]===undefined?!1:arguments[3];if(d&&this._viewable.isReady())return;var e=function(){var d=this._viewable;this._viewable=a;b("DOM").replace(d.getElement(),a.getElement());this.setLoadingState(this.STATE_IMAGE_PIXELS,!1);this.adjustStageSize(c);setTimeout(function(){this.isOpen&&(this.adjustStageSize(),this.adjustForNewData())}.bind(this),0);d.suspend()}.bind(this);a.whenReady(e)};v.prototype.useImage=function(a,c,d){var e=arguments.length<=3||arguments[3]===undefined?!1:arguments[3];if(d&&b("ImageUtils").hasLoaded(this.image))return;var f=function(){b("DOM").replace(this.image,a),this.image=a,this.adjustStageSize(c)}.bind(this);!e||b("ImageUtils").hasLoaded(a)?f():b("Event").listen(a,"load",f)};v.prototype.makeNewImage=function(a,c){__p&&__p();this.imageLoadingTimer?(clearTimeout(this.imageLoadingTimer),this.imageLoadingTimer=null):c||(this.imageRefreshTimer=setTimeout(this.reloadIfTimeout.bind(this),v.LOADING_TIMEOUT));c=b("DOM").create("img",{className:"spotlight",alt:""});c.setAttribute("aria-describedby","fbPhotosSnowliftCaption");c.setAttribute("aria-busy","true");var d=function(){clearTimeout(this.imageRefreshTimer),this.image.setAttribute("aria-busy","false"),this.setLoadingState(this.STATE_IMAGE_PIXELS,!1),setTimeout(function(){this.isOpen&&(this.adjustStageSize(),this.adjustForNewData())}.bind(this),0)}.bind(this);b("Event").listen(c,"load",d);this._log(a);b("EncryptedImg").isEncrypted(a)?b("EncryptedImg").insertIntoDOM(a,c):c.src=a;return c};v.prototype._switchViewable=function(a,c,d){__p&&__p();var e=arguments.length<=3||arguments[3]===undefined?!1:arguments[3];b("CSS").hide(this.errorBox);e||this._viewable.hide();this.setLoadingState(this.STATE_IMAGE_PIXELS,!0);var f=this.stream&&this.stream.getCurrentImageData();if(f){b("PhotoSessionLog").addPhotoView(f.info,this.shouldShowHiRes(f),this.fullscreen&&b("FullScreen").isFullScreen());if(this._showHover){var g=this.stream.getCurrentExtraData();g&&b("PhotoTagSearchPivotLogger").logImageImpression("snowlift",String(this.stream.getCursor()),Object.keys(g.tagRects))}}var h=this._viewable.getElement().children[0],i;!1;this.isSpherical()&&this.sphericalPhotoData?i=f.info.fbid.toString()===this.sphericalPhotoData.fbid:i=h.src===a;if(!i){var j=b("PhotoSnowliftViewableUtils").fromStreamData(f,this);this.sphericalPhotoData=null;this.fullscreen&&b("FullScreen").isFullScreen()&&(j.onToggleIntoFullScreen(),j.onEnterFullScreen());this._log(a);this._useViewable(j,c,!1,e)}else h.setAttribute("alt",f.info.caption),h.setAttribute("aria-busy","true"),this.adjustStageSize(c),this._viewable.show(),this._log(a);d&&this.stream.preloadImages(this.shouldShowHiRes.bind(this));b("Arbiter").inform("PhotoSnowlift.SWITCH_IMAGE")};v.prototype._preloadNextVideo=function(){var a=this.stream.calculatePositionForMovement(1);a=this.stream.getCursorAt(a);a=this.stream.getImageData(a);a&&a.video&&a.controller&&a.controller.preload()};v.prototype._emptyVideoStage=function(){b("DOM").empty(this.videoStage)};v.prototype.switchVideo=function(a,c,d){__p&&__p();var e=this;this._pauseVideoIfNeeded();var f="swf_"+a;window.videoStage=this.videoStage;this._emptyVideoStage();if(c){var g,h,i,j;(function(){__p&&__p();e._preloadNextVideo();b("CSS").addClass(e.stageWrapper,"showVideo");g=e.stream.getCurrentImageData();e.shouldRenderVideoPivots&&(b("CSS").hide(e.nextPager),b("CSS").hide(e.prevPager));var k=void 0,l=void 0;e._abortVideoWhenSwitch=!0;if(g.useReactPlayer){k=b("DOM").create("div");var m=new(b("VideoData"))(g.videoData),n=g;n=n.PhotoSnowliftVideoNode;n&&!e.PhotoSnowliftVideoNode&&(e.PhotoSnowliftVideoNode=n);var o=n.getVideoNode(m.getVideoID());if(o)k=o.getVideoContainer(),e._videoPlayerStateManager=o.getVideoPlayerController(),o.updateDimension(g.width,g.height),g.keepReactVideoNodeLoaded&&(e._abortVideoWhenSwitch=!1);else{o=g.PhotoSnowliftVideo;b("ReactDOM").render(b("React").createElement(o,{width:g.width,height:g.height,videoData:m,ref:function(a){return l=a}}),k);e._videoPlayerStateManager=l.getVpc();n.destroyVideoNode()}}else k=g.video_element,b("DOM").scry(k,"._ox1")[0].style.cssText="",e._videoPlayerStateManager=g.controller;c=null;e.pivotsCarouselElement&&(c=b("DOMQuery").scry(e.pivotsCarouselElement,"._32_l"));c&&c.forEach(function(a){var c=a.getAttribute("data-fbid"),d=this.stream.getCursor();a=b("DOM").find(a,"._1pqn");c===d?b("CSS").show(a):b("CSS").hide(a)}.bind(e));b("CSS").addClass(k,"videoStageContainer");b("DOM").appendContent(e.videoStage,k);b("DOM").appendContent(e.videoStage,e.pivotsCarouselElement);e.videoContainer=k;window[f]&&!b("ge")(f)&&window[f].write(a);h="video_warning_"+a;i=b("ge")(a);e.videoWarnings||(e.videoWarnings=[]);i&&e.videoWarnings[h]&&b("DOM").setContent(i,e.videoWarnings[h]);g.abortedLoadingOtherVideos&&(e._preloadTimeout&&clearTimeout(e._preloadTimeout),e._preloadTimeout=setTimeout(function(){var a=this.stream.getPreviousImageData(),b=this.stream.getNextImageData();b&&b.controller&&b.controller.preload();a&&a.controller&&a.controller.preload()}.bind(e),t));g.useReactPlayer||e._videoPlayerStateManager.reset();e._videoPlayerStateManager.collectFeedTrackingData();e._videoPlayerStateManager.hasOption("PhotoSnowlift","isInSnowlift")||e._videoPlayerStateManager.registerOption("PhotoSnowlift","isInSnowlift",function(){return!0});e._videoPlayerStateManager.emit("PhotoSnowlift/enterSnowlift");e._autoplayVideos&&(j=d||b("VideoPlayerReason").USER,e._videoPlayerStateManager.play(j));e._autoplayNextVideo&&e._videoPlayerStateManager.addListener("finishPlayback",function(){var a=g.info.fbid.toString();if(this.haltAutoplay&&a!==this.stream.fbidList[this.stream.fbidList.length-1]){if(this.autoplayOptionScreenConfig){a=this.autoplayOptionScreenConfig.controller;a.registerCallbacks(k,this.chooseToReplayVideo.bind(this,this._videoPlayerStateManager),this.handleAutoplay.bind(this,g))}}else this.handleAutoplay(g)}.bind(e));setTimeout(e.adjustStageSizeForVideo.bind(e,a),0)})()}else window[f]&&window[f].addVariable("video_autoplay",0),this.videoLoadTimer&&clearTimeout(this.videoLoadTimer),b("CSS").removeClass(this.stageWrapper,"showVideo")};v.prototype.removeAutoplayOptionScreen=function(){this.autoplayOptionScreenConfig&&this.autoplayOptionScreenConfig.controller.removeSelf()};v.prototype.chooseToReplayVideo=function(a){a.play(b("VideoPlayerReason").USER),this.removeAutoplayOptionScreen(),this.haltAutoplay=!1};v.prototype.handleAutoplay=function(a){a=a.info.fbid.toString();a===this.stream.getCursor()&&a!==this.stream.fbidList[this.stream.fbidList.length-1]&&(b("SnowliftVideoPivotsCarouselController").adjustCarouselOnAutoPlay(),this.page(1,!1,b("VideoPlayerReason").AUTOPLAY));this.removeAutoplayOptionScreen();this.haltAutoplay=!1};v.prototype.checkVideoStatus=function(a){this.videoLoadTimer&&clearTimeout(this.videoLoadTimer);var b=this.getVideoOnStage();if(!b)return;else{if(b!==a)return;this.adjustStageSizeForVideo(a)}};v.prototype.getVideoSize=function(a){a=new(b("Vector"))(a.getAttribute("data-video-width"),+a.getAttribute("data-video-height")+this.getVideoComponentsHeight(a));if(this._videoPlayerStateManager&&this._videoPlayerStateManager.isSpherical&&this._videoPlayerStateManager.isSpherical()){var c=b("Vector").getViewportDimensions(),d=c.x;c=c.x/2;return new(b("Vector"))(d,c)}else return a};v.prototype.getVideoElement=function(a){return b("DOM").scry(this.videoStage,"._ox1")[0]};v.prototype.getVideoComponentsHeight=function(a){__p&&__p();var c=0;a=b("Parent").bySelector(a,"._1c_u");if(!a)return 0;a=b("DOM").scry(a,"._2i84");if(a.length){a=a[0].getBoundingClientRect();c=a.bottom-a.top}return c};v.prototype.adjustStageSizeForVideo=function(a){var b=this.getVideoElement(a);!b?this.videoLoadTimer=setTimeout(this.checkVideoStatus.bind(this,a),200):this.adjustStageSize(this.getVideoSize(b))};v.prototype.handleServerError=function(a,c){b("DOM").setContent(this.errorBox,a),this.storeFromData(c)};v.prototype.fixButtonText=function(a){__p&&__p();if(!this.buttonTruncateGk)return;var c=b("DOM").scry(a,".photosTruncatingUIButton");a=parseInt(b("Style").get(a,"width"),10);if(a>r){a={tagPhoto:i._("Tag Photo"),doneTagPhoto:i._("Done Tagging"),productTagPhoto:i._("Tag Products"),doneProductTagPhoto:i._("Done Tagging"),addLocation:i._("Add Location"),editPhoto:i._("Edit")};for(var d=0;d<c.length;d++){var e=c[d];b("CSS").addClass(e,"_2n0k");b("Tooltip").set(e,a[e.getAttribute("data-buttonname")],"below","center")}}};v.prototype.swapData=function(){__p&&__p();var a=this.stream.getCurrentHtml();if(a){this.setLoadingState(v.STATE_HTML,!1);for(var c in a){var d=b("ge")(c);d&&b("DOM").setContent(d,a[c])}d=b("ge")("photosTruncatingUIButtonGroup");d&&this.fixButtonText(d);b("Arbiter").inform("PhotoSnowlift.DATA_CHANGE",Object.assign(this.stream.getCurrentImageData().info,{movement:this.movementDelta,isSpherical:this.isSpherical()}),b("Arbiter").BEHAVIOR_STATE);this.movementDelta=0;this.stream.getCurrentExtraData()&&b("Arbiter").inform("PhotoSnowlift.EXTRA_DATA_CHANGE",this.stream.getCurrentExtraData(),b("Arbiter").BEHAVIOR_STATE)}this.adjustScroller();this.scrollableArea.showScrollbar({hideAfterDelay:!0});this.adjustForNewData();this.logImpressionDetailsForPhoto()};v.prototype.updateTotalCount=function(a,c,d){__p&&__p();var e=this.stream.getCurrentHtml();if(e){var f=b("$")("fbPhotoSnowliftPositionAndCount");b("DOM").replace(f,d);f=d;b("CSS").show(f);d="fbPhotoSnowliftPositionAndCount";e[d]=Array.from(f.childNodes)}this.stream.setTotalCount(a);this.stream.setFirstCursorIndex(c)};v.prototype.addPhotoFbids=function(a,b,c,d){__p&&__p();if(d&&this.sessionID&&d!=this.sessionID)return;d=this.stream.getCursor()===null;this.shouldRenderVideoPivots&&!this._videoSameAsSource&&(this.stream.fbidList=[]);this.stream.attachToFbidsList(a,b,c);c&&d&&this.page(0,!0);this.pivots&&c&&this.pivots.setCycleCount(this.stream.calculateDistance(this.stream.getCursor(),this.stream.firstCursor));!this.pagersShown&&this.stream.canPage()&&this.setStagePagersState("ready");this.setLeftAndRightPagersState();if(this.shouldRenderVideoPivots&&!this._videoSameAsSource){a=this.stream.getCursor();b=this.stream.calculateDistance(a,this._mediaFBID);this.stream.moveCursor(b)}};v.prototype.attachTagger=function(a,c,d){b("DOM").appendContent(this.stageActions,a),c&&c.setTokenarea(this.taglist),d&&b("DOM").appendContent(b("DOM").find(a,"div.faceBox"),d)};v.prototype.setAuthorName=function(a,c){__p&&__p();var d=b("Parent").bySelector(c,".rhc");if(d){this.previousAuthorName=this.currentAuthorName;this.currentAuthorName=a;if(this._navHistory.length>1&&this.previousAuthorName){d=this._navHistory[this._navHistory.length-2];this.backButton=b("ReactDOM").render(b("React").createElement(b("PhotoSnowliftBackLink.react"),{href:d,name:this.previousAuthorName,visible:!0}),c)}else this.backButton=b("ReactDOM").render(b("React").createElement(b("PhotoSnowliftBackLink.react"),{visible:!1}),c)}};v.prototype.storeFromData=function(a){__p&&__p();if(!this.isOpen)return;a.pivots&&(this.pivotsCarouselElement=a.pivots);a.autoplay_option_screen_config&&(this.autoplayOptionScreenConfig=a.autoplay_option_screen_config,this.autoplayOptionScreenConfig&&this.autoplayOptionScreenConfig.enabled&&this.addHaltAutoplaySubscription());this.shouldRenderVideoPivots=a.should_render_pivots;if(a.ssid&&this.sessionID&&this.sessionID!=a.ssid)return;var c=this.stream.storeToCache(a);if("error"in c){this.checkState(v.STATE_ERROR);return}"init"in a?(this.shouldRenderVideoPivots&&(this._videoSameAsSource=a.init.videoSameAsSource),this._mediaFBID=a.init.fbid,this._albumFBID=a.init.album_fbid,this._isAlbum=a.init.is_album,this._albumOwnerName=a.init.album_owner_name,this._autoplayVideos=a.init.autoplay_videos,this._autoplayNextVideo=a.init.autoplay_next_video,this._referrerProfileID=a.init.referrer_profile_id):this._preloadNextVideo();a="init"in c;a&&(this.initialDataFetched(c.init),this.openExplicitly&&(this.replaceUrl=!0,b("goURI")(this.stream.getCurrentImageData().info.permalink)),this.stream.canPage()&&this.setStagePagersState("ready"),this.setLeftAndRightPagersState());"image"in c&&this.checkState(v.STATE_IMAGE_DATA,a);"data"in c&&this.checkState(v.STATE_HTML)};v.prototype.setLeftAndRightPagersState=function(){this.stream.isNonCircularPhotoSet()&&(b("CSS").conditionClass(this.root,"disableLeft",!this.stream.nonCircularPhotoSetCanPage(-1)),b("CSS").conditionClass(this.root,"disableRight",!this.stream.nonCircularPhotoSetCanPage(1)));if(this.snowflake){b("CSS").conditionClass(this.root,"disableLeft",this.stream.getCursor()==this.firstInSet);var a=this.stream.getCursorAt(this.stream.calculatePositionForMovement(1));b("CSS").conditionClass(this.root,"disableRight",a==this.firstInSet)}};v.prototype.setStagePagersActivated=function(a){b("CSS").hasClass(this.root,"pagingActivated")!==a&&b("CSS").conditionClass(this.root,"pagingActivated",a)};v.prototype.setStagePagersState=function(a){switch(a){case"ready":b("CSS").addClass(this.root,"pagingReady");this.pagersShown=!0;return;case"disabled":case"reset":b("CSS").removeClass(this.root,"pagingReady");return}};v.prototype.deletePhoto=function(a){this.closeRefresh()};v.prototype.closeRefresh=function(){this.refreshOnClose=!0,this.spotlight.hide()};v.prototype.onHiliteTag=function(a,c){if(c.version!=b("PhotosConst").VIEWER_SNOWLIFT)return;a=c.tag;a&&this.switchHilitedTags(a,!0)};v.prototype.onUpdateTagBox=function(a,c){c.version==b("PhotosConst").VIEWER_SNOWLIFT&&this.updateTagBox(c.id,c.approve)};v.prototype.isSpherical=function(){var a=this.stream.getCurrentImageData();return Boolean(a&&a.spherical)||this.thumbSpherical};v.prototype._log=function(a){if(this._shouldLog){this._logger&&this._logger.log(a.startsWith("data:")?b("EncryptedImg").dataUrlPrefix(a):a,String(this.stream.getCursor()),this.getViewerSource(),this._referrerProfileID);return!0}return!1};v.prototype._enableMouseOver=function(){this._disableMouseOver=!1};v.prototype._interceptMouseOver=function(event){this._disableMouseOver&&event.kill()};v.prototype.isReturningToStart=function(){return!!this.returningToStart};v.prototype._pauseVideoIfNeeded=function(){this._videoPlayerStateManager&&(this._videoPlayerStateManager.pause("unloaded"),b("VideoPlayerAbortLoadingExperiment").canAbort&&this._abortVideoWhenSwitch&&this._videoPlayerStateManager.abortLoading(),this._videoPlayerStateManager.hasOption("PhotoSnowlift","isInSnowlift")&&this._videoPlayerStateManager.unregisterOption("PhotoSnowlift","isInSnowlift"),this._videoPlayerStateManager.emit("PhotoSnowlift/exitSnowlift"))};v.prototype._destroyVideoIfNeeded=function(){this._videoPlayerStateManager&&b("SnowliftDestroyVideoPlayerExperiment").destroyVideoOnExit&&this._videoPlayerStateManager.destroy()};v.prototype.setIsLiveBroadcast=function(){this._isLiveBroadcast=!0};v.prototype.registerLiveInputBar=function(a){this._liveInputBar=a};v.prototype.setActionsMenuState=function(a){this._actionMenuOpen=a,a||this.hidePagers()};v.prototype.registerActionsMenu=function(a){this._actionsMenuSubscriptionsHandler=new(b("SubscriptionsHandler"))(),this._actionsMenuSubscriptionsHandler.addSubscriptions(a.getPopover().subscribe("show",function(){return this.setActionsMenuState(!0)}.bind(this)),a.getPopover().subscribe("hide",function(){return this.setActionsMenuState(!1)}.bind(this)))};v.getInstance=function(){v._instance||(v._instance=new v());return v._instance};v.initWithSpotlight=function(a,b){v.getInstance().init(a,b)};v.addPhotoFbids=function(a,b,c,d){v.getInstance().addPhotoFbids(a,b,c,d)};v.registerActionsMenu=function(a){var b=v.getInstance();b||j(0);b.registerActionsMenu(a)};v.registerLiveInputBar=function(a){v.getInstance().registerLiveInputBar(a)};v.setIsLiveBroadcast=function(){v.getInstance().setIsLiveBroadcast()};v.setReachedLeftEnd=function(){v.getInstance().setReachedLeftEnd()};v.setReachedRightEnd=function(){v.getInstance().setReachedRightEnd()};v.attachFollowFlyout=function(a){b("DOM").insertAfter(b("$")("fbPhotoSnowliftSubscribe"),a)};v.attachSubscribeFlyout=function(a){b("DOM").insertAfter(b("$")("fbPhotoSnowliftSubscribe"),a)};v.attachTagger=function(a,b,c){v.getInstance().attachTagger(a,b,c)};v.bootstrap=function(a,c){var d=String(b("URI").getMostRecentURI().getQueryData().viewas),e=new(b("URI"))(a).getQueryData();if(!b("PhotoSnowliftLoader").shouldUseSnowlift(e,a,c,d))return;b("FunnelLogger").startFunnel(m);c!=null&&b("Parent").bySelector(c,"._18ia")!=null&&b("FunnelLogger").addFunnelTag(m,"via_search_media_module");v.getInstance().bootstrap(a,c)};v.closeRefresh=function(){v.getInstance().closeRefresh()};v.deletePhoto=function(a){v.getInstance().deletePhoto(a)};v.getImage=function(){return v.getInstance().getImage()};v.getImageId=function(){return v.getInstance().getImageId()};v.getLoadQuery=function(){return v.getInstance().getLoadQuery()};v.getRHCBody=function(){return v.getInstance().getRHCBody()};v.getRHCFooter=function(){return v.getInstance().getRHCFooter()};v.getRHCHeader=function(){return v.getInstance().getRHCHeader()};v.getRoot=function(){return v.getInstance().getRoot()};v.saveTagsFromPayload=function(a){v.getInstance().saveTagsFromPayload(a)};v.saveTagsFromPayloadDelayed=function(a){setTimeout(v.saveTagsFromPayload.bind(null,a),2e3)};v.handleServerError=function(a,b){v.getInstance().handleServerError(a,b)};v.setAuthorName=function(a,b){v.getInstance().setAuthorName(a,b)};v.storeFromData=function(a){v.getInstance().storeFromData(a)};v.swapData=function(){v.getInstance().swapData()};v.updateTotalCount=function(a,b,c){v.getInstance().updateTotalCount(a,b,c)};v.setVideoRotateURI=function(a){v.getInstance().videoRotateURI=a};Object.assign(v,{STATE_ERROR:"error",STATE_HTML:"html",STATE_IMAGE_PIXELS:"image_pixels",STATE_IMAGE_DATA:"image",LOADING_TIMEOUT:2e3,PAGER_FADE:3e3,FULL_SCREEN_PADDING:10,STAGE_NORMAL_MAX:b("PhotoSnowliftLoader").STAGE_NORMAL_MAX,STAGE_MIN:{x:520,y:520},PROFILE_PICTURE_BUTTON_WIDTH:140,SIDEBAR_SIZE_MAX:b("PhotoSnowliftLoader").SIDEBAR_SIZE_MAX,STAGE_CHROME:b("PhotoSnowliftLoader").STAGE_CHROME,VIDEO_BOTTOM_BAR_SPACE:50,GOPREV_AREA:120,TIMELINE_STRETCH_WIDTH:843,TIMELINE_STRETCH_MIN:480,MIN_TAG_DISTANCE:83,PADDING_MIN:40,MIN_UFI_HEIGHT:250,COLLECTIONS_UNTAGGED_PHOTOS:3,PHOTOS_OF_YOU_SUGGESTIONS:28,FRIENDS_IN_PHOTOS_SUGGESTIONS:31,MIN_ADS_VISIBLE:1,PINNED_UFI_ADJUSTMENT:11,ADD_COMMENT_HEIGHT:54,_instance:null,touch:b("emptyFunction"),touchMarkup:b("emptyFunction")});e.exports=v}),null);