if (self.CavalryLogger) { CavalryLogger.start_js(["aR8g2"]); }

__d("DataViewPolyfill",[],(function(a,b,c,d,e,f){"use strict";__p&&__p();function b(a,b,c){b===undefined?this.$1=new Uint8Array(a):c===undefined?this.$1=new Uint8Array(a,b):this.$1=new Uint8Array(a,b,c),this.byteLength=this.$1.byteLength}b.prototype.getUint8=function(a){if(a>=this.$1.length)throw new Error("Trying to read beyond bounds of DataViewPolyfill");return this.$1[a]};b.prototype.getUint16=function(a,b){var c=this.getUint8(a);a=this.getUint8(a+1);return b?a*256+c:c*256+a};b.prototype.getUint32=function(a,b){var c=this.getUint8(a),d=this.getUint8(a+1),e=this.getUint8(a+2);a=this.getUint8(a+3);return b?((a*256+e)*256+d)*256+c:((c*256+d)*256+e)*256+a};b.isSupported=function(){return!!a.Uint8Array};e.exports=b}),null);
__d("getImageSize",["DataViewPolyfill"],(function(a,b,c,d,e,f){__p&&__p();var g=a.DataView||b("DataViewPolyfill");function h(a){return{width:a.getUint16(6,!0),height:a.getUint16(8,!0)}}function i(a){return{width:a.getUint32(16,!1),height:a.getUint32(20,!1)}}function j(a){var b=a.byteLength,c=2;while(c<b){var d=a.getUint16(c,!1);c+=2;if(d==65472||d==65474)return{width:a.getUint16(c+5,!1),height:a.getUint16(c+3,!1)};else c+=a.getUint16(c,!1)}return null}function c(a){a=new g(a);if(a.getUint8(0)==255&&a.getUint8(1)==216)return j(a);if(a.getUint8(0)==71&&a.getUint8(1)==73&&a.getUint8(2)==70)return h(a);return a.getUint8(0)==137&&a.getUint8(1)==80&&a.getUint8(2)==78&&a.getUint8(3)==71?i(a):null}e.exports=c;c.gif=h;c.png=i;c.jpeg=j}),null);
__d("ChatAutoSendPhotoUploader",["csx","fbt","invariant","ArbiterMixin","AsyncRequest","AsyncUploadRequest","DOM","Event","FileForm","FileFormResetOnSubmit","FileInput","FormSubmitOnChange","JpegResizer","MercuryAttachmentType","MercuryConstants","PhotosMimeType","PhotosUploadID","Run","SubscriptionsHandler","URI","getImageSize","getObjectValues","gkx","isEmpty","mixin"],(function(a,b,c,d,e,f,g,h,i){"use strict";__p&&__p();var j;function k(){return"upload_"+b("PhotosUploadID").getNewID()}function l(a){return Array.prototype.reduce.call(a,function(a,b){var c=k();a[c]=b;return a},{})}c=babelHelpers.inherits(a,b("mixin")(b("ArbiterMixin")));j=c&&c.prototype;function a(a,c,d,e){__p&&__p();j.constructor.call(this);this.$ChatAutoSendPhotoUploader1=d;this.$ChatAutoSendPhotoUploader2=c;this.$ChatAutoSendPhotoUploader3=e;this.$ChatAutoSendPhotoUploader4=new(b("SubscriptionsHandler"))();this.$ChatAutoSendPhotoUploader5={};this.$ChatAutoSendPhotoUploader6={};this.$ChatAutoSendPhotoUploader7=!1;this.$ChatAutoSendPhotoUploader8=a.getAttribute("action");this.$ChatAutoSendPhotoUploader9=new(b("FileForm"))(a,[b("FormSubmitOnChange"),b("FileFormResetOnSubmit")]);this.$ChatAutoSendPhotoUploader9.setAllowCrossOrigin(!0);this.$ChatAutoSendPhotoUploader9.setUploadInParallel(!0);e&&this.$ChatAutoSendPhotoUploader9.setCustomHttpHeader("X-MSGR-Region",e);d=b("DOM").find(a,"._4q60");e=b("DOM").find(d,"._4q61");this.$ChatAutoSendPhotoUploader10=new(b("FileInput"))(d,e,c);this.$ChatAutoSendPhotoUploader4.addSubscriptions(b("Run").onBeforeUnload(this.onBeforeUnload.bind(this)),this.$ChatAutoSendPhotoUploader9.subscribe("submit",this.$ChatAutoSendPhotoUploader11.bind(this)),this.$ChatAutoSendPhotoUploader9.subscribe("success",this.$ChatAutoSendPhotoUploader12.bind(this)),this.$ChatAutoSendPhotoUploader9.subscribe("failure",this.$ChatAutoSendPhotoUploader13.bind(this)),this.$ChatAutoSendPhotoUploader9.subscribe("progress",this.$ChatAutoSendPhotoUploader14.bind(this)),b("Event").listen(e,"click",function(){this.$ChatAutoSendPhotoUploader15===undefined&&this.$ChatAutoSendPhotoUploader16(),this.$ChatAutoSendPhotoUploader15&&(b("JpegResizer").prepareResource&&b("JpegResizer").prepareResource()),this.inform("open")}.bind(this)))}a.prototype.$ChatAutoSendPhotoUploader16=function(){this.$ChatAutoSendPhotoUploader15=b("JpegResizer").isSupported(),this.$ChatAutoSendPhotoUploader15&&this.$ChatAutoSendPhotoUploader9.setPreprocessHandler(this.$ChatAutoSendPhotoUploader17.bind(this))};a.prototype.onBeforeUnload=function(){if(this.isUploading()&&!this.$ChatAutoSendPhotoUploader7)return h._("You haven't sent your message yet. Do you want to leave without sending?")};a.prototype.isUploading=function(){return!b("isEmpty")(this.$ChatAutoSendPhotoUploader5)};a.prototype.destroy=function(){this.$ChatAutoSendPhotoUploader4.release(),this.$ChatAutoSendPhotoUploader9.destroy(),this.$ChatAutoSendPhotoUploader5={},this.$ChatAutoSendPhotoUploader6={}};a.prototype.$ChatAutoSendPhotoUploader18=function(a,b){a=this.$ChatAutoSendPhotoUploader19(a);b&&(a.preview_width=b.width,a.preview_height=b.height);return a};a.prototype.$ChatAutoSendPhotoUploader19=function(a){a={upload_id:a,on_progress:function(a){this.$ChatAutoSendPhotoUploader4.addSubscriptions(this.subscribe("progress",a))}.bind(this),on_resizing_progress:function(a){this.$ChatAutoSendPhotoUploader4.addSubscriptions(this.subscribe("resize_progress",a))}.bind(this),on_success:function(a){this.$ChatAutoSendPhotoUploader4.addSubscriptions(this.subscribe("success",a))}.bind(this),upload_canceled:this.$ChatAutoSendPhotoUploader20.bind(this),attach_type:b("MercuryAttachmentType").PHOTO,preview_uploading:!0};return a};a.prototype.$ChatAutoSendPhotoUploader17=function(a,c){var d=a.getFile();if(!b("PhotosMimeType").isJpeg(d.type))return c(a);b("JpegResizer").getSingleton().resizeBlob(d,function(b,d,e,f,g){d&&a.setFile(d),c(a)},this.$ChatAutoSendPhotoUploader21.bind(this,a))};a.prototype.$ChatAutoSendPhotoUploader11=function(){b("gkx")("AT5V6GuV7OE1f4CNmq1NUhZOeDrgnZF-AQ7WoOvZA8jFMJsYzyghwU79Bm31vgH-mi9DAlUGSFnfYvhwjhMfTolYEEzHhgUrhLD2UxTqbooHHw")||this.uploadFiles(this.$ChatAutoSendPhotoUploader2.files);return!1};a.prototype.$ChatAutoSendPhotoUploader22=function(a){__p&&__p();if(!a)return!1;var c=0;for(var d=0;d<a.length;d++){var e=a[d];c+=e.size;if(c>b("MercuryConstants").AttachmentMaxSize){this.inform("file-upload-error",{error:"size-exceeded"});return!1}if(e.type==="application/x-msdownload"||e.type==="application/x-msdownload-x64"){this.inform("file-upload-error",{error:"wrong-type"});return!1}}return!0};a.prototype.$ChatAutoSendPhotoUploader23=function(a,c){__p&&__p();var d=this,e=arguments.length<=2||arguments[2]===undefined?{}:arguments[2];FileReader!==undefined&&FileReader.prototype.readAsArrayBuffer&&c&&c.length===1?(function(){__p&&__p();d.$ChatAutoSendPhotoUploader5[a]=a;e[a]=c[0];var f=new FileReader();f.onload=function(){this.inform("submit",{upload_id:a,preview_attachments:[this.$ChatAutoSendPhotoUploader18(a,b("getImageSize")(f.result))]})}.bind(d);f.onerror=function(){this.inform("submit",{upload_id:a,preview_attachments:[this.$ChatAutoSendPhotoUploader19(a)]})}.bind(d);if(c[0].size)f.readAsArrayBuffer(c[0]);else{var g=babelHelpers["extends"]({},d.$ChatAutoSendPhotoUploader18(a,c[0].source),{preview_url:c[0].preview_url});d.inform("submit",{upload_id:a,preview_attachments:[g]})}})():(function(){__p&&__p();var b=[];if(!c)d.$ChatAutoSendPhotoUploader5[a]=a,d.$ChatAutoSendPhotoUploader1.value=a,b.push(d.$ChatAutoSendPhotoUploader19(a));else{var f=Object.keys(e);if(f.length>0)f.forEach(function(c){this.$ChatAutoSendPhotoUploader5[c]=a,b.push(this.$ChatAutoSendPhotoUploader19(c))}.bind(d));else for(var f=0;f<c.length;++f){var g=k();e[g]=c[f];d.$ChatAutoSendPhotoUploader5[g]=a;b.push(d.$ChatAutoSendPhotoUploader19(g))}}d.inform("submit",{upload_id:a,preview_attachments:b})})();Object.keys(e).length>0&&this.$ChatAutoSendPhotoUploader9.setFiles(e)};a.prototype.$ChatAutoSendPhotoUploader12=function(event,a){__p&&__p();var b=this.$ChatAutoSendPhotoUploader24(a);if(this.$ChatAutoSendPhotoUploader5[b]){var c=this.$ChatAutoSendPhotoUploader5[b];delete this.$ChatAutoSendPhotoUploader5[b];a=a.response.getPayload();this.$ChatAutoSendPhotoUploader6[c]||(this.$ChatAutoSendPhotoUploader6[c]=[]);this.$ChatAutoSendPhotoUploader6[c].push({id:b,audio_id:a.metadata[0].audio_id,image_id:a.metadata[0].image_id,file_id:a.metadata[0].file_id,gif_id:a.metadata[0].gif_id,video_id:a.metadata[0].video_id});this.inform("success",{upload_id:b});this.$ChatAutoSendPhotoUploader25(c)||this.$ChatAutoSendPhotoUploader26(c);this.$ChatAutoSendPhotoUploader10.clear();this.$ChatAutoSendPhotoUploader2=this.$ChatAutoSendPhotoUploader10.getInput()}};a.prototype.$ChatAutoSendPhotoUploader26=function(a){this.$ChatAutoSendPhotoUploader25(a)&&i(0),this.$ChatAutoSendPhotoUploader6[a].sort(function(a,b){return a.id<b.id?-1:1}),this.inform("all-uploads-completed",{upload_id:a,audio_ids:this.$ChatAutoSendPhotoUploader6[a].map(function(a){return a.audio_id}),image_ids:this.$ChatAutoSendPhotoUploader6[a].map(function(a){return a.image_id}),file_ids:this.$ChatAutoSendPhotoUploader6[a].map(function(a){return a.file_id}),gif_ids:this.$ChatAutoSendPhotoUploader6[a].map(function(a){return a.gif_id}),video_ids:this.$ChatAutoSendPhotoUploader6[a].map(function(a){return a.video_id})}),delete this.$ChatAutoSendPhotoUploader6[a]};a.prototype.$ChatAutoSendPhotoUploader14=function(event,a){this.inform("progress",{upload_id:a.upload.getName(),event:a.event})};a.prototype.$ChatAutoSendPhotoUploader21=function(a,event){this.inform("resize_progress",{upload_id:a.getName(),event:event})};a.prototype.$ChatAutoSendPhotoUploader25=function(a){return b("getObjectValues")(this.$ChatAutoSendPhotoUploader5).includes(a)};a.prototype.$ChatAutoSendPhotoUploader13=function(event,a){var b=this.$ChatAutoSendPhotoUploader24(a);this.$ChatAutoSendPhotoUploader27(b,"last-upload-failed",a.additionalParams);this.$ChatAutoSendPhotoUploader10.clear();this.$ChatAutoSendPhotoUploader2=this.$ChatAutoSendPhotoUploader10.getInput();return!1};a.prototype.$ChatAutoSendPhotoUploader20=function(a){this.$ChatAutoSendPhotoUploader27(a,"last-upload-canceled")};a.prototype.$ChatAutoSendPhotoUploader27=function(a,b,c){if(!this.$ChatAutoSendPhotoUploader5[a])return;var d=this.$ChatAutoSendPhotoUploader5[a];delete this.$ChatAutoSendPhotoUploader5[a];this.$ChatAutoSendPhotoUploader25(d)||(this.$ChatAutoSendPhotoUploader6[d]?this.$ChatAutoSendPhotoUploader26(d):this.inform(b,babelHelpers["extends"]({upload_id:d},c)))};a.prototype.$ChatAutoSendPhotoUploader24=function(a){if(a.upload)return a.upload.getName();else return a.response&&a.response.getPayload().uploadID||a.getName()};a.prototype.uploadFiles=function(a){__p&&__p();if(!this.$ChatAutoSendPhotoUploader22(a))return;var c=k(),d=void 0;if(a.length===1){var e;d=(e={},e[c]=a[0],e)}else d=l(a);e=new(b("AsyncUploadRequest"))(this.$ChatAutoSendPhotoUploader8).setAllowCrossOrigin(!0).setAllowCrossPageTransition(this.$ChatAutoSendPhotoUploader7).setRelativeTo(this.$ChatAutoSendPhotoUploader9.getRoot()).setFiles(d);this.$ChatAutoSendPhotoUploader3&&e.setCustomHttpHeader("X-MSGR-Region",this.$ChatAutoSendPhotoUploader3);this.$ChatAutoSendPhotoUploader4.addSubscriptions(e.subscribe("success",function(event,a){this.$ChatAutoSendPhotoUploader12(event,{upload:a,response:a.getResponse()})}.bind(this)),e.subscribe("failure",this.$ChatAutoSendPhotoUploader13.bind(this)));e.send();this.$ChatAutoSendPhotoUploader23(c,a,d)};a.prototype.uploadURL=function(a){var c=k(),d=a.errorDialogParams;delete a.errorDialogParams;var e=new(b("AsyncRequest"))().setURI(new(b("URI"))(this.$ChatAutoSendPhotoUploader8).getPath()).setAllowCrossPageTransition(this.$ChatAutoSendPhotoUploader7).setData(babelHelpers["extends"]({},a,{attach_id:c})).setErrorHandler(function(a){this.$ChatAutoSendPhotoUploader13(null,{additionalParams:{errorDialogParams:d},response:{getPayload:function(){return{uploadID:c}}}})}.bind(this)).setHandler(function(a){this.$ChatAutoSendPhotoUploader12(null,{response:a})}.bind(this));e.send();this.$ChatAutoSendPhotoUploader23(c,[a])};a.prototype.setAllowCrossPage=function(a){this.$ChatAutoSendPhotoUploader7=a,this.$ChatAutoSendPhotoUploader9.setAllowCrossPageTransition(a)};e.exports=a}),null);