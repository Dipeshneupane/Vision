if (self.CavalryLogger) { CavalryLogger.start_js(["3en\/6"]); }

__d("FantaTypeFileUploaderFile",["immutable"],(function(a,b,c,d,e,f){"use strict";var g;c={file:{},id:"",startTime:0,type:null,uploadedID:null};g=babelHelpers.inherits(a,b("immutable").Record(c));g&&g.prototype;function a(){g.apply(this,arguments)}e.exports=a}),null);
__d("FantaReducersFileUploader",["fbt","Bootloader","Dialog","FantaMessageActions","FantaTypeComposer","FantaTypeFileUploader","FantaTypeFileUploaderFile","FileForm","FileFormResetOnSubmit","FormSubmitOnChange","MercuryConfig","MercuryConstants","PhotosUploadID","SubscriptionsHandler","gkx"],(function(a,b,c,d,e,f,g){"use strict";__p&&__p();var h=b("FantaMessageActions").Types;function i(a){if(!a)return;b("Bootloader").loadModules(["MessengerShareFilePreviewFunnelLogger","MessengerShareFilePreviewFunnelLoggerConstants"],function(b,c){b.startFunnelIfNotStarted(a),b.appendAction(!0,c.PREPARE_FILES_FOR_SEND,a)},"FantaReducersFileUploader")}function j(a,c){if(!a)return;b("Bootloader").loadModules(["MessengerShareFilePreviewFunnelLogger"],function(b,d){b.appendAction(!0,c.toLowerCase(),a)},"FantaReducersFileUploader")}function a(a,c){__p&&__p();switch(c.type){case h.PREPARE_FILES_FOR_SEND:var d=c.files,e=c.tabID;c=c.composer;var f=a.mercury.tabContents.get(e);if(!f||f&&f.composer.version!==c.version)return a;if(b("gkx")("AT5V6GuV7OE1f4CNmq1NUhZOeDrgnZF-AQ7WoOvZA8jFMJsYzyghwU79Bm31vgH-mi9DAlUGSFnfYvhwjhMfTolYEEzHhgUrhLD2UxTqbooHHw")){i(e);return o(a,e,d)}else{f=k();var g=l(f);f=m(e,f,g);n(e,f,g,c);return q(a,e,f,d)}}return a}function k(){var a=document.createElement("form");a.action=b("MercuryConfig").upload_url;a.method="post";return a}function l(a,b){var c=document.createElement("input");c.type="file";c.name="attachment[]";c.multiple=!0;b&&(c.onchange=b);a.appendChild(c);return c}function m(a,c,d){a=new(b("FileForm"))(c,[b("FormSubmitOnChange"),b("FileFormResetOnSubmit")]);a.setAllowCrossOrigin(!0);a.setUploadInParallel(!0);return a}function n(a,c,d,e){var f=new(b("SubscriptionsHandler"))();f.addSubscriptions(c.subscribe("submit",function(){d.files&&b("FantaMessageActions").prepareFilesForSend(a,d.files,e)}),c.subscribe("success",function(event,c){var d=c.response.getPayload();b("FantaMessageActions").uploadedFile(a,s(c),d)}),c.subscribe("failure",function(event,c){b("FantaMessageActions").uploadFileFailed(a,s(c))}));return f}function o(a,c,d){__p&&__p();for(var e=0;e<d.length;e++){var f=d[e];if(f.size>b("MercuryConstants").AttachmentMaxSize){new(b("Dialog"))().setTitle(g._("The file you have selected is too large")).setBody(g._("The file you have selected is too large. The maximum size is 25MB.")).setButtons(b("Dialog").OK).setSemiModal(!0).show();return a}}for(var f=0;f<d.length;f++){e=d[f];var h=t();a=p(a,c,h,e)}return a}function p(a,c,d,e){if(!a.mercury.tabContents.get(c))return a;a=a.setIn(["mercury","tabContents",c,"composer","fileUploader","uploadedFiles",d],new(b("FantaTypeFileUploaderFile"))({file:e,id:d,startTime:Date.now()}));return a}function q(a,c,d,e){__p&&__p();if(!d.canUseXHR())return a;var f={};for(var h=0;h<e.length;h++){var i=e[h];if(i.size>b("MercuryConstants").AttachmentMaxSize){d.abort();d.clear();new(b("Dialog"))().setTitle(g._("The file you have selected is too large")).setBody(g._("The file you have selected is too large. The maximum size is 25MB.")).setButtons(b("Dialog").OK).setSemiModal(!0).show();return a}}for(var i=0;i<e.length;i++){h=e[i];var j=t();a=r(a,c,j,h);f[j]=h}d.setFiles(f);d.forceSendViaXHR();return a}function r(a,c,d,e){if(!a.mercury.tabContents.get(c))return a;a=a.setIn(["mercury","tabContents",c,"composer","fileUploader","uploadingFiles",d],new(b("FantaTypeFileUploaderFile"))({file:e,id:d,startTime:Date.now()}));return a}function c(a,c){__p&&__p();switch(c.type){case h.UPLOADED_FILE:var d=c.payload,e=c.uploadID;c=c.tabID;var f=a.mercury.tabContents.get(c);if(!f)return a;f=f.composer.fileUploader.uploadingFiles.get(e);a=a.deleteIn(["mercury","tabContents",c,"composer","fileUploader","uploadingFiles",e]);if(f){d=d.metadata[0];var g=b("FantaTypeFileUploader").fileTypes.GENERIC_ATTACHMENT,i=d;d.image_id?(g=b("FantaTypeFileUploader").fileTypes.IMAGE,i=d.image_id):d.gif_id?(g=b("FantaTypeFileUploader").fileTypes.ANIMATED_IMAGE,i=d.gif_id):d.video_id?(g=b("FantaTypeFileUploader").fileTypes.VIDEO,i=d.video_id):d.audio_id?(g=b("FantaTypeFileUploader").fileTypes.AUDIO,i=d.audio_id):d.file_id&&(g=b("FantaTypeFileUploader").fileTypes.FILE,i=d.file_id);a=a.setIn(["mercury","tabContents",c,"composer","fileUploader","uploadedFiles",e],f.merge({uploadedID:i,type:g}))}}return a}function d(a,b){__p&&__p();switch(b.type){case h.CANCEL_FILE_UPLOAD:case h.UPLOAD_FILE_FAILED:var c=b.uploadID,d=b.tabID,e=a.mercury.tabContents.get(d);if(!e)return a;var f=e.composer.fileUploader.uploadingFiles.get(c);j(d,b.type);if(f)a=a.deleteIn(["mercury","tabContents",d,"composer","fileUploader","uploadingFiles",c]);else{b=e.composer.fileUploader.uploadedFiles.get(c);b&&(a=a.deleteIn(["mercury","tabContents",d,"composer","fileUploader","uploadedFiles",c]))}}return a}function s(a){var b=a.response.getPayload();if(a.upload)return a.upload.getName();else return b.uploadID}function t(){return"upload_"+b("PhotosUploadID").getNewID()}e.exports={cancelFileUpload:d,prepareFilesForSend:a,uploadedFile:c}}),null);
__d("MessengerUploadFilesStore",["fbt","Dialog","FantaTypeFileUploader","FantaTypeFileUploaderFile","immutable","LogHistory","MercuryConstants","MessengerActions","MessengerStore","PhotosUploadID"],(function(a,b,c,d,e,f,g){"use strict";__p&&__p();var h,i=b("LogHistory").getInstance("messenger_share_file_preview");c=babelHelpers.inherits(a,b("MessengerStore"));h=c&&c.prototype;function a(){h.constructor.call(this),this.$MessengerUploadFilesStore1=b("immutable").Map({})}a.prototype.getState=function(){return this.$MessengerUploadFilesStore1};a.prototype.__onDispatch=function(a){__p&&__p();var c=void 0;void 0;var d=a.threadID,e=a.uploadID;switch(a.type){case b("MessengerActions").Types.PREPARE_FILES_FOR_SEND:i.log("Add files "+d,JSON.stringify(a));var f=a.files;this.$MessengerUploadFilesStore1=j(this.$MessengerUploadFilesStore1,d,f);this.emitChange();break;case b("MessengerActions").Types.CANCEL_FILE_UPLOAD:i.debug("Remove file "+d,JSON.stringify(a));c=this.$MessengerUploadFilesStore1.get(d);f=c.get("uploadingFiles").get(e);f?this.$MessengerUploadFilesStore1=this.$MessengerUploadFilesStore1.deleteIn([d,"uploadingFiles",e]):(f=c.get("uploadedFiles").get(e),f&&(this.$MessengerUploadFilesStore1=this.$MessengerUploadFilesStore1.deleteIn([d,"uploadedFiles",e])));this.emitChange();break;case b("MessengerActions").Types.EMPTY_FILES:i.debug("Empty files "+d,JSON.stringify(a));this.$MessengerUploadFilesStore1=this.$MessengerUploadFilesStore1.withMutations(function(a){a.get(d)&&a.set(d,new(b("FantaTypeFileUploader"))())});this.emitChange();break}};function j(a,c,d){__p&&__p();for(var e=0;e<d.length;e++){var f=d[e];if(f.size>b("MercuryConstants").AttachmentMaxSize){new(b("Dialog"))().setTitle(g._("The file you have selected is too large")).setBody(g._("The file you have selected is too large. The maximum size is 25MB.")).setButtons(b("Dialog").OK).setSemiModal(!0).show();return a}}for(var f=0;f<d.length;f++){e=d[f];var h=l();a=k(a,c,h,e)}return a}function k(a,c,d,e){return a.withMutations(function(a){a.get(c)||a.set(c,new(b("FantaTypeFileUploader"))());var f=a.get(c);a.set(c,f.setIn(["uploadedFiles",d],new(b("FantaTypeFileUploaderFile"))({file:e,id:d,startTime:Date.now()})))})}function l(){return"upload_"+b("PhotosUploadID").getNewID()}e.exports=new a()}),null);